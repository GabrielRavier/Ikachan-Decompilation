/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2015 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_401000();
char __cdecl sub_4010B0(int a1);
char __cdecl sub_401340(_BYTE *a1);
void __cdecl sub_4017F0(_BYTE *a1, char a2);
char __cdecl sub_401890(int a1, _BYTE *a2);
FILE *__cdecl sub_401C50(void *a1);
FILE *__cdecl sub_401CC0(void *a1);
LRESULT __cdecl sub_401D40(HWND hDlg);
FILE *__cdecl sub_401DC0(HWND hDlg);
BOOL __stdcall DialogFunc(HWND, UINT, WPARAM, LPARAM); // idb
int __cdecl sub_401E70(int a1, int a2);
int __cdecl sub_401E90(HWND hWnd); // idb
signed int __cdecl Init_Direct_Draw(HWND a1, int a2); // idb
LPDIRECTDRAW __cdecl sub_402140(int a1);
int __cdecl sub_4021A0(int a1);
HANDLE __cdecl sub_4021D0(int a1, signed int a2);
signed int __cdecl sub_402380(int a1, int a2, signed int a3);
int __cdecl sub_402440(int a1, int a2);
int __cdecl sub_4024C0(int a1, int a2, int a3, int a4, int a5);
int __cdecl sub_402600(int a1, int a2);
int __cdecl sub_402680(int a1, int a2, int a3);
HFONT __cdecl sub_402710(LPCSTR pszFaceName);
int __cdecl sub_402770(int, int, LPCSTR lpString, COLORREF color, HDC hdc); // idb
// void __cdecl __CxxRestoreUnhandledExceptionFilter(); idb
int sub_402820();
int sub_402860();
int __cdecl sub_4028D0(int a1, int a2);
char __cdecl sub_402C20(int a1);
int __cdecl sub_403140(int a1);
FILE *__cdecl sub_403270(int a1);
FILE *__cdecl sub_403370(int a1);
signed int __cdecl sub_403470(_BYTE *a1);
int __cdecl sub_403490(int a1, int a2, int a3);
int __cdecl sub_403560(int a1, int a2, int a3);
int __cdecl sub_403630(int a1, int a2, int a3);
int __cdecl sub_4036E0(int a1, int a2, int a3);
int __cdecl sub_4037E0(int a1, int a2, int a3);
signed int __cdecl sub_403820(_BYTE *a1);
int __cdecl sub_403840(int a1, int a2);
signed int __cdecl sub_403920(int a1, int a2, _BYTE *a3);
int __cdecl sub_403C40(int a1, int a2, int a3);
int __cdecl sub_403CC0(int a1, int a2, int a3);
int __cdecl sub_403D40(LPCSTR lpString); // idb
FILE *__cdecl sub_403D60(LPCSTR lpFileName, int a2);
FILE *__cdecl sub_403DF0(void *a1, int a2, int a3, int a4);
int __cdecl sub_403F90(void *, int, int, int); // idb
signed int __cdecl sub_404140(signed int a1, int a2);
signed int __cdecl sub_404180(signed int a1, int a2);
int __cdecl sub_4041C0(signed int a1, int a2);
// int __usercall sub_404200@<eax>(int a1@<esi>, int a2);
signed int __cdecl sub_404260(int a1);
int __cdecl sub_4042E0(int a1);
char __cdecl sub_404320(int a1, void *a2, int a3, int a4, int a5, int a6, int a7, int a8);
void __cdecl sub_405210(int a1);
int __cdecl sub_4052A0(void *a1);
int __cdecl sub_4052B0(int a1);
int sub_4052E0();
// signed int __usercall sub_405350@<eax>(int a1@<edi>, int a2@<esi>, HWND hWnd);
signed int __cdecl sub_406070(int a1, signed int *a2, int a3);
signed int __cdecl sub_406140(_DWORD *a1, _DWORD *a2, _DWORD *a3, _DWORD *a4);
int __cdecl sub_406210(HWND hwnd); // idb
BOOL sub_4062E0();
FILE *__cdecl sub_406310(int a1, int a2, int a3, int a4);
signed int __cdecl sub_406390(HLOCAL *a1);
int __cdecl sub_4063B0(int a1);
char __cdecl sub_4064A0(int a1, int a2);
signed int __cdecl sub_406530(_DWORD *a1, char a2);
signed int __cdecl sub_406550(int *a1, char a2);
signed int __cdecl sub_4065A0(int *a1, char a2);
FILE *__cdecl sub_4065F0(char *a1, int a2);
int __cdecl sub_406730(int a1);
int __cdecl sub_406830(int a1, signed int a2, signed int a3);
int __cdecl sub_406950(int a1, signed int a2, signed int a3);
int __cdecl sub_406A50(int a1, signed int a2, signed int a3);
int __cdecl sub_406BE0(int a1, int a2, int a3);
int __cdecl sub_406D10(int a1, int a2);
int __cdecl sub_406E10(int a1);
int __cdecl sub_406E60(int a1, int a2);
int __cdecl sub_406EF0(int a1, int a2);
int __cdecl sub_406FC0(int a1, int a2);
int __cdecl sub_407050(int a1, int a2);
int __cdecl sub_4070E0(int a1, int a2);
int __cdecl sub_407170(int a1, int a2);
int __cdecl sub_407200(int a1, int a2);
int __cdecl sub_407290(int a1, int a2);
int __cdecl sub_407310(int a1, int a2);
int __cdecl NPC0(int a1);
__int64 __cdecl NPC1_7(int a1);
int __cdecl NPC2(int a1);
int __cdecl NPC3(int a1);
int __cdecl NPC4_5(int a1);
int __cdecl NPC6_9(int a1);
int __cdecl NPC8(int a1);
int __cdecl sub_4079B0(int a1);
char __cdecl sub_4079E0(int a1, int a2, int a3, char a4);
int __cdecl sub_407CE0(int a1, int a2);
int __cdecl sub_407E30(int a1, int a2, _BYTE *a3);
signed int __cdecl sub_408260(char *a1);
HANDLE __cdecl sub_4083B0(int a1);
int __cdecl sub_4083F0(int *a1);
FILE *__cdecl sub_408520(int a1, LPCSTR lpFileName);
int __cdecl sub_4085A0(int, LPCSTR lpFileName, char); // idb
signed int __cdecl sub_408620(int a1, _BYTE *a2);
int __cdecl sub_408820(HLOCAL *a1);
int sub_408850(void); // weak
HLOCAL sub_408A90();
FILE *__cdecl sub_408AF0(char *a1);
DWORD sub_408BA0();
int sub_408CE0();
FILE *__cdecl sub_408E20(int a1);
char __cdecl sub_408F10(int a1);
void __cdecl sub_409030(_BYTE *a1, char a2);
char __cdecl sub_409150(int a1, int a2, char a3);
char __cdecl sub_409590(int a1, int a2, char a3, _BYTE *a4, int a5);
void __cdecl sub_409A30(int a1, int a2, _BYTE *a3);
int __cdecl sub_409A90(int a1, int a2, unsigned __int8 a3);
int __cdecl sub_409B30(int a1, int a2, _BYTE *a3, int a4);
char __cdecl sub_409CA0(int a1, _BYTE *a2);
int __cdecl sub_409F50(int a1);
int sub_40A060();
int __cdecl sub_40A100(_BYTE *a1);
int __cdecl sub_40A4F0(_BYTE *a1);
int __cdecl sub_40A620(int a1, _BYTE *a2);
int __cdecl sub_40A6D0(int a1);
int sub_40A6F0();
signed int __cdecl sub_40A780(int a1);
LPDIRECTSOUND sub_40A810();
int __cdecl sub_40A870(int a1);
// HRSRC __usercall sub_40A8A0@<eax>(int a1@<edi>, int a2@<esi>, LPCSTR lpName, int a4, int a5);
int __cdecl sub_40A9C0(int a1, int a2);
int __cdecl sub_40AA30(int a1, int a2);
int __cdecl sub_40AA60(int a1, int a2);
int __cdecl sub_40AA90(int a1, int a2);
size_t __cdecl sub_40AAC0(int a1, int a2, int a3, size_t a4, void *a5);
int __cdecl Random(signed int Minimum, signed int Maximum); // idb
int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd);
void sub_40B0D0();
// int __setargv(void); weak
signed int __stdcall sub_40B0F0(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
signed int sub_40B580();
// BOOL __stdcall VerQueryValueA(LPCVOID pBlock, LPCSTR lpSubBlock, LPVOID *lplpBuffer, PUINT puLen);
// BOOL __stdcall GetFileVersionInfoA(LPCSTR lptstrFilename, DWORD dwHandle, DWORD dwLen, LPVOID lpData);
// DWORD __stdcall GetFileVersionInfoSizeA(LPCSTR lptstrFilename, LPDWORD lpdwHandle);
// HRESULT __stdcall DirectDrawCreate(GUID *lpGUID, LPDIRECTDRAW *lplpDD, IUnknown *pUnkOuter);
// HRESULT __stdcall DirectSoundCreate(LPGUID, LPDIRECTSOUND *, LPUNKNOWN);
// int __cdecl fclose(FILE *);
// size_t __cdecl fwrite(const void *, size_t, size_t, FILE *);
// FILE *__cdecl fopen(const char *, const char *);
// int sprintf(char *, const char *, ...);
// size_t __cdecl fread(void *, size_t, size_t, FILE *);
// int sscanf(const char *, const char *, ...);
// void __cdecl free(void *);
// void *__cdecl malloc(size_t);
// int fprintf(FILE *, const char *, ...);
// int __cdecl rand();
// int __cdecl _close(int);
// _DWORD __cdecl _freebuf(_DWORD); weak
// _DWORD __cdecl _flush(_DWORD); weak
int sub_40BD2A();
// _DWORD __cdecl flsall(_DWORD); weak
// HRESULT __stdcall DirectDrawCreate(GUID *lpGUID, LPDIRECTDRAW *lplpDD, IUnknown *pUnkOuter);
// COLORREF __stdcall SetTextColor(HDC hdc, COLORREF color);
// int __stdcall SetBkMode(HDC hdc, int mode);
// HGDIOBJ __stdcall GetStockObject(int i);
// BOOL __stdcall StretchBlt(HDC hdcDest, int xDest, int yDest, int wDest, int hDest, HDC hdcSrc, int xSrc, int ySrc, int wSrc, int hSrc, DWORD rop);
// BOOL __stdcall TextOutA(HDC hdc, int x, int y, LPCSTR lpString, int c);
// HFONT __stdcall CreateFontA(int cHeight, int cWidth, int cEscapement, int cOrientation, int cWeight, DWORD bItalic, DWORD bUnderline, DWORD bStrikeOut, DWORD iCharSet, DWORD iOutPrecision, DWORD iClipPrecision, DWORD iQuality, DWORD iPitchAndFamily, LPCSTR pszFaceName);
// int __stdcall GetObjectA(HANDLE h, int c, LPVOID pv);
// HDC __stdcall CreateCompatibleDC(HDC hdc);
// HGDIOBJ __stdcall SelectObject(HDC hdc, HGDIOBJ h);
// BOOL __stdcall DeleteDC(HDC hdc);
// BOOL __stdcall DeleteObject(HGDIOBJ ho);
// BOOL __stdcall DeleteFileA(LPCSTR lpFileName);
// HLOCAL __stdcall LocalFree(HLOCAL hMem);
// LPVOID __stdcall LockResource(HGLOBAL hResData);
// HGLOBAL __stdcall LoadResource(HMODULE hModule, HRSRC hResInfo);
// HRSRC __stdcall FindResourceA(HMODULE hModule, LPCSTR lpName, LPCSTR lpType);
// BOOL __stdcall ReleaseMutex(HANDLE hMutex);
// HANDLE __stdcall CreateMutexA(LPSECURITY_ATTRIBUTES lpMutexAttributes, BOOL bInitialOwner, LPCSTR lpName);
// HANDLE __stdcall OpenMutexA(DWORD dwDesiredAccess, BOOL bInheritHandle, LPCSTR lpName);
// UINT __stdcall GetSystemDirectoryA(LPSTR lpBuffer, UINT uSize);
// DWORD __stdcall GetModuleFileNameA(HMODULE hModule, LPSTR lpFilename, DWORD nSize);
// HANDLE __stdcall CreateFileA(LPCSTR lpFileName, DWORD dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES lpSecurityAttributes, DWORD dwCreationDisposition, DWORD dwFlagsAndAttributes, HANDLE hTemplateFile);
// DWORD __stdcall GetFileSize(HANDLE hFile, LPDWORD lpFileSizeHigh);
// BOOL __stdcall CloseHandle(HANDLE hObject);
// HLOCAL __stdcall LocalAlloc(UINT uFlags, SIZE_T uBytes);
// HMODULE __stdcall GetModuleHandleA(LPCSTR lpModuleName);
// DWORD __stdcall GetTickCount();
// HINSTANCE __stdcall ShellExecuteA(HWND hwnd, LPCSTR lpOperation, LPCSTR lpFile, LPCSTR lpParameters, LPCSTR lpDirectory, INT nShowCmd);
// BOOL __stdcall TranslateMessage(const MSG *lpMsg);
// LRESULT __stdcall DispatchMessageA(const MSG *lpMsg);
// BOOL __stdcall PeekMessageA(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax, UINT wRemoveMsg);
// BOOL __stdcall GetMessageA(LPMSG lpMsg, HWND hWnd, UINT wMsgFilterMin, UINT wMsgFilterMax);
// int __stdcall TranslateAcceleratorA(HWND hWnd, HACCEL hAccTable, LPMSG lpMsg);
// void __stdcall PostQuitMessage(int nExitCode);
// BOOL __stdcall PostMessageA(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// BOOL __stdcall ShowWindow(HWND hWnd, int nCmdShow);
// LRESULT __stdcall DefWindowProcA(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam);
// INT_PTR __stdcall DialogBoxParamA(HINSTANCE hInstance, LPCSTR lpTemplateName, HWND hWndParent, DLGPROC lpDialogFunc, LPARAM dwInitParam);
// ATOM __stdcall RegisterClassA(const WNDCLASSA *lpWndClass);
// int __stdcall GetSystemMetrics(int nIndex);
// HWND __stdcall CreateWindowExA(DWORD dwExStyle, LPCSTR lpClassName, LPCSTR lpWindowName, DWORD dwStyle, int X, int Y, int nWidth, int nHeight, HWND hWndParent, HMENU hMenu, HINSTANCE hInstance, LPVOID lpParam);
// HACCEL __stdcall LoadAcceleratorsA(HINSTANCE hInstance, LPCSTR lpTableName);
// HMENU __stdcall GetMenu(HWND hWnd);
// HCURSOR __stdcall LoadCursorA(HINSTANCE hInstance, LPCSTR lpCursorName);
// HCURSOR __stdcall SetCursor(HCURSOR hCursor);
// BOOL __stdcall GetCursorPos(LPPOINT lpPoint);
// BOOL __stdcall SetCursorPos(int X, int Y);
// int __stdcall MessageBoxA(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType);
// HANDLE __stdcall LoadImageA(HINSTANCE hInst, LPCSTR name, UINT type, int cx, int cy, UINT fuLoad);
// BOOL __stdcall GetWindowRect(HWND hWnd, LPRECT lpRect);
// BOOL __stdcall EndDialog(HWND hDlg, INT_PTR nResult);
// LRESULT __stdcall SendDlgItemMessageA(HWND hDlg, int nIDDlgItem, UINT Msg, WPARAM wParam, LPARAM lParam);

//-------------------------------------------------------------------------
// Data declarations

int dword_412030[] = { 0 }; // weak
int dword_412034 = 0; // weak
int dword_412038 = 32; // weak
int dword_41203C = 24; // weak
char *off_4120D0 = "Option.bin"; // weak
char aWb[3] = "wb"; // idb
char aSS[] = "%s\\%s"; // idb
char aRb[] = "rb"; // idb
char a640x480Windowe[18] = "640x480 Windowed "; // weak
char a320x240Windowe[18] = "320x240 Windowed "; // weak
char aFullscreen[15] = "Fullscreen    "; // weak
int dword_412128 = 1; // weak
_UNKNOWN unk_412130; // weak
_UNKNOWN unk_412140; // weak
_UNKNOWN unk_412150; // weak
_UNKNOWN unk_412160; // weak
_UNKNOWN unk_412170; // weak
_UNKNOWN unk_412180; // weak
_UNKNOWN unk_412190; // weak
char aNpchar_dat[11] = "NPChar.dat"; // weak
int (__cdecl *off_4121E0[4])(int, int, int) = { &sub_403490, &sub_403560, &sub_403630, &sub_4036E0 }; // weak
_UNKNOWN unk_4121F0; // weak
_UNKNOWN unk_412330; // weak
_UNKNOWN unk_412420; // weak
_UNKNOWN unk_412430; // weak
_UNKNOWN unk_4124D0; // weak
_UNKNOWN unk_412570; // weak
_UNKNOWN unk_412584; // weak
_UNKNOWN unk_412588; // weak
_UNKNOWN unk_412598; // weak
_UNKNOWN unk_4125A8; // weak
_UNKNOWN unk_4125B8; // weak
_UNKNOWN unk_4125C8; // weak
char aIka_en03[9] = "ika_en03"; // weak
char a8[2] = "8"; // weak
_UNKNOWN unk_412668; // weak
char aIka_rec[8] = "Ika.rec"; // weak
_UNKNOWN unk_412680; // weak
_UNKNOWN unk_412690; // weak
char aStaff_ptx[10] = "Staff.ptx"; // weak
char aPbmEnd_pbm[12] = "Pbm\\End.pbm"; // weak
char aPbmStaff_pbm[14] = "Pbm\\Staff.pbm"; // weak
char aPbmNpctype_pbm[16] = "Pbm\\NpcType.pbm"; // weak
char aPbmEditor_pbm[15] = "Pbm\\Editor.pbm"; // weak
char aPbmLevelup_pbm[16] = "Pbm\\LevelUp.pbm"; // weak
char aPbmDamage_pbm[15] = "Pbm\\Damage.pbm"; // weak
char aPbmBubble_pbm[15] = "Pbm\\Bubble.pbm"; // weak
char aPbmStar_pbm[13] = "Pbm\\Star.pbm"; // weak
char aPbmMychar3_pbm[16] = "Pbm\\MyChar3.pbm"; // weak
char aPbmMychar2_pbm[16] = "Pbm\\MyChar2.pbm"; // weak
char aPbmMychar_pbm[15] = "Pbm\\MyChar.pbm"; // weak
char aPbmIronhead_pb[17] = "Pbm\\Ironhead.pbm"; // weak
char aPbmUfo_pbm[12] = "Pbm\\Ufo.pbm"; // weak
char aPbmJuel_pbm[13] = "Pbm\\Juel.pbm"; // weak
char aPbmCarry_pbm[14] = "Pbm\\Carry.pbm"; // weak
char aPbmDum_pbm[12] = "Pbm\\Dum.pbm"; // weak
char aPbmHoshi_pbm[14] = "Pbm\\Hoshi.pbm"; // weak
char aPbmChibi_pbm[14] = "Pbm\\Chibi.pbm"; // weak
char aPbmSleep_pbm[14] = "Pbm\\Sleep.pbm"; // weak
char aPbmKani_pbm[13] = "Pbm\\Kani.pbm"; // weak
char aPbmIsogin_pbm[15] = "Pbm\\Isogin.pbm"; // weak
char aPbmHari_pbm[13] = "Pbm\\Hari.pbm"; // weak
char aPbmItembox_pbm[16] = "Pbm\\ItemBox.pbm"; // weak
char aPbmItem_pbm[13] = "Pbm\\Item.pbm"; // weak
char aPbmFigure_pbm[15] = "Pbm\\Figure.pbm"; // weak
char aPbmStatus_pbm[15] = "Pbm\\Status.pbm"; // weak
char aPbmBack_pbm[13] = "Pbm\\Back.pbm"; // weak
char aPbmPrtsnack_pb[17] = "Pbm\\PrtSnack.pbm"; // weak
char aPbmPrtitem_pbm[16] = "Pbm\\PrtItem.pbm"; // weak
char aPbmPrtdmg_pbm[15] = "Pbm\\PrtDmg.pbm"; // weak
char aPbmPrtblock_pb[17] = "Pbm\\PrtBlock.pbm"; // weak
char aPbmPrtdir_pbm[15] = "Pbm\\PrtDir.pbm"; // weak
char aPbmPrtfilt_pbm[16] = "Pbm\\PrtFilt.pbm"; // weak
char aPbmPrtback_pbm[16] = "Pbm\\PrtBack.pbm"; // weak
char aPbmLoading_pbm[16] = "Pbm\\Loading.pbm"; // weak
char aWords_ptx[10] = "Words.ptx"; // weak
char aPbmMap1_pbm[13] = "Pbm\\Map1.pbm"; // weak
char aPbmYesno_pbm[14] = "Pbm\\YesNo.pbm"; // weak
char aPbmCursor_pbm[15] = "Pbm\\Cursor.pbm"; // weak
char aPbmMsgbox_pbm[15] = "Pbm\\MsgBox.pbm"; // weak
char aEvent_ptx[10] = "Event.ptx"; // weak
char aPbmFade_pbm[13] = "Pbm\\Fade.pbm"; // weak
CHAR aBossouch[] = "BOSSOUCH"; // idb
CHAR aQuake[] = "QUAKE"; // idb
CHAR aNodmg[] = "NODMG"; // idb
CHAR aYesno[] = "YESNO"; // idb
CHAR aSave[] = "SAVE"; // idb
CHAR aLifeup[] = "LIFEUP"; // idb
CHAR aLevelup[] = "LEVELUP"; // idb
CHAR aWin[] = "WIN"; // idb
CHAR aDead[] = "DEAD"; // idb
CHAR aMessage[] = "MESSAGE"; // idb
CHAR aGo[] = "GO"; // idb
CHAR aReady[] = "READY"; // idb
CHAR aCrash[] = "CRASH"; // idb
CHAR aHithead[] = "HITHEAD"; // idb
CHAR aItem[] = "ITEM"; // idb
CHAR aOuch[] = "OUCH"; // idb
CHAR aDash[] = "DASH"; // idb
char aGameStart[11] = "game start"; // weak
char aDec[4] = "Dec"; // weak
char aNov[4] = "Nov"; // weak
char aOct[4] = "Oct"; // weak
char aSep[4] = "Sep"; // weak
char aAug[4] = "Aug"; // weak
char aJul[4] = "Jul"; // weak
char aJun[4] = "Jun"; // weak
char aMay[4] = "May"; // weak
char aApr[4] = "Apr"; // weak
char aMar[4] = "Mar"; // weak
char aFeb[4] = "Feb"; // weak
char aJan[4] = "Jan"; // weak
char aXxx[4] = "XXX"; // weak
char aNov92003[] = "Nov  9 2003"; // idb
char aSDD[] = "%s %d %d"; // idb
CHAR SubBlock[] = "\\"; // idb
CHAR Operation[] = "open"; // idb
char aSSndvol32_exe[] = "%s\\Sndvol32.exe"; // idb
char aSDebug_txt[] = "%s\\debug.txt"; // idb
char aSDDD[] = "%s,%d,%d,%d\n"; // idb
char aAT[] = "a+t"; // idb
char byte_412A60[] = { '\0' }; // weak
_UNKNOWN unk_412A70; // weak
char byte_412AF0[] = { '\x01' }; // weak
char byte_412AF8[] = { '\x01' }; // weak
char byte_412B04[] = { '\x01' }; // weak
int (__cdecl *NPC_function_Table[10])(int) =
{
  &NPC0,
  &NPC1_7,
  &NPC2,
  &NPC3,
  &NPC4_5,
  &NPC4_5,
  &NPC6_9,
  &NPC1_7,
  &NPC8,
  &NPC6_9
}; // weak
int (__cdecl *off_412B38[10])(int, int) =
{
  &sub_406E60,
  &sub_406EF0,
  &sub_406FC0,
  &sub_407050,
  &sub_4070E0,
  &sub_407170,
  &sub_406EF0,
  &sub_407200,
  &sub_406E60,
  &sub_407290
}; // weak
_UNKNOWN unk_412B60; // weak
_UNKNOWN unk_412BE0; // weak
_UNKNOWN unk_412C20; // weak
_UNKNOWN unk_412CA0; // weak
_UNKNOWN unk_412CE0; // weak
_UNKNOWN unk_412D40; // weak
_UNKNOWN unk_412DA0; // weak
_UNKNOWN unk_412DE0; // weak
_UNKNOWN unk_412DF0; // weak
_UNKNOWN unk_412E00; // weak
_UNKNOWN unk_412E10; // weak
_UNKNOWN unk_412E20; // weak
_UNKNOWN unk_412E30; // weak
_UNKNOWN unk_412E40; // weak
_UNKNOWN unk_412E50; // weak
_UNKNOWN unk_412E60; // weak
_UNKNOWN unk_412E70; // weak
char aPbmMaruame_pbm[16] = "Pbm\\MaruAme.pbm"; // weak
char aPbmOpening_pbm[16] = "Pbm\\Opening.pbm"; // weak
char *off_412EA0[6] =
{
  "Pmd\\Ikachan.pmd",
  "Pmd\\Magirete.pmd",
  "Pmd\\Buriki.pmd",
  "Pmd\\Mizuno.pmd",
  "Pmd\\Quake.pmd",
  "Pmd\\Tidepool.pmd"
}; // weak
char aGbgcgugGkgeb_0[27] = "ƒƒCƒ“ƒ{ƒŠƒ…[ƒ€iƒhƒ‰ƒ€j"; // weak
_UNKNOWN unk_412F6C; // weak
_UNKNOWN unk_412F80; // weak
char aGbgcgugGkgebGa[29] = "ƒƒCƒ“ƒ{ƒŠƒ…[ƒ€iƒƒƒfƒBj"; // weak
char aGGkgebGaokvV[17] = "ƒ{ƒŠƒ…[ƒ€OK‚Å‚·"; // weak
char aGtgfbGhbighgig[19] = "ƒtƒF[ƒhiƒhƒ‰ƒ€j"; // weak
char aGtgfbGhbigbgng[21] = "ƒtƒF[ƒhiƒƒƒfƒBj"; // weak
int (__cdecl *off_412FF0[2])(int) = { &sub_40A100, &sub_40A4F0 }; // weak
__int16 word_412FFC[] = { 4 }; // weak
__int16 word_41300C[] = { 8 }; // weak
_UNKNOWN unk_413020; // weak
_UNKNOWN unk_4130E0; // weak
int dword_4131E0[] = { 4294966784 }; // weak
int dword_4131EC[] = { 4294966784 }; // weak
int dword_4131F8[] = { 4294964224 }; // weak
int dword_413204[] = { 0 }; // weak
_UNKNOWN unk_413224; // weak
_UNKNOWN unk_413238; // weak
CHAR Type[] = "WAVE"; // idb
CHAR Caption[] = "Ikachan"; // idb
char *off_413278 = &unk_41327C; // idb
char a04d02d02dByPix[35] = " - %04d/%02d/%02d\r\nBy Pixel       "; // weak
CHAR Text[13] = "ƒTƒEƒ“ƒh‚Ì‰Š"; // idb
char aPbmLoading2_pb[17] = "Pbm\\Loading2.pbm"; // weak
CHAR CursorName[] = "PIXELCURSOR"; // idb
CHAR TableName[] = "ACCEL"; // idb
char aMenu_main[10] = "MENU_MAIN"; // weak
CHAR name[] = "0"; // idb
CHAR TemplateName[] = "DLG_START"; // idb
CHAR Name[] = "Ikachan"; // idb
CHAR aGGkgebGarTsv[15] = "ƒ{ƒŠƒ…[ƒ€Ý’è‚"; // idb
char byte_413BE0 = '\0'; // weak
__int16 word_413BE2 = 0; // weak
__int16 word_413BE4 = 0; // weak
char byte_413BE6 = '\0'; // weak
char byte_413BE7 = '\0'; // weak
__int16 word_413BE8 = 0; // weak
__int16 word_413BEA = 0; // weak
__int16 word_413BEC = 0; // weak
char byte_413BEE = '\0'; // weak
int dword_413BEF = 0; // weak
int dword_413BF8 = 0; // weak
int dword_413BFC = 0; // weak
int dword_413C00 = 0; // weak
int dword_413C04 = 0; // weak
int dword_413C08 = 0; // weak
int dword_413C0C = 0; // weak
int dword_413C10 = 0; // weak
int dword_413C14 = 0; // weak
int dword_413C18 = 0; // weak
int dword_413C1C = 0; // weak
int dword_413C20 = 0; // weak
int dword_413C24 = 0; // weak
int dword_413C28 = 0; // weak
HGDIOBJ ho = NULL; // idb
int dword_413C30 = 0; // weak
int dword_413C38 = 0; // weak
int dword_413C3C = 0; // weak
int dword_413C40 = 0; // weak
int dword_413C44 = 0; // weak
int dword_413C50 = 0; // weak
int dword_413C54 = 0; // weak
int dword_413C58 = 0; // weak
LPDIRECTDRAW Direct_Draw_Obj = NULL; // idb
int dword_413C60 = 0; // weak
int dword_413C64 = 0; // weak
int dword_413C68[] = { 0 }; // weak
_UNKNOWN unk_414468; // weak
char byte_416C68; // weak
__int16 word_416C6A; // weak
__int64 qword_416C6C; // weak
int dword_416C74; // weak
int dword_416C78; // weak
int dword_416C7C; // weak
int dword_416C80; // weak
int dword_416C84; // weak
int dword_416C88; // weak
int dword_416C8C; // weak
int dword_416C90; // weak
int dword_416C98; // weak
int dword_416C9C; // weak
int dword_416CA0; // weak
int dword_416CA4; // weak
int dword_416CA8; // weak
int dword_416CAC; // weak
int dword_416CB0; // weak
_UNKNOWN unk_416CB8; // weak
int dword_416CC0; // weak
int dword_416CC4; // weak
int dword_416CC8; // weak
size_t dword_416CCC; // idb
_UNKNOWN unk_416CD4; // weak
_UNKNOWN unk_416CD8; // weak
int dword_4170CC; // weak
char byte_4170D0; // weak
int dword_4170D4; // weak
int dword_4170D8; // weak
HLOCAL hMem; // idb
HLOCAL dword_4170E0; // idb
HLOCAL dword_4170E4; // idb
HLOCAL dword_4170E8; // idb
int dword_4170EC; // weak
char byte_4170F0; // weak
char byte_4170F1; // weak
char byte_4170F2; // weak
char byte_4170F3; // weak
int dword_4170F4; // weak
int dword_4170F8; // weak
int dword_4170FC; // weak
int dword_417100; // weak
char byte_417104; // weak
__int16 word_417106; // weak
__int16 word_417108; // weak
__int16 word_41710A; // weak
__int16 word_41710C; // weak
__int16 word_41710E; // weak
char byte_417110; // weak
__int16 word_417112; // weak
__int16 word_417114; // weak
char byte_417116; // weak
char byte_417117; // weak
char byte_417118; // weak
char byte_417119; // weak
LPDIRECTSOUND dword_41711C; // idb
int dword_417120; // weak
int dword_417124[]; // weak
_UNKNOWN unk_417144; // weak
int dword_417924; // weak
int dword_417930; // weak
HACCEL unk_417934; // idb
char byte_417937[]; // weak
CHAR Filename; // idb
int dword_417A3C; // weak
int dword_417A44; // weak
int dword_417A48; // weak
HWND hWnd; // idb
int dword_417A50; // weak
int dword_417A54; // weak


//----- (00401000) --------------------------------------------------------
int sub_401000()
{
  int result; // eax@1

  result = 0;
  byte_413BE0 = 1;
  word_413BE2 = 15;
  word_413BE4 = 0;
  byte_413BE6 = 0;
  byte_413BE7 = 0;
  word_413BE8 = 1000;
  word_413BEA = 1001;
  word_413BEC = 0;
  byte_413BEE = 0;
  byte_413BEF = 0;
  word_413BF0 = 0;
  byte_413BF2 = 0;
  dword_413BF8 = 2146304;
  dword_413BFC = 1474560;
  dword_413C00 = 0;
  dword_413C04 = 0;
  dword_413C08 = 2195456;
  dword_413C0C = 1490944;
  dword_413C10 = 0x4000;
  dword_413C14 = 2048;
  dword_413C18 = 49152;
  dword_413C1C = 22528;
  return result;
}
// 413BE0: using guessed type char byte_413BE0;
// 413BE2: using guessed type __int16 word_413BE2;
// 413BE4: using guessed type __int16 word_413BE4;
// 413BE6: using guessed type char byte_413BE6;
// 413BE7: using guessed type char byte_413BE7;
// 413BE8: using guessed type __int16 word_413BE8;
// 413BEA: using guessed type __int16 word_413BEA;
// 413BEC: using guessed type __int16 word_413BEC;
// 413BEE: using guessed type char byte_413BEE;
// 413BEF: using guessed type char byte_413BEF;
// 413BF0: using guessed type __int16 word_413BF0;
// 413BF2: using guessed type char byte_413BF2;
// 413BF8: using guessed type int dword_413BF8;
// 413BFC: using guessed type int dword_413BFC;
// 413C00: using guessed type int dword_413C00;
// 413C04: using guessed type int dword_413C04;
// 413C08: using guessed type int dword_413C08;
// 413C0C: using guessed type int dword_413C0C;
// 413C10: using guessed type int dword_413C10;
// 413C14: using guessed type int dword_413C14;
// 413C18: using guessed type int dword_413C18;
// 413C1C: using guessed type int dword_413C1C;

//----- (004010B0) --------------------------------------------------------
char __cdecl sub_4010B0(int a1)
{
  char result; // al@1
  int *v2; // eax@3
  int *v3; // ecx@5
  int v4; // [sp+4h] [bp-20h]@3
  int v5; // [sp+8h] [bp-1Ch]@3
  int v6; // [sp+Ch] [bp-18h]@3
  int v7; // [sp+10h] [bp-14h]@3
  int v8; // [sp+14h] [bp-10h]@5
  int v9; // [sp+18h] [bp-Ch]@5
  int v10; // [sp+1Ch] [bp-8h]@5
  int v11; // [sp+20h] [bp-4h]@5

  result = byte_413BE0;
  if ( byte_413BE0 )
  {
    if ( byte_413BEE == 2 )
    {
      v2 = &dword_412030[4 * (word_413BEC % 2)];
      v4 = *v2;
      v5 = v2[1];
      v6 = v2[2];
      v7 = v2[3];
    }
    else
    {
      v4 = dword_412030[0];
      v5 = dword_412034;
      v6 = dword_412038;
      v7 = dword_41203C;
    }
    v3 = &dword_412030[4 * byte_413BEF];
    v8 = *v3;
    v9 = v3[1];
    v10 = v3[2];
    v11 = v3[3];
    if ( byte_413BF2 )
    {
      v4 += 64;
      v10 += 64;
      v8 += 64;
      v6 += 64;
      sub_4024C0(
        (int)&unk_412680,
        dword_413BF8 / 1024 - *(_DWORD *)(a1 + 4) / 1024 + 32,
        dword_413BFC / 1024 - *(_DWORD *)(a1 + 8) / 1024,
        (int)&v4,
        byte_413BE7 + 100);
      result = sub_4024C0(
                 (int)&unk_412680,
                 dword_413BF8 / 1024 - *(_DWORD *)(a1 + 4) / 1024,
                 dword_413BFC / 1024 - *(_DWORD *)(a1 + 8) / 1024,
                 (int)&v8,
                 byte_413BE7 + 100);
    }
    else
    {
      sub_4024C0(
        (int)&unk_412680,
        dword_413BF8 / 1024 - *(_DWORD *)(a1 + 4) / 1024,
        dword_413BFC / 1024 - *(_DWORD *)(a1 + 8) / 1024,
        (int)&v4,
        byte_413BE7 + 100);
      result = sub_4024C0(
                 (int)&unk_412680,
                 dword_413BF8 / 1024 - *(_DWORD *)(a1 + 4) / 1024 + 32,
                 dword_413BFC / 1024 - *(_DWORD *)(a1 + 8) / 1024,
                 (int)&v8,
                 byte_413BE7 + 100);
    }
  }
  return result;
}
// 412030: using guessed type int dword_412030[];
// 412034: using guessed type int dword_412034;
// 412038: using guessed type int dword_412038;
// 41203C: using guessed type int dword_41203C;
// 413BE0: using guessed type char byte_413BE0;
// 413BE7: using guessed type char byte_413BE7;
// 413BEC: using guessed type __int16 word_413BEC;
// 413BEE: using guessed type char byte_413BEE;
// 413BEF: using guessed type char byte_413BEF;
// 413BF2: using guessed type char byte_413BF2;
// 413BF8: using guessed type int dword_413BF8;
// 413BFC: using guessed type int dword_413BFC;

//----- (00401340) --------------------------------------------------------
char __cdecl sub_401340(_BYTE *a1)
{
  signed int v1; // eax@5
  int v2; // ecx@6
  bool v3; // sf@6
  signed __int16 v4; // ax@13
  signed int v5; // eax@16
  int v6; // eax@17
  int v7; // ecx@20
  int v8; // esi@24
  bool v9; // zf@35
  bool v10; // sf@35
  bool v11; // sf@57
  unsigned __int8 v12; // of@57
  bool v13; // sf@61
  unsigned __int8 v14; // of@61
  signed int v15; // eax@67
  int v16; // eax@68
  int v17; // edx@68
  signed int v18; // eax@71
  int v19; // eax@72
  int v20; // edx@72
  signed int v21; // ecx@76

  if ( word_413BE4 > 0 )
    --word_413BE4;
  if ( !byte_413BEE )
  {
    v12 = __OFSUB__(dword_413BF8, dword_413C08);
    v11 = dword_413BF8 - dword_413C08 < 0;
    if ( dword_413BF8 > dword_413C08 )
    {
      v12 = __OFSUB__(dword_413BF8, dword_413C08);
      v11 = dword_413BF8 - dword_413C08 < 0;
      dword_413C00 -= 6;
    }
    if ( v11 ^ v12 )
      dword_413C00 += 6;
    v14 = __OFSUB__(dword_413BFC, dword_413C0C);
    v13 = dword_413BFC - dword_413C0C < 0;
    if ( dword_413BFC > dword_413C0C )
    {
      v14 = __OFSUB__(dword_413BFC, dword_413C0C);
      v13 = dword_413BFC - dword_413C0C < 0;
      dword_413C04 -= 4;
    }
    if ( v13 ^ v14 )
      dword_413C04 += 4;
    if ( dword_413C00 < 0 && BYTE3(dword_413BEF) == 1 )
    {
      BYTE3(dword_413BEF) = 0;
      v15 = sub_403820(a1);
      if ( v15 != 0xFFFFFF )
      {
        v16 = (int)&a1[36 * v15];
        *(_BYTE *)v16 = 1;
        *(_BYTE *)(v16 + 1) = 1;
        *(_BYTE *)(v16 + 2) = 0;
        *(_BYTE *)(v16 + 3) = 5;
        *(_DWORD *)(v16 + 4) = dword_413BF8 + 49152;
        v17 = dword_413BFC + 12288;
        *(_DWORD *)(v16 + 12) = 1024;
        *(_DWORD *)(v16 + 8) = v17;
        *(_DWORD *)(v16 + 16) = 512;
        *(_DWORD *)(v16 + 20) = 1024;
        *(_DWORD *)(v16 + 24) = -1024;
        *(_DWORD *)(v16 + 28) = 16;
        *(_DWORD *)(v16 + 32) = 12;
      }
    }
    if ( dword_413C00 > 0 && !BYTE3(dword_413BEF) )
    {
      BYTE3(dword_413BEF) = 1;
      v18 = sub_403820(a1);
      if ( v18 != 0xFFFFFF )
      {
        v19 = (int)&a1[36 * v18];
        *(_BYTE *)v19 = 1;
        *(_BYTE *)(v19 + 1) = 1;
        *(_BYTE *)(v19 + 2) = 0;
        *(_BYTE *)(v19 + 3) = 5;
        *(_DWORD *)(v19 + 4) = dword_413BF8 + 0x4000;
        v20 = dword_413BFC + 12288;
        *(_DWORD *)(v19 + 12) = -512;
        *(_DWORD *)(v19 + 8) = v20;
        *(_DWORD *)(v19 + 16) = -1024;
        *(_DWORD *)(v19 + 20) = 1024;
        *(_DWORD *)(v19 + 24) = -1024;
        *(_DWORD *)(v19 + 28) = 16;
        *(_DWORD *)(v19 + 32) = 12;
      }
    }
    v12 = __OFSUB__(*(_WORD *)((char *)&dword_413BEF + 1) + 1, 8);
    v9 = *(_WORD *)((char *)&dword_413BEF + 1) == 7;
    v3 = (signed __int16)((*(_WORD *)((char *)&dword_413BEF + 1))++ - 7) < 0;
    if ( !((unsigned __int8)(v3 ^ v12) | v9) )
    {
      *(_WORD *)((char *)&dword_413BEF + 1) = 0;
      v12 = __OFSUB__(dword_413BEF + 1, 9);
      v9 = (_BYTE)dword_413BEF == 8;
      v3 = (char)(dword_413BEF - 8) < 0;
      LOWORD(dword_413BEF) = (unsigned __int8)(dword_413BEF + 1);
      if ( !((unsigned __int8)(v3 ^ v12) | v9) )
        LOBYTE(dword_413BEF) = 2;
    }
    v21 = dword_413C00;
    if ( dword_413C00 <= 2048 )
    {
      if ( dword_413C00 >= -2048 )
        goto LABEL_81;
      v21 = -2048;
    }
    else
    {
      v21 = 2048;
    }
    dword_413C00 = v21;
LABEL_81:
    v1 = dword_413C04;
    if ( dword_413C04 <= 2048 )
    {
      if ( dword_413C04 >= -2048 )
      {
LABEL_86:
        dword_413BF8 += v21;
        dword_413BFC += v1;
        return v1;
      }
      v1 = -2048;
    }
    else
    {
      v1 = 2048;
    }
    dword_413C04 = v1;
    goto LABEL_86;
  }
  if ( byte_413BEE == 1 )
  {
    v7 = dword_413C00;
    if ( dword_413BF8 > dword_4170F4 )
    {
      v7 = dword_413C00 - 8;
      dword_413C00 -= 8;
    }
    if ( dword_413BF8 < dword_4170F4 )
    {
      v7 += 8;
      dword_413C00 = v7;
    }
    v8 = dword_413C04;
    if ( dword_413BFC > dword_4170F8 )
    {
      v8 = dword_413C04 - 8;
      dword_413C04 -= 8;
    }
    if ( dword_413BFC < dword_4170F8 )
    {
      v8 += 8;
      dword_413C04 = v8;
    }
    if ( word_413BEC > 0 && (--word_413BEC, word_413BEC > 0)
      || dword_413BFC >= dword_4170F8
      || dword_413BFC + 0x2000 <= dword_4170F8 )
    {
      v9 = v7 == 0;
      v10 = v7 < 0;
      if ( v7 >= 0 )
        goto LABEL_39;
    }
    else
    {
      v8 = 0;
      word_413BEC = 400;
      dword_413C04 = 0;
      byte_413BEE = 2;
      if ( dword_413BF8 + 24576 <= dword_4170F4 )
      {
        v7 = 0x4000;
        dword_413C00 = 0x4000;
LABEL_40:
        if ( !BYTE3(dword_413BEF) )
          BYTE3(dword_413BEF) = 1;
LABEL_42:
        LOBYTE(v1) = BYTE1(dword_413BEF) + 1;
        v12 = __OFSUB__(*(_WORD *)((char *)&dword_413BEF + 1) + 1, 4);
        v9 = *(_WORD *)((char *)&dword_413BEF + 1) == 3;
        v3 = (signed __int16)((*(_WORD *)((char *)&dword_413BEF + 1))++ - 3) < 0;
        if ( !((unsigned __int8)(v3 ^ v12) | v9) )
        {
          *(_WORD *)((char *)&dword_413BEF + 1) = 0;
          LOBYTE(v1) = dword_413BEF + 1;
          LOWORD(dword_413BEF) = (unsigned __int8)(dword_413BEF + 1);
        }
        if ( (char)dword_413BEF > 9 )
          LOBYTE(dword_413BEF) = 2;
        if ( v7 <= 2048 )
        {
          if ( v7 >= -2048 )
            goto LABEL_51;
          v7 = -2048;
        }
        else
        {
          v7 = 2048;
        }
        dword_413C00 = v7;
LABEL_51:
        if ( v8 <= 2048 )
        {
          if ( v8 >= -2048 )
          {
LABEL_56:
            dword_413BFC += v8;
            dword_413BF8 += v7;
            return v1;
          }
          v8 = -2048;
        }
        else
        {
          v8 = 2048;
        }
        dword_413C04 = v8;
        goto LABEL_56;
      }
      v7 = -16384;
      dword_413C00 = -16384;
    }
    if ( BYTE3(dword_413BEF) == 1 )
      BYTE3(dword_413BEF) = 0;
    v9 = v7 == 0;
    v10 = v7 < 0;
LABEL_39:
    if ( v10 || v9 )
      goto LABEL_42;
    goto LABEL_40;
  }
  LOBYTE(v1) = byte_413BEE - 2;
  if ( byte_413BEE == 2 )
  {
    v2 = dword_413C00;
    v3 = dword_413C00 < 0;
    if ( dword_413C00 > 0 )
    {
      v2 = dword_413C00 - 8;
      dword_413C00 = v2;
      v3 = v2 < 0;
    }
    if ( v3 )
    {
      v2 += 8;
      dword_413C00 = v2;
    }
    if ( v2 < 8 && v2 > -8 )
      byte_413BEE = 1;
    v4 = word_413BEC;
    if ( word_413BEC > 0 )
      v4 = word_413BEC-- - 1;
    if ( !(v4 % 5) )
    {
      v5 = sub_403820(a1);
      if ( v5 != 0xFFFFFF )
      {
        v6 = (int)&a1[36 * v5];
        *(_BYTE *)v6 = 1;
        *(_BYTE *)(v6 + 1) = 0;
        *(_BYTE *)(v6 + 2) = 0;
        *(_BYTE *)(v6 + 3) = 1;
        *(_DWORD *)(v6 + 4) = dword_413BF8 + 0x8000;
        *(_DWORD *)(v6 + 8) = dword_413BFC + 12288;
        *(_DWORD *)(v6 + 12) = -dword_413C00;
        *(_DWORD *)(v6 + 16) = -dword_413C00;
        *(_DWORD *)(v6 + 20) = 1024;
        *(_DWORD *)(v6 + 24) = -1024;
        *(_DWORD *)(v6 + 28) = 16;
        *(_DWORD *)(v6 + 32) = 12;
      }
      v2 = dword_413C00;
    }
    LOBYTE(v1) = dword_413C04;
    LOBYTE(dword_413BEF) = 2;
    dword_413BF8 += v2;
    dword_413BFC += dword_413C04;
  }
  return v1;
}
// 413BE4: using guessed type __int16 word_413BE4;
// 413BEC: using guessed type __int16 word_413BEC;
// 413BEE: using guessed type char byte_413BEE;
// 413BEF: using guessed type int dword_413BEF;
// 413BF8: using guessed type int dword_413BF8;
// 413BFC: using guessed type int dword_413BFC;
// 413C00: using guessed type int dword_413C00;
// 413C04: using guessed type int dword_413C04;
// 413C08: using guessed type int dword_413C08;
// 413C0C: using guessed type int dword_413C0C;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;

//----- (004017F0) --------------------------------------------------------
void __cdecl sub_4017F0(_BYTE *a1, char a2)
{
  bool v2; // sf@2
  signed int v3; // eax@4
  int v4; // eax@5
  int v5; // edx@5

  if ( !word_413BE4 )
  {
    v2 = (signed __int16)(word_413BE2 - a2) < 0;
    word_413BE2 -= a2;
    word_413BE4 = 100;
    if ( v2 )
      word_413BE2 = 0;
    v3 = sub_403820(a1);
    if ( v3 != 0xFFFFFF )
    {
      v4 = (int)&a1[36 * v3];
      *(_BYTE *)v4 = 1;
      *(_BYTE *)(v4 + 1) = 2;
      *(_BYTE *)(v4 + 2) = 10 - a2;
      *(_BYTE *)(v4 + 3) = 1;
      *(_DWORD *)(v4 + 4) = dword_413BF8 + 0x2000;
      v5 = dword_413BFC - 4096;
      *(_DWORD *)(v4 + 28) = 1;
      *(_DWORD *)(v4 + 8) = v5;
      *(_DWORD *)(v4 + 32) = 0;
    }
    sub_40A9C0(20, 1);
  }
}
// 413BE2: using guessed type __int16 word_413BE2;
// 413BE4: using guessed type __int16 word_413BE4;
// 413BF8: using guessed type int dword_413BF8;
// 413BFC: using guessed type int dword_413BFC;

//----- (00401890) --------------------------------------------------------
char __cdecl sub_401890(int a1, _BYTE *a2)
{
  char result; // al@1
  int v3; // esi@2
  int v4; // edi@2
  int v5; // edx@2
  int v6; // ecx@2
  int v7; // ebp@2
  int v8; // eax@7
  int v9; // ecx@14
  int v10; // edx@19
  int v11; // edi@19
  char v12; // [sp+Eh] [bp-2h]@1
  char v13; // [sp+Fh] [bp-1h]@1

  result = byte_413BE0;
  v12 = 0;
  v13 = 0;
  if ( byte_413BE0 )
  {
    v3 = dword_4170F4;
    v4 = dword_413BFC;
    v5 = dword_4170F8;
    v6 = dword_413BF8 + dword_413C18;
    v7 = dword_413C1C;
    if ( dword_4170F4 < dword_413BF8 + dword_413C18
      && dword_4170F4 > v6 - 5120
      && dword_4170F8 < dword_413BFC + dword_413C1C - 4096
      && dword_4170F8 + 0x4000 > dword_413C14 + dword_413BFC + 4096 )
    {
      v3 = dword_413BF8 + dword_413C18;
      dword_4170FC = 0;
      dword_4170F4 = dword_413BF8 + dword_413C18;
      v12 = 1;
      v13 = 1;
    }
    v8 = dword_413BFC + dword_413C1C;
    if ( dword_4170F8 < dword_413BFC + dword_413C1C
      && dword_4170F8 > v8 - 5120
      && v3 < v6 - 4096
      && v3 + 0x4000 > dword_413C10 + dword_413BF8 + 4096 )
    {
      if ( dword_417100 < -100 )
      {
        sub_40A9C0(4, 1);
        v7 = dword_413C1C;
        v4 = dword_413BFC;
        v3 = dword_4170F4;
      }
      v8 = v4 + v7;
      v5 = v4 + v7;
      dword_4170F8 = v4 + v7;
      dword_417100 = 0;
      v12 |= 2u;
      v13 = 1;
    }
    v9 = dword_413BF8 + dword_413C10;
    if ( v3 + 0x4000 > dword_413BF8 + dword_413C10
      && v3 + 0x4000 < v9 + 5120
      && v5 < v8 - 4096
      && v5 + 0x4000 > dword_413C14 + v4 + 4096 )
    {
      v3 = v9 - 0x4000;
      dword_4170F4 = v9 - 0x4000;
      dword_4170FC = 0;
      v12 |= 4u;
      v13 = 1;
    }
    v10 = v5 + 0x4000;
    v11 = dword_413C14 + v4;
    if ( v10 <= v11 || v10 >= v11 + 5120 || v3 >= dword_413C18 + dword_413BF8 - 4096 || v3 + 0x4000 <= v9 + 4096 )
    {
      result = v13;
      if ( !v13 )
        return result;
    }
    else
    {
      byte_417117 = 0;
      dword_4170F8 = v11 - 0x4000;
      if ( dword_417100 > 0 )
        dword_417100 = 0;
      v12 |= 8u;
    }
    if ( byte_413BEE )
    {
      if ( byte_413BEE == 1 )
      {
        if ( !word_413BE4 )
        {
          if ( v12 & 2 )
          {
            dword_413C04 = -1024;
            dword_417100 = 1024;
            if ( byte_4170F2 == 1 )
              sub_4017F0(a2, 3);
            else
              sub_4017F0(a2, 1);
          }
          else if ( byte_4170F2 == 1 )
          {
            if ( byte_417116 )
            {
              if ( byte_417116 == 1 )
                dword_413C00 = 1024;
              sub_4017F0(a2, 3);
            }
            else
            {
              dword_413C00 = -1024;
              sub_4017F0(a2, 3);
            }
          }
        }
      }
      else if ( byte_413BEE == 2 )
      {
        if ( v12 & 2 )
        {
          dword_413C04 = -1024;
          dword_417100 = 1024;
          if ( byte_4170F2 == 1 )
            sub_4017F0(a2, 3);
          else
            sub_4017F0(a2, 1);
        }
        else if ( !word_417108 )
        {
          if ( v3 < dword_413BF8 + 24576 )
            dword_4170FC = -1024;
          if ( v3 > dword_413BF8 + 24576 )
            dword_4170FC = 1024;
          sub_409030(a2, 3);
        }
      }
    }
    else if ( !word_41710A )
    {
      *(_BYTE *)a1 = 1;
      *(_WORD *)(a1 + 28) = 4;
      *(_DWORD *)(a1 + 16) = word_413BE8;
      word_41710A = 100;
    }
    result = byte_413BEE;
    if ( byte_413BEE )
    {
      result = 0;
      if ( !word_413BE2 )
      {
        *(_BYTE *)a1 = 1;
        *(_WORD *)(a1 + 28) = 4;
        *(_DWORD *)(a1 + 16) = word_413BEA;
        word_41710A = 100;
        byte_413BEE = 0;
        word_413BE4 = 0;
        dword_413C00 = 0;
        dword_413C04 = 0;
      }
    }
  }
  return result;
}
// 413BE0: using guessed type char byte_413BE0;
// 413BE2: using guessed type __int16 word_413BE2;
// 413BE4: using guessed type __int16 word_413BE4;
// 413BE8: using guessed type __int16 word_413BE8;
// 413BEA: using guessed type __int16 word_413BEA;
// 413BEE: using guessed type char byte_413BEE;
// 413BF8: using guessed type int dword_413BF8;
// 413BFC: using guessed type int dword_413BFC;
// 413C00: using guessed type int dword_413C00;
// 413C04: using guessed type int dword_413C04;
// 413C10: using guessed type int dword_413C10;
// 413C14: using guessed type int dword_413C14;
// 413C18: using guessed type int dword_413C18;
// 413C1C: using guessed type int dword_413C1C;
// 4170F2: using guessed type char byte_4170F2;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417108: using guessed type __int16 word_417108;
// 41710A: using guessed type __int16 word_41710A;
// 417116: using guessed type char byte_417116;
// 417117: using guessed type char byte_417117;

//----- (00401C50) --------------------------------------------------------
FILE *__cdecl sub_401C50(void *a1)
{
  FILE *result; // eax@1
  FILE *v2; // esi@1
  char v3; // [sp+4h] [bp-104h]@1

  sprintf(&v3, aSS, &Filename, off_4120D0);
  result = fopen(&v3, aWb);
  v2 = result;
  if ( result )
  {
    fwrite(a1, 8u, 1u, result);
    fclose(v2);
    result = (FILE *)1;
  }
  return result;
}
// 4120D0: using guessed type char *off_4120D0;

//----- (00401CC0) --------------------------------------------------------
FILE *__cdecl sub_401CC0(void *a1)
{
  FILE *result; // eax@1
  FILE *v2; // esi@1
  char v3; // [sp+8h] [bp-104h]@1

  *(_DWORD *)a1 = 0;
  *((_DWORD *)a1 + 1) = 0;
  sprintf(&v3, aSS, &Filename, off_4120D0);
  result = fopen(&v3, aRb);
  v2 = result;
  if ( result )
  {
    fread(a1, 8u, 1u, result);
    fclose(v2);
    result = (FILE *)1;
  }
  return result;
}
// 4120D0: using guessed type char *off_4120D0;

//----- (00401D40) --------------------------------------------------------
LRESULT __cdecl sub_401D40(HWND hDlg)
{
  LPARAM *v1; // esi@1
  signed int v2; // ebp@1
  char v4; // [sp+10h] [bp-14h]@3
  WPARAM wParam; // [sp+14h] [bp-10h]@4
  char *v6; // [sp+18h] [bp-Ch]@1
  char *v7; // [sp+1Ch] [bp-8h]@1
  char *v8; // [sp+20h] [bp-4h]@1

  v6 = aFullscreen;
  v7 = a320x240Windowe;
  v8 = a640x480Windowe;
  v1 = (LPARAM *)&v6;
  v2 = 3;
  do
  {
    SendDlgItemMessageA(hDlg, 1003, 0x143u, 0, *v1);
    ++v1;
    --v2;
  }
  while ( v2 );
  if ( !sub_401CC0(&v4) )
    wParam = 0;
  return SendDlgItemMessageA(hDlg, 1003, 0x14Eu, wParam, 0);
}

//----- (00401DC0) --------------------------------------------------------
FILE *__cdecl sub_401DC0(HWND hDlg)
{
  LRESULT v1; // eax@1
  char v3; // [sp+0h] [bp-8h]@1
  LRESULT v4; // [sp+4h] [bp-4h]@1

  v1 = SendDlgItemMessageA(hDlg, 1003, 0x147u, 2u, 0);
  dword_417A54 = v1;
  v4 = v1;
  return sub_401C50(&v3);
}
// 417A54: using guessed type int dword_417A54;

//----- (00401E00) --------------------------------------------------------
BOOL __stdcall DialogFunc(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4)
{
  BOOL result; // eax@5

  if ( a2 == 272 )
  {
    sub_401D40(hDlg);
    result = 1;
  }
  else
  {
    if ( a2 == 273 )
    {
      if ( (unsigned __int16)a3 == 1 )
      {
        sub_401DC0(hDlg);
        EndDialog(hDlg, 1);
      }
      else if ( (unsigned __int16)a3 == 2 )
      {
        EndDialog(hDlg, 0);
        return 0;
      }
    }
    result = 0;
  }
  return result;
}

//----- (00401E70) --------------------------------------------------------
int __cdecl sub_401E70(int a1, int a2)
{
  int result; // eax@1

  result = a1;
  dword_413C24 = a1;
  dword_413C20 = a2;
  return result;
}
// 413C20: using guessed type int dword_413C20;
// 413C24: using guessed type int dword_413C24;

//----- (00401E90) --------------------------------------------------------
int __cdecl sub_401E90(HWND hWnd)
{
  LONG v1; // eax@1
  DWORD v2; // eax@4
  struct tagRECT Rect; // [sp+4h] [bp-10h]@1

  GetWindowRect(hWnd, &Rect);
  Rect.left += dword_413C24;
  v1 = dword_413C20 + Rect.top + dword_413C54;
  Rect.top += dword_413C20;
  Rect.right = Rect.left + dword_413C50;
  Rect.bottom = v1;
  while ( GetTickCount() < dword_413C28 + 20 )
    ;
  if ( dword_413C28 + 100 >= GetTickCount() )
    v2 = dword_413C28 + 20;
  else
    v2 = GetTickCount();
  dword_413C28 = v2;
  return (*(int (__stdcall **)(int, struct tagRECT *, int, int *, signed int, _DWORD))(*(_DWORD *)dword_413C60 + 20))(
           dword_413C60,
           &Rect,
           dword_413C64,
           &dword_413C38,
           0x1000000,
           0);
}
// 413C20: using guessed type int dword_413C20;
// 413C24: using guessed type int dword_413C24;
// 413C28: using guessed type int dword_413C28;
// 413C38: using guessed type int dword_413C38;
// 413C50: using guessed type int dword_413C50;
// 413C54: using guessed type int dword_413C54;
// 413C60: using guessed type int dword_413C60;
// 413C64: using guessed type int dword_413C64;

//----- (00401F50) --------------------------------------------------------
signed int __cdecl Init_Direct_Draw(HWND a1, int a2)
{
  signed int result; // eax@2
  int v3; // [sp+2Ch] [bp-6Ch]@9
  int v4; // [sp+30h] [bp-68h]@9
  int v5; // [sp+34h] [bp-64h]@11
  int v6; // [sp+38h] [bp-60h]@11
  int v7; // [sp+40h] [bp-58h]@9
  int v8; // [sp+94h] [bp-4h]@9

  if ( DirectDrawCreate(NULL, &Direct_Draw_Obj, NULL) )
  {
    result = 0;
  }
  else
  {
    if ( a2 )
    {
      if ( a2 == 1 )
      {
        dword_412128 = 1;
        dword_413C58 = 0;
        (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 20))(Direct_Draw_Obj, a1, 8);
      }
      else if ( a2 == 2 )
      {
        dword_412128 = 2;
        dword_413C58 = 0;
        (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 20))(Direct_Draw_Obj, a1, 8);
      }
    }
    else
    {
      dword_412128 = 2;
      dword_413C58 = 1;
      (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 20))(Direct_Draw_Obj, a1, 17);
      (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 21))(
        Direct_Draw_Obj,
        320 * dword_412128,
        240 * dword_412128,
        16);
    }
    dword_413C40 = 320 * dword_412128;
    dword_413C44 = 240 * dword_412128;
    dword_413C50 = 320 * dword_412128;
    dword_413C54 = 240 * dword_412128;
    dword_413C38 = 0;
    memset(&v3, 0, 0x6Cu);
    dword_413C3C = 0;
    v3 = 108;
    v4 = 1;
    v8 = 512;
    v7 = 0;
    if ( (*((int (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 6))(
           Direct_Draw_Obj,
           &v3,
           &dword_413C60,
           0) )
    {
      result = 0;
    }
    else
    {
      memset(&v3, 0, 0x6Cu);
      v3 = 108;
      v4 = 7;
      v8 = 64;
      v5 = 240 * dword_412128;
      v6 = 320 * dword_412128;
      if ( (*((int (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 6))(
             Direct_Draw_Obj,
             &v3,
             &dword_413C64,
             0) )
      {
        result = 0;
      }
      else
      {
        (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 4))(
          Direct_Draw_Obj,
          0,
          &dword_413C30,
          0);
        (*(void (__stdcall **)(int, _DWORD, HWND))(*(_DWORD *)dword_413C30 + 32))(dword_413C30, 0, a1);
        (*(void (__stdcall **)(int, int))(*(_DWORD *)dword_413C60 + 112))(dword_413C60, dword_413C30);
        result = 1;
      }
    }
  }
  return result;
}
// 412128: using guessed type int dword_412128;
// 413C30: using guessed type int dword_413C30;
// 413C38: using guessed type int dword_413C38;
// 413C3C: using guessed type int dword_413C3C;
// 413C40: using guessed type int dword_413C40;
// 413C44: using guessed type int dword_413C44;
// 413C50: using guessed type int dword_413C50;
// 413C54: using guessed type int dword_413C54;
// 413C58: using guessed type int dword_413C58;
// 413C60: using guessed type int dword_413C60;
// 413C64: using guessed type int dword_413C64;

//----- (00402140) --------------------------------------------------------
LPDIRECTDRAW __cdecl sub_402140(int a1)
{
  int *v1; // esi@1
  LPDIRECTDRAW result; // eax@9

  v1 = dword_413C68;
  do
  {
    if ( *v1 )
    {
      (*(void (__stdcall **)(int))(*(_DWORD *)*v1 + 8))(*v1);
      *v1 = 0;
    }
    ++v1;
  }
  while ( (signed int)v1 < (signed int)&unk_414468 );
  if ( dword_413C60 )
    (*(void (__stdcall **)(int))(*(_DWORD *)dword_413C60 + 8))(dword_413C60);
  if ( dword_413C58 )
    (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 20))(Direct_Draw_Obj, a1, 8);
  result = Direct_Draw_Obj;
  if ( Direct_Draw_Obj )
    result = (LPDIRECTDRAW)(*((int (__stdcall **)(_DWORD))Direct_Draw_Obj->lpVtbl + 2))(Direct_Draw_Obj);
  return result;
}
// 413C58: using guessed type int dword_413C58;
// 413C60: using guessed type int dword_413C60;
// 413C68: using guessed type int dword_413C68[];

//----- (004021A0) --------------------------------------------------------
int __cdecl sub_4021A0(int a1)
{
  int result; // eax@1

  result = dword_413C68[a1];
  if ( result )
  {
    result = (*(int (__stdcall **)(int))(*(_DWORD *)result + 8))(dword_413C68[a1]);
    dword_413C68[a1] = 0;
  }
  return result;
}
// 413C68: using guessed type int dword_413C68[];

//----- (004021D0) --------------------------------------------------------
HANDLE __cdecl sub_4021D0(int a1, signed int a2)
{
  HANDLE result; // eax@2
  HMODULE v3; // eax@5
  void *v4; // ebp@5
  int v5; // edi@6
  HDC v6; // esi@6
  HDC hdcDest; // [sp+1Ch] [bp-1B8h]@6
  HGDIOBJ h; // [sp+20h] [bp-1B4h]@6
  int v9; // [sp+24h] [bp-1B0h]@6
  int v10; // [sp+28h] [bp-1ACh]@6
  int wSrc; // [sp+34h] [bp-1A0h]@6
  int hSrc; // [sp+38h] [bp-19Ch]@6
  char pv; // [sp+3Ch] [bp-198h]@6
  int v14; // [sp+40h] [bp-194h]@6
  int v15; // [sp+44h] [bp-190h]@6
  int hDest; // [sp+60h] [bp-174h]@6
  int v17; // [sp+64h] [bp-170h]@6
  int v18; // [sp+68h] [bp-16Ch]@6
  int v19; // [sp+6Ch] [bp-168h]@6
  int v20; // [sp+70h] [bp-164h]@6
  int v21; // [sp+CCh] [bp-108h]@6
  CHAR name; // [sp+D0h] [bp-104h]@1

  sprintf(&name, aSS, &Filename, a1);
  if ( a2 <= 512 )
  {
    if ( dword_413C68[a2] )
    {
      result = NULL;
    }
    else
    {
      v3 = GetModuleHandleA(NULL);
      result = LoadImageA(v3, &name, 0, 0, 0, 0x2010u);
      v4 = result;
      if ( result )
      {
        GetObjectA(result, 24, &pv);
        memset(&v17, 0, 0x6Cu);
        v17 = 108;
        v19 = v15 * dword_412128;
        v20 = v14 * dword_412128;
        v18 = 7;
        v21 = 64;
        (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 6))(
          Direct_Draw_Obj,
          &v17,
          4 * a2 + 4275304,
          0);
        wSrc = v14;
        hSrc = v15;
        v5 = v14 * dword_412128;
        hDest = v15 * dword_412128;
        v6 = CreateCompatibleDC(NULL);
        h = SelectObject(v6, v4);
        (*(void (__stdcall **)(int, HDC *))(*(_DWORD *)dword_413C68[a2] + 68))(dword_413C68[a2], &hdcDest);
        StretchBlt(hdcDest, 0, 0, v5, hDest, v6, 0, 0, wSrc, hSrc, 0xCC0020u);
        (*(void (__stdcall **)(int, HDC))(*(_DWORD *)dword_413C68[a2] + 104))(dword_413C68[a2], hdcDest);
        SelectObject(v6, h);
        DeleteDC(v6);
        v9 = 0;
        v10 = 0;
        (*(void (__stdcall **)(int, signed int, int *))(*(_DWORD *)dword_413C68[a2] + 116))(dword_413C68[a2], 8, &v9);
        DeleteObject(v4);
        result = HANDLE_FLAG_INHERIT;
      }
    }
  }
  else
  {
    result = NULL;
  }
  return result;
}
// 412128: using guessed type int dword_412128;
// 413C68: using guessed type int dword_413C68[];

//----- (00402380) --------------------------------------------------------
signed int __cdecl sub_402380(int a1, int a2, signed int a3)
{
  signed int result; // eax@2
  int v4; // esi@5
  int v5; // [sp+10h] [bp-74h]@5
  int v6; // [sp+14h] [bp-70h]@5
  int v7; // [sp+18h] [bp-6Ch]@5
  int v8; // [sp+1Ch] [bp-68h]@5
  int v9; // [sp+20h] [bp-64h]@5
  int v10; // [sp+24h] [bp-60h]@5
  int v11; // [sp+80h] [bp-4h]@5

  if ( a3 <= 512 )
  {
    if ( dword_413C68[a3] )
    {
      result = 0;
    }
    else
    {
      memset(&v7, 0, 0x6Cu);
      v9 = a2 * dword_412128;
      v10 = a1 * dword_412128;
      v7 = 108;
      v8 = 7;
      v11 = 64;
      (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))Direct_Draw_Obj->lpVtbl + 6))(
        Direct_Draw_Obj,
        &v7,
        4 * a3 + 4275304,
        0);
      v4 = dword_413C68[a3];
      v5 = 0;
      v6 = 0;
      (*(void (__stdcall **)(int, signed int, int *))(*(_DWORD *)v4 + 116))(v4, 8, &v5);
      result = 1;
    }
  }
  else
  {
    result = 0;
  }
  return result;
}
// 412128: using guessed type int dword_412128;
// 413C68: using guessed type int dword_413C68[];

//----- (00402440) --------------------------------------------------------
int __cdecl sub_402440(int a1, int a2)
{
  int v2; // edx@1
  int v4; // [sp+4h] [bp-74h]@1
  int v5; // [sp+8h] [bp-70h]@1
  int v6; // [sp+Ch] [bp-6Ch]@1
  int v7; // [sp+10h] [bp-68h]@1
  int v8; // [sp+14h] [bp-64h]@1

  memset(&v8, 0, 0x64u);
  v8 = 100;
  v4 = dword_412128 * *(_DWORD *)a2;
  v5 = dword_412128 * *(_DWORD *)(a2 + 4);
  v2 = dword_412128 * *(_DWORD *)(a2 + 8);
  v7 = dword_412128 * *(_DWORD *)(a2 + 12);
  v6 = v2;
  return (*(int (__stdcall **)(int, int *, int, int *, signed int, int *))(*(_DWORD *)dword_413C68[a1] + 20))(
           dword_413C68[a1],
           &v4,
           dword_413C64,
           &v4,
           0x1000000,
           &v8);
}
// 412128: using guessed type int dword_412128;
// 413C64: using guessed type int dword_413C64;
// 413C68: using guessed type int dword_413C68[];

//----- (004024C0) --------------------------------------------------------
int __cdecl sub_4024C0(int a1, int a2, int a3, int a4, int a5)
{
  int v5; // edi@1
  int v6; // ebx@1
  int v7; // eax@1
  int v8; // eax@3
  int v9; // edx@5
  int v10; // ecx@5
  int v11; // eax@5
  int v12; // esi@5
  int v13; // eax@7
  int v14; // ecx@9
  int v15; // edx@9
  int v17; // [sp+10h] [bp-20h]@1
  int v18; // [sp+14h] [bp-1Ch]@1
  int v19; // [sp+18h] [bp-18h]@1
  int v20; // [sp+1Ch] [bp-14h]@9
  int v21; // [sp+20h] [bp-10h]@9
  int v22; // [sp+24h] [bp-Ch]@9
  int v23; // [sp+28h] [bp-8h]@9
  int v24; // [sp+2Ch] [bp-4h]@9

  v17 = *(_DWORD *)a4;
  v5 = a2;
  v18 = *(_DWORD *)(a4 + 4);
  v19 = *(_DWORD *)(a4 + 8);
  v6 = *(_DWORD *)(a4 + 12);
  v7 = *(_DWORD *)(a1 + 8);
  if ( a2 + *(_DWORD *)(a4 + 8) - v17 > v7 )
    v19 += v17 + v7 - *(_DWORD *)(a4 + 8) - a2;
  v8 = *(_DWORD *)a1;
  if ( a2 < *(_DWORD *)a1 )
  {
    v17 += v8 - a2;
    v5 = v8;
  }
  v9 = *(_DWORD *)(a4 + 12);
  v10 = *(_DWORD *)(a4 + 4);
  v11 = *(_DWORD *)(a1 + 12);
  v12 = a3;
  if ( a3 + v9 - v10 > v11 )
    v6 += v10 + v11 - v9 - a3;
  v13 = *(_DWORD *)(a1 + 4);
  if ( a3 < v13 )
  {
    v12 = *(_DWORD *)(a1 + 4);
    v18 += v13 - a3;
  }
  v14 = v5 + v19 - v17;
  v24 = (v12 + v6 - v18) * dword_412128;
  v17 *= dword_412128;
  v19 *= dword_412128;
  v20 = v6 * dword_412128;
  v15 = dword_413C68[a5];
  v21 = v5 * dword_412128;
  v22 = v12 * dword_412128;
  v23 = v14 * dword_412128;
  v18 *= dword_412128;
  return (*(int (__stdcall **)(int, int *, int, int *, signed int, _DWORD))(*(_DWORD *)dword_413C64 + 20))(
           dword_413C64,
           &v21,
           v15,
           &v17,
           16809984,
           0);
}
// 412128: using guessed type int dword_412128;
// 413C64: using guessed type int dword_413C64;
// 413C68: using guessed type int dword_413C68[];

//----- (00402600) --------------------------------------------------------
int __cdecl sub_402600(int a1, int a2)
{
  int v2; // eax@1
  int v4; // [sp+4h] [bp-74h]@1
  int v5; // [sp+8h] [bp-70h]@1
  int v6; // [sp+Ch] [bp-6Ch]@1
  int v7; // [sp+10h] [bp-68h]@1
  int v8; // [sp+14h] [bp-64h]@1
  int v9; // [sp+64h] [bp-14h]@1

  memset(&v8, 0, 0x64u);
  v9 = a2;
  v8 = 100;
  v4 = dword_412128 * *(_DWORD *)a1;
  v5 = dword_412128 * *(_DWORD *)(a1 + 4);
  v2 = dword_412128 * *(_DWORD *)(a1 + 12);
  v6 = dword_412128 * *(_DWORD *)(a1 + 8);
  v7 = v2;
  return (*(int (__stdcall **)(int, int *, _DWORD, _DWORD, signed int, int *))(*(_DWORD *)dword_413C64 + 20))(
           dword_413C64,
           &v4,
           0,
           0,
           16778240,
           &v8);
}
// 412128: using guessed type int dword_412128;
// 413C64: using guessed type int dword_413C64;

//----- (00402680) --------------------------------------------------------
int __cdecl sub_402680(int a1, int a2, int a3)
{
  int v3; // edx@1
  int v5; // [sp+4h] [bp-74h]@1
  int v6; // [sp+8h] [bp-70h]@1
  int v7; // [sp+Ch] [bp-6Ch]@1
  int v8; // [sp+10h] [bp-68h]@1
  int v9; // [sp+14h] [bp-64h]@1
  int v10; // [sp+64h] [bp-14h]@1

  memset(&v9, 0, 0x64u);
  v10 = a2;
  v9 = 100;
  v5 = dword_412128 * *(_DWORD *)a1;
  v6 = dword_412128 * *(_DWORD *)(a1 + 4);
  v3 = dword_412128 * *(_DWORD *)(a1 + 8);
  v8 = dword_412128 * *(_DWORD *)(a1 + 12);
  v7 = v3;
  return (*(int (__stdcall **)(int, int *, _DWORD, _DWORD, signed int, int *))(*(_DWORD *)dword_413C68[a3] + 20))(
           dword_413C68[a3],
           &v5,
           0,
           0,
           16778240,
           &v9);
}
// 412128: using guessed type int dword_412128;
// 413C68: using guessed type int dword_413C68[];

//----- (00402710) --------------------------------------------------------
HFONT __cdecl sub_402710(LPCSTR pszFaceName)
{
  LPCSTR v1; // eax@3
  LPCSTR v2; // ecx@3
  HFONT result; // eax@6

  if ( dword_412128 == 1 )
  {
    v1 = (LPCSTR)12;
    v2 = (LPCSTR)6;
  }
  else if ( dword_412128 == 2 )
  {
    v1 = (LPCSTR)20;
    v2 = (LPCSTR)10;
  }
  else
  {
    v1 = pszFaceName;
    v2 = pszFaceName;
  }
  result = CreateFontA((int)v1, (int)v2, 0, 0, 400, 0, 0, 0, 1u, 4u, 0, 0, 1u, pszFaceName);
  ho = result;
  return result;
}
// 412128: using guessed type int dword_412128;

//----- (00402770) --------------------------------------------------------
int __cdecl sub_402770(int a1, int a2, LPCSTR lpString, COLORREF color, HDC hdc)
{
  HDC v5; // esi@1
  HGDIOBJ v6; // ebp@1

  v5 = hdc;
  (*(void (__stdcall **)(int, HDC *))(*(_DWORD *)dword_413C68[(signed int)hdc] + 68))(
    dword_413C68[(signed int)hdc],
    &hdc);
  v6 = SelectObject(hdc, ho);
  SetBkMode(hdc, 1);
  SetTextColor(hdc, color);
  TextOutA(hdc, a1 * dword_412128, a2 * dword_412128, lpString, strlen(lpString));
  SelectObject(hdc, v6);
  return (*(int (__stdcall **)(int, HDC))(*(_DWORD *)dword_413C68[(signed int)v5] + 104))(
           dword_413C68[(signed int)v5],
           hdc);
}
// 412128: using guessed type int dword_412128;
// 413C68: using guessed type int dword_413C68[];

//----- (00402820) --------------------------------------------------------
int sub_402820()
{
  int result; // eax@1

  dword_416C6C = 144;
  dword_416C70 = 104;
  SetCursorPos(144, 104);
  result = dword_416C6C;
  dword_416C7C = dword_416C6C;
  dword_416C80 = dword_416C70;
  return result;
}
// 416C6C: using guessed type int dword_416C6C;
// 416C70: using guessed type int dword_416C70;
// 416C7C: using guessed type int dword_416C7C;
// 416C80: using guessed type int dword_416C80;

//----- (00402860) --------------------------------------------------------
int sub_402860()
{
  struct tagPOINT Point; // [sp+8h] [bp-8h]@1

  GetCursorPos(&Point);
  dword_416C7C += Point.x - qword_416C6C;
  dword_416C80 += Point.y - HIDWORD(qword_416C6C);
  qword_416C6C = (__int64)Point;
  return sub_4024C0((int)&unk_412680, dword_416C7C, dword_416C80, (int)&unk_412130, 14);
}
// 416C6C: using guessed type __int64 qword_416C6C;
// 416C7C: using guessed type int dword_416C7C;
// 416C80: using guessed type int dword_416C80;

//----- (004028D0) --------------------------------------------------------
int __cdecl sub_4028D0(int a1, int a2)
{
  int v2; // esi@1
  int result; // eax@1
  __int64 v4; // rax@2
  int v5; // ebx@2
  __int64 v6; // rax@2
  __int64 v7; // rax@2
  int v8; // ecx@2
  __int64 v9; // rax@2

  v2 = a2;
  dword_416C74 = dword_416C7C + *(_DWORD *)(a2 + 4) / 1024;
  dword_416C78 = dword_416C80 + *(_DWORD *)(a2 + 8) / 1024;
  dword_416C84 = dword_416C74 / 16;
  dword_416C88 = dword_416C78 / 16;
  sub_4024C0(
    (int)&unk_412680,
    16 * (dword_416C74 / 16) - *(_DWORD *)(a2 + 4) / 1024,
    16 * (dword_416C78 / 16) - *(_DWORD *)(a2 + 8) / 1024,
    (int)&unk_412140,
    14);
  sub_403CC0(
    16 * dword_416C84 - *(_DWORD *)(v2 + 4) / 1024 - 24,
    16 * dword_416C88 - *(_DWORD *)(v2 + 8) / 1024,
    dword_416C84);
  sub_403CC0(
    16 * dword_416C84 - *(_DWORD *)(v2 + 4) / 1024 - 24,
    16 * dword_416C88 - *(_DWORD *)(v2 + 8) / 1024 + 8,
    dword_416C88);
  result = word_416C6A;
  if ( *(_BYTE *)(a1 + 40 * word_416C6A) )
  {
    sub_4024C0(
      (int)&unk_412680,
      16 * dword_416C8C - *(_DWORD *)(a2 + 4) / 1024,
      16 * dword_416C90 - *(_DWORD *)(a2 + 8) / 1024,
      (int)&unk_412160,
      14);
    sub_403CC0(
      16 * dword_416C8C - *(_DWORD *)(a2 + 4) / 1024 - 24,
      16 * dword_416C90 - *(_DWORD *)(a2 + 8) / 1024,
      dword_416C8C);
    sub_403CC0(
      16 * dword_416C8C - *(_DWORD *)(a2 + 4) / 1024 - 24,
      16 * dword_416C90 - *(_DWORD *)(a2 + 8) / 1024 + 8,
      dword_416C90);
    v4 = *(_DWORD *)(a1 + 40 * word_416C6A + 36);
    v5 = (((WORD2(v4) & 0x3FF) + (signed int)v4) >> 10) - *(_DWORD *)(a2 + 8) / 1024;
    v6 = *(_DWORD *)(a1 + 40 * word_416C6A + 32);
    sub_4024C0(
      (int)&unk_412680,
      (((WORD2(v6) & 0x3FF) + (signed int)v6) >> 10) - *(_DWORD *)(a2 + 4) / 1024,
      v5,
      (int)&unk_412150,
      14);
    v7 = *(_DWORD *)(a1 + 40 * word_416C6A + 32);
    v8 = ((WORD2(v7) & 0x3FF) + (signed int)v7) >> 10;
    v9 = *(_DWORD *)(a1 + 40 * word_416C6A + 36);
    sub_403CC0(
      v8 - *(_DWORD *)(a2 + 4) / 1024 - 8,
      (((WORD2(v9) & 0x3FF) + (signed int)v9) >> 10) - *(_DWORD *)(a2 + 8) / 1024 - 16,
      v8 / 16);
    result = sub_403CC0(
               *(_DWORD *)(a1 + 40 * word_416C6A + 32) / 1024 - *(_DWORD *)(a2 + 4) / 1024 - 8,
               *(_DWORD *)(a1 + 40 * word_416C6A + 36) / 1024 - *(_DWORD *)(a2 + 8) / 1024 - 8,
               *(_DWORD *)(a1 + 40 * word_416C6A + 36) / 1024 / 16);
  }
  return result;
}
// 416C6A: using guessed type __int16 word_416C6A;
// 416C74: using guessed type int dword_416C74;
// 416C78: using guessed type int dword_416C78;
// 416C7C: using guessed type int dword_416C7C;
// 416C80: using guessed type int dword_416C80;
// 416C84: using guessed type int dword_416C84;
// 416C88: using guessed type int dword_416C88;
// 416C8C: using guessed type int dword_416C8C;
// 416C90: using guessed type int dword_416C90;

//----- (00402C20) --------------------------------------------------------
char __cdecl sub_402C20(int a1)
{
  _BYTE *v1; // eax@2
  signed int v2; // ecx@8
  __int16 v3; // ax@14
  bool v4; // sf@14
  unsigned __int8 v5; // of@14
  int v6; // ecx@16
  __int64 v7; // rax@16
  __int64 v8; // rax@16
  signed int v9; // ecx@41
  __int64 v10; // rax@49
  __int64 v11; // rax@49
  signed int v12; // edi@70
  signed int *v13; // esi@70

  if ( byte_416C68 )
  {
    LOBYTE(v1) = byte_416C68 - 1;
    if ( byte_416C68 == 1 )
    {
      *(_DWORD *)(a1 + 40 * word_416C6A + 32) = dword_416C84 << 14;
      *(_DWORD *)(a1 + 40 * word_416C6A + 36) = dword_416C88 << 14;
      LOBYTE(v1) = dword_417A48;
      if ( !(dword_417A48 & 2) )
      {
        LOBYTE(v1) = sub_40A9C0(7, 1);
        byte_416C68 = 0;
      }
    }
  }
  else
  {
    LOBYTE(v1) = dword_416CA8;
    if ( dword_416CA8 & 2 )
    {
      v1 = (_BYTE *)dword_416C7C;
      if ( dword_416C7C <= 8 || dword_416C7C >= 224 || (v2 = dword_416C80, dword_416C80 <= 8) || dword_416C80 >= 40 )
      {
        sub_40A9C0(6, 1);
        dword_416C90 = dword_416C88;
        byte_416C68 = 1;
        dword_416C8C = dword_416C84;
        LOBYTE(v1) = a1;
        *(_BYTE *)(a1 + 40 * word_416C6A) = 1;
        *(_DWORD *)(a1 + 40 * word_416C6A + 16) = dword_416C8C << 14;
        *(_DWORD *)(a1 + 40 * word_416C6A + 20) = dword_416C90 << 14;
      }
      else
      {
        if ( dword_416C7C > 60 )
        {
          if ( dword_416C7C < 84 && dword_416C80 > 16 && dword_416C80 < 24 )
          {
            sub_40A9C0(1, 1);
            v3 = word_416C6A + 1;
            v5 = __OFSUB__(word_416C6A + 1, 100);
            v4 = (signed __int16)(word_416C6A++ - 99) < 0;
            if ( !(v4 ^ v5) )
            {
              v3 = 0;
              word_416C6A = 0;
            }
            v6 = 5 * v3;
            v7 = *(_DWORD *)(a1 + 40 * v3 + 16);
            dword_416C8C = (((BYTE4(v7) & 0xF) + (signed int)v7) >> 4) / 1024;
            v8 = *(_DWORD *)(a1 + 8 * v6 + 20);
            v2 = dword_416C80;
            dword_416C90 = (((BYTE4(v8) & 0xF) + (signed int)v8) >> 4) / 1024;
            v1 = (_BYTE *)dword_416C7C;
          }
          if ( (signed int)v1 > 60 && (signed int)v1 < 84 && v2 > 28 && v2 < 36 )
          {
            sub_40A9C0(1, 1);
            if ( ++*(_BYTE *)(a1 + 40 * word_416C6A + 2) > 9 )
              *(_BYTE *)(a1 + 40 * word_416C6A + 2) = 0;
            v2 = dword_416C80;
            v1 = (_BYTE *)dword_416C7C;
          }
        }
        if ( (signed int)v1 > 148 && (signed int)v1 < 172 && v2 > 28 && v2 < 36 )
        {
          sub_40A9C0(1, 1);
          if ( ++*(_WORD *)(a1 + 40 * word_416C6A + 4) >= 256 )
            *(_WORD *)(a1 + 40 * word_416C6A + 4) = 0;
          v2 = dword_416C80;
          v1 = (_BYTE *)dword_416C7C;
        }
        if ( (signed int)v1 > 192 && (signed int)v1 < 216 && v2 > 16 && v2 < 24 )
        {
          sub_40A9C0(1, 1);
          ++*(_BYTE *)(a1 + 40 * word_416C6A + 1);
          v1 = (_BYTE *)(a1 + 40 * word_416C6A + 1);
          if ( *v1 > 3 )
            *v1 = 0;
        }
      }
    }
    else if ( dword_416CA8 & 1 )
    {
      v1 = (_BYTE *)dword_416C7C;
      if ( dword_416C7C <= 8 || dword_416C7C >= 224 || (v9 = dword_416C80, dword_416C80 <= 8) || dword_416C80 >= 40 )
      {
        v12 = 100;
        v13 = (signed int *)(a1 + 20);
        do
        {
          v1 = (_BYTE *)(*(v13 - 1) / 1024 / 16);
          if ( (_BYTE *)dword_416C84 == v1 )
          {
            v1 = (_BYTE *)(*v13 / 1024 / 16);
            if ( (_BYTE *)dword_416C88 == v1 )
            {
              LOBYTE(v1) = sub_40A9C0(2, 1);
              *((_BYTE *)v13 - 20) = 0;
            }
          }
          v13 += 10;
          --v12;
        }
        while ( v12 );
      }
      else
      {
        if ( dword_416C7C > 60 )
        {
          if ( dword_416C7C < 84 && dword_416C80 > 16 && dword_416C80 < 24 )
          {
            sub_40A9C0(1, 1);
            if ( --word_416C6A < 0 )
              word_416C6A = 99;
            v10 = *(_DWORD *)(a1 + 40 * word_416C6A + 16);
            dword_416C8C = (((BYTE4(v10) & 0xF) + (signed int)v10) >> 4) / 1024;
            v11 = *(_DWORD *)(a1 + 40 * word_416C6A + 20);
            v9 = dword_416C80;
            dword_416C90 = (((BYTE4(v11) & 0xF) + (signed int)v11) >> 4) / 1024;
            v1 = (_BYTE *)dword_416C7C;
          }
          if ( (signed int)v1 > 60 && (signed int)v1 < 84 && v9 > 28 && v9 < 36 )
          {
            sub_40A9C0(1, 1);
            if ( --*(_BYTE *)(a1 + 40 * word_416C6A + 2) < 0 )
              *(_BYTE *)(a1 + 40 * word_416C6A + 2) = 9;
            v9 = dword_416C80;
            v1 = (_BYTE *)dword_416C7C;
          }
        }
        if ( (signed int)v1 > 148 && (signed int)v1 < 172 && v9 > 28 && v9 < 36 )
        {
          sub_40A9C0(1, 1);
          if ( --*(_WORD *)(a1 + 40 * word_416C6A + 4) < 0 )
            *(_WORD *)(a1 + 40 * word_416C6A + 4) = 255;
          v9 = dword_416C80;
          v1 = (_BYTE *)dword_416C7C;
        }
        if ( (signed int)v1 > 192 && (signed int)v1 < 216 && v9 > 16 && v9 < 24 )
        {
          sub_40A9C0(1, 1);
          --*(_BYTE *)(a1 + 40 * word_416C6A + 1);
          v1 = (_BYTE *)(a1 + 40 * word_416C6A + 1);
          if ( *v1 < 0 )
            *v1 = 3;
        }
      }
    }
  }
  return (unsigned int)v1;
}
// 416C68: using guessed type char byte_416C68;
// 416C6A: using guessed type __int16 word_416C6A;
// 416C7C: using guessed type int dword_416C7C;
// 416C80: using guessed type int dword_416C80;
// 416C84: using guessed type int dword_416C84;
// 416C88: using guessed type int dword_416C88;
// 416C8C: using guessed type int dword_416C8C;
// 416C90: using guessed type int dword_416C90;
// 416CA8: using guessed type int dword_416CA8;
// 417A48: using guessed type int dword_417A48;

//----- (00403140) --------------------------------------------------------
int __cdecl sub_403140(int a1)
{
  __int64 v1; // rax@1
  __int64 v2; // rax@1

  sub_4024C0((int)&unk_412680, 8, 8, (int)&unk_412170, 15);
  sub_4024C0((int)&unk_412680, 8, 8, (int)&unk_412180, *(_BYTE *)(a1 + 40 * word_416C6A + 2) + 80);
  sub_403CC0(60, 16, word_416C6A);
  sub_403CC0(60, 28, *(_BYTE *)(a1 + 40 * word_416C6A + 2));
  v1 = *(_DWORD *)(a1 + 40 * word_416C6A + 16);
  sub_403CC0(104, 16, (((BYTE4(v1) & 0xF) + (signed int)v1) >> 4) / 1024);
  v2 = *(_DWORD *)(a1 + 40 * word_416C6A + 20);
  sub_403CC0(104, 28, (((BYTE4(v2) & 0xF) + (signed int)v2) >> 4) / 1024);
  sub_403CC0(148, 16, *(_BYTE *)(a1 + 40 * word_416C6A));
  sub_403CC0(148, 28, *(_WORD *)(a1 + 40 * word_416C6A + 4));
  return sub_4024C0((int)&unk_412680, 192, 16, (int)&unk_412190 + 16 * *(_BYTE *)(a1 + 40 * word_416C6A + 1), 13);
}
// 416C6A: using guessed type __int16 word_416C6A;

//----- (00403270) --------------------------------------------------------
FILE *__cdecl sub_403270(int a1)
{
  FILE *result; // eax@1
  FILE *v2; // edi@1
  signed int v3; // ebx@2
  int v4; // esi@2
  char v5; // [sp+4h] [bp-104h]@1

  sprintf(&v5, aSS, &Filename, aNpchar_dat);
  result = fopen(&v5, aRb);
  v2 = result;
  if ( result )
  {
    v3 = 100;
    v4 = a1 + 2;
    do
    {
      fread((void *)(v4 - 2), 1u, 1u, v2);
      fread((void *)(v4 - 1), 1u, 1u, v2);
      fread((void *)v4, 1u, 1u, v2);
      fread((void *)(v4 + 2), 2u, 1u, v2);
      fread((void *)(v4 + 10), 1u, 1u, v2);
      fread((void *)(v4 + 14), 4u, 1u, v2);
      fread((void *)(v4 + 18), 4u, 1u, v2);
      fread((void *)(v4 + 30), 4u, 1u, v2);
      fread((void *)(v4 + 34), 4u, 1u, v2);
      v4 += 40;
      --v3;
    }
    while ( v3 );
    fclose(v2);
    result = (FILE *)1;
  }
  return result;
}

//----- (00403370) --------------------------------------------------------
FILE *__cdecl sub_403370(int a1)
{
  FILE *result; // eax@1
  FILE *v2; // edi@1
  signed int v3; // ebx@2
  int v4; // esi@2
  char v5; // [sp+4h] [bp-104h]@1

  sprintf(&v5, aSS, &Filename, aNpchar_dat);
  result = fopen(&v5, aWb);
  v2 = result;
  if ( result )
  {
    v3 = 100;
    v4 = a1 + 2;
    do
    {
      fwrite((const void *)(v4 - 2), 1u, 1u, v2);
      fwrite((const void *)(v4 - 1), 1u, 1u, v2);
      fwrite((const void *)v4, 1u, 1u, v2);
      fwrite((const void *)(v4 + 2), 2u, 1u, v2);
      fwrite((const void *)(v4 + 10), 1u, 1u, v2);
      fwrite((const void *)(v4 + 14), 4u, 1u, v2);
      fwrite((const void *)(v4 + 18), 4u, 1u, v2);
      fwrite((const void *)(v4 + 30), 4u, 1u, v2);
      fwrite((const void *)(v4 + 34), 4u, 1u, v2);
      v4 += 40;
      --v3;
    }
    while ( v3 );
    fclose(v2);
    result = (FILE *)1;
  }
  return result;
}

//----- (00403470) --------------------------------------------------------
signed int __cdecl sub_403470(_BYTE *a1)
{
  _BYTE *v1; // ecx@1
  signed int result; // eax@1

  v1 = a1;
  result = 0;
  while ( *v1 )
  {
    v1 += 28;
    if ( ++result >= 120 )
      return 0xFFFFFF;
  }
  return result;
}

//----- (00403490) --------------------------------------------------------
int __cdecl sub_403490(int a1, int a2, int a3)
{
  int v3; // edi@1
  int v4; // esi@1
  int v5; // edx@1
  int v6; // edx@1
  int result; // eax@1
  int v8; // edx@6
  char v9; // dl@7

  v3 = *(_DWORD *)(a1 + 16) + 32;
  v4 = *(_DWORD *)(a1 + 12) + *(_DWORD *)(a1 + 4);
  v5 = *(_DWORD *)(a1 + 8);
  *(_DWORD *)(a1 + 16) = v3;
  v6 = v3 + v5;
  *(_DWORD *)(a1 + 4) = v4;
  *(_DWORD *)(a1 + 8) = v6;
  result = v6;
  if ( v4 > *(_DWORD *)(a2 + 8) << 14 || v4 < 0 || v6 > *(_DWORD *)(a2 + 12) << 14 || v6 < 0 )
    *(_BYTE *)a1 = 0;
  v8 = *(_DWORD *)(a1 + 24) + 1;
  *(_DWORD *)(a1 + 24) = v8;
  if ( v8 > 8 )
  {
    v9 = *(_BYTE *)(a1 + 20);
    *(_DWORD *)(a1 + 24) = 0;
    *(_BYTE *)(a1 + 20) = ++v9;
    if ( v9 > 5 )
      *(_BYTE *)a1 = 0;
  }
  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               (v4 - *(_DWORD *)(a3 + 4)) / 1024 - 4,
               (result - *(_DWORD *)(a3 + 8)) / 1024 - 4,
               (int)&unk_4121F0 + 16 * *(_BYTE *)(a1 + 20),
               *(_BYTE *)(a1 + 1) + 60);
  return result;
}

//----- (00403560) --------------------------------------------------------
int __cdecl sub_403560(int a1, int a2, int a3)
{
  int v3; // edi@1
  int v4; // esi@1
  int v5; // edx@1
  int v6; // edx@1
  int result; // eax@1
  int v8; // edx@6
  char v9; // dl@7

  v3 = *(_DWORD *)(a1 + 16) - 16;
  v4 = *(_DWORD *)(a1 + 12) + *(_DWORD *)(a1 + 4);
  v5 = *(_DWORD *)(a1 + 8);
  *(_DWORD *)(a1 + 16) = v3;
  v6 = v3 + v5;
  *(_DWORD *)(a1 + 4) = v4;
  *(_DWORD *)(a1 + 8) = v6;
  result = v6;
  if ( v4 > *(_DWORD *)(a2 + 8) << 14 || v4 < 0 || v6 > *(_DWORD *)(a2 + 12) << 14 || v6 < 0 )
    *(_BYTE *)a1 = 0;
  v8 = *(_DWORD *)(a1 + 24) + 1;
  *(_DWORD *)(a1 + 24) = v8;
  if ( v8 > 32 )
  {
    v9 = *(_BYTE *)(a1 + 20);
    *(_DWORD *)(a1 + 24) = 0;
    *(_BYTE *)(a1 + 20) = ++v9;
    if ( v9 > 5 )
      *(_BYTE *)a1 = 0;
  }
  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               (v4 - *(_DWORD *)(a3 + 4)) / 1024 - 4,
               (result - *(_DWORD *)(a3 + 8)) / 1024 - 4,
               (int)&unk_4121F0 + 16 * *(_BYTE *)(a1 + 20),
               *(_BYTE *)(a1 + 1) + 60);
  return result;
}

//----- (00403630) --------------------------------------------------------
int __cdecl sub_403630(int a1, int a2, int a3)
{
  int v3; // esi@1
  int result; // eax@1
  int v5; // edx@6

  v3 = *(_DWORD *)(a1 + 4);
  result = *(_DWORD *)(a1 + 8) - 341;
  *(_DWORD *)(a1 + 8) = result;
  if ( v3 > *(_DWORD *)(a2 + 8) << 14 || v3 < 0 || result > *(_DWORD *)(a2 + 12) << 14 || result < 0 )
    *(_BYTE *)a1 = 0;
  v5 = *(_DWORD *)(a1 + 24) + 1;
  *(_DWORD *)(a1 + 24) = v5;
  if ( v5 > 72 )
    *(_BYTE *)a1 = 0;
  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               (v3 - *(_DWORD *)(a3 + 4)) / 1024 - 4,
               (result - *(_DWORD *)(a3 + 8)) / 1024 - 4,
               (int)&unk_4121F0 + 16 * *(_BYTE *)(a1 + 20),
               *(_BYTE *)(a1 + 1) + 60);
  return result;
}

//----- (004036E0) --------------------------------------------------------
int __cdecl sub_4036E0(int a1, int a2, int a3)
{
  int v3; // esi@1
  int result; // eax@1
  int v5; // ebx@1
  int v6; // edi@6
  char v7; // bl@7
  int v8; // [sp+Ch] [bp-20h]@1
  int v9; // [sp+10h] [bp-1Ch]@1
  int v10; // [sp+14h] [bp-18h]@1
  int v11; // [sp+18h] [bp-14h]@1
  int v12; // [sp+1Ch] [bp-10h]@1
  int v13; // [sp+20h] [bp-Ch]@1
  int v14; // [sp+24h] [bp-8h]@1
  int v15; // [sp+28h] [bp-4h]@1

  v10 = 64;
  v14 = 64;
  v11 = 16;
  v13 = 16;
  v3 = *(_DWORD *)(a1 + 4);
  result = *(_DWORD *)(a1 + 8) - 341;
  *(_DWORD *)(a1 + 8) = result;
  v5 = *(_DWORD *)(a2 + 8);
  v8 = 0;
  v9 = 0;
  v12 = 0;
  v15 = 32;
  if ( v3 > v5 << 14 || v3 < 0 || result > *(_DWORD *)(a2 + 12) << 14 || result < 0 )
    *(_BYTE *)a1 = 0;
  v6 = *(_DWORD *)(a1 + 24) + 1;
  *(_DWORD *)(a1 + 24) = v6;
  if ( v6 > 3 )
  {
    v7 = *(_BYTE *)(a1 + 20);
    *(_DWORD *)(a1 + 24) = 0;
    *(_BYTE *)(a1 + 20) = ++v7;
    if ( v7 > 24 )
      *(_BYTE *)a1 = 0;
  }
  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               (v3 - *(_DWORD *)(a3 + 4)) / 1024 - 32,
               (result - *(_DWORD *)(a3 + 8)) / 1024 - 4,
               (int)(&v8 + 4 * (*(_BYTE *)(a1 + 20) % 2)),
               *(_BYTE *)(a1 + 1) + 60);
  return result;
}

//----- (004037E0) --------------------------------------------------------
int __cdecl sub_4037E0(int a1, int a2, int a3)
{
  int v3; // esi@1
  signed int v4; // ebp@1
  int result; // eax@3

  v3 = a1;
  v4 = 120;
  do
  {
    if ( *(_BYTE *)v3 )
      result = off_4121E0[*(_BYTE *)(v3 + 1)](v3, a2, a3);
    v3 += 28;
    --v4;
  }
  while ( v4 );
  return result;
}
// 4121E0: using guessed type int (__cdecl *off_4121E0[4])(int, int, int);

//----- (00403820) --------------------------------------------------------
signed int __cdecl sub_403820(_BYTE *a1)
{
  _BYTE *v1; // ecx@1
  signed int result; // eax@1

  v1 = a1;
  result = 0;
  while ( *v1 )
  {
    v1 += 36;
    if ( ++result >= 120 )
      return 0xFFFFFF;
  }
  return result;
}

//----- (00403840) --------------------------------------------------------
int __cdecl sub_403840(int a1, int a2)
{
  _BYTE *v2; // ebp@1
  int v3; // esi@1
  signed int v4; // eax@4
  int v5; // edi@5
  int result; // eax@7
  signed int v7; // [sp+10h] [bp-4h]@1
  signed int i; // [sp+1Ch] [bp+8h]@3

  v2 = (_BYTE *)a2;
  v3 = a1;
  v7 = 10;
  do
  {
    if ( *(_BYTE *)v3 )
    {
      *(_BYTE *)v3 = 0;
      for ( i = 0; i < *(_BYTE *)(v3 + 3); ++i )
      {
        v4 = sub_403470(v2);
        if ( v4 != 0xFFFFFF )
        {
          v5 = (int)&v2[28 * v4];
          *(_BYTE *)(v5 + 1) = *(_BYTE *)(v3 + 1);
          *(_DWORD *)(v5 + 24) = 0;
          *(_BYTE *)(v5 + 20) = *(_BYTE *)(v3 + 2);
          *(_DWORD *)(v5 + 4) = *(_DWORD *)(v3 + 4) + (Random(-*(_DWORD *)(v3 + 28), *(_DWORD *)(v3 + 28)) << 10);
          *(_DWORD *)(v5 + 8) = *(_DWORD *)(v3 + 8) + (Random(-*(_DWORD *)(v3 + 32), *(_DWORD *)(v3 + 32)) << 10);
          *(_DWORD *)(v5 + 12) = Random(*(_DWORD *)(v3 + 16), *(_DWORD *)(v3 + 12));
          *(_DWORD *)(v5 + 16) = Random(*(_DWORD *)(v3 + 24), *(_DWORD *)(v3 + 20));
          *(_BYTE *)v5 = 1;
        }
      }
    }
    v3 += 36;
    result = v7-- - 1;
  }
  while ( v7 );
  return result;
}

//----- (00403920) --------------------------------------------------------
signed int __cdecl sub_403920(int a1, int a2, _BYTE *a3)
{
  int v3; // eax@1
  int v4; // edx@3
  signed int result; // eax@4
  int v6; // esi@5
  _BYTE *v7; // edi@5
  signed int v8; // eax@5
  int v9; // eax@6
  int v10; // edx@6
  signed int v11; // eax@7
  int v12; // ebp@9
  int v13; // edi@10
  int v14; // esi@10
  int v15; // eax@12
  int v16; // edx@18
  int v17; // ebp@20
  int v18; // edi@21
  int v19; // esi@21
  int v20; // eax@23
  int v21; // edx@29
  int v22; // ecx@31
  bool v23; // zf@31
  signed int v24; // ecx@31
  signed int v25; // eax@34
  int v26; // eax@35
  int v27; // edx@35
  int v28; // eax@37
  int v29; // [sp+18h] [bp+8h]@9
  int v30; // [sp+18h] [bp+8h]@20

  v3 = a1;
  switch ( *(_BYTE *)(a1 + 1) )
  {
    case 0:
      *(_DWORD *)(a1 + 4) = 0;
      goto LABEL_39;
    case 1:
      v4 = *(_DWORD *)(a1 + 4) + 1;
      *(_DWORD *)(a1 + 4) = v4;
      if ( v4 <= 60 )
      {
        v6 = a2;
        *(_DWORD *)(v6 + 4) += Random(-10, 10) << 10;
        v7 = a3;
        *(_DWORD *)(v6 + 8) += Random(-10, 10) << 10;
        v8 = sub_403820(a3);
        if ( v8 != 0xFFFFFF )
        {
          v9 = (int)&a3[36 * v8];
          *(_BYTE *)v9 = 1;
          *(_BYTE *)(v9 + 1) = 1;
          *(_BYTE *)(v9 + 2) = 0;
          *(_BYTE *)(v9 + 3) = 2;
          *(_DWORD *)(v9 + 4) = *(_DWORD *)(a2 + 4) + 163840;
          v10 = *(_DWORD *)(a2 + 8);
          *(_DWORD *)(v9 + 12) = 0;
          *(_DWORD *)(v9 + 8) = v10 + 122880;
          *(_DWORD *)(v9 + 16) = 0;
          *(_DWORD *)(v9 + 20) = 0;
          *(_DWORD *)(v9 + 24) = 0;
          *(_DWORD *)(v9 + 28) = 213;
          *(_DWORD *)(v9 + 32) = 160;
        }
        v11 = sub_403820(a3);
        if ( v11 != 0xFFFFFF )
        {
LABEL_37:
          v28 = (int)&v7[36 * v11];
          *(_BYTE *)v28 = 1;
          *(_BYTE *)(v28 + 1) = 0;
          *(_BYTE *)(v28 + 2) = 0;
          *(_BYTE *)(v28 + 3) = 2;
          *(_DWORD *)(v28 + 4) = *(_DWORD *)(v6 + 4) + 163840;
          *(_DWORD *)(v28 + 8) = *(_DWORD *)(v6 + 8) + 122880;
          *(_DWORD *)(v28 + 12) = 0;
          *(_DWORD *)(v28 + 16) = 0;
          *(_DWORD *)(v28 + 20) = 0;
          *(_DWORD *)(v28 + 24) = 0;
          *(_DWORD *)(v28 + 28) = 213;
          *(_DWORD *)(v28 + 32) = 160;
        }
LABEL_38:
        v3 = a1;
LABEL_39:
        if ( *(_BYTE *)v3 )
          sub_402600((int)&unk_412680, 0);
        result = 0;
      }
      else
      {
        *(_BYTE *)(a1 + 1) = 0;
        result = 0;
      }
      return result;
    case 2:
      v29 = 0;
      v12 = 224;
      do
      {
        v13 = 0;
        v14 = 0;
        while ( 1 )
        {
          v15 = *(_DWORD *)(v3 + 4) - v13 - v29;
          if ( v15 >= 0 )
          {
            if ( v15 > 15 )
              v15 = 15;
          }
          else
          {
            v15 = 0;
          }
          sub_4024C0((int)&unk_412680, v14, v12, (int)&unk_412330 + 16 * v15, 18);
          v14 += 16;
          ++v13;
          if ( v14 >= 320 )
            break;
          v3 = a1;
        }
        v3 = a1;
        v12 -= 16;
        ++v29;
      }
      while ( v12 > -16 );
      v16 = *(_DWORD *)(a1 + 4) + 1;
      *(_DWORD *)(a1 + 4) = v16;
      if ( v16 <= 50 )
        goto LABEL_38;
      *(_BYTE *)(a1 + 1) = 0;
      return 1;
    case 3:
      v30 = 0;
      v17 = 224;
      do
      {
        v18 = 0;
        v19 = 0;
        while ( 1 )
        {
          v20 = *(_DWORD *)(v3 + 4) - v18 - v30;
          if ( v20 >= 0 )
          {
            if ( v20 > 15 )
              v20 = 15;
          }
          else
          {
            v20 = 0;
          }
          sub_4024C0((int)&unk_412680, v19, v17, (int)&unk_412420 - 16 * v20, 18);
          v19 += 16;
          ++v18;
          if ( v19 >= 320 )
            break;
          v3 = a1;
        }
        v3 = a1;
        v17 -= 16;
        ++v30;
      }
      while ( v17 > -16 );
      v21 = *(_DWORD *)(a1 + 4) + 1;
      *(_DWORD *)(a1 + 4) = v21;
      if ( v21 <= 50 )
        goto LABEL_38;
      *(_BYTE *)(a1 + 1) = 0;
      return 1;
    case 4:
      v22 = *(_DWORD *)(a1 + 4) + 1;
      *(_DWORD *)(a1 + 4) = v22;
      v24 = v22 & 0x80000003;
      v23 = v24 == 0;
      if ( v24 < 0 )
        v23 = (((_BYTE)v24 - 1) | 0xFFFFFFFC) == -1;
      if ( !v23 )
        goto LABEL_39;
      v6 = a2;
      *(_DWORD *)(v6 + 4) += Random(-1, 1) << 10;
      v7 = a3;
      *(_DWORD *)(v6 + 8) += Random(-1, 1) << 10;
      v25 = sub_403820(a3);
      if ( v25 != 0xFFFFFF )
      {
        v26 = (int)&a3[36 * v25];
        *(_BYTE *)v26 = 1;
        *(_BYTE *)(v26 + 1) = 1;
        *(_BYTE *)(v26 + 2) = 0;
        *(_BYTE *)(v26 + 3) = 2;
        *(_DWORD *)(v26 + 4) = *(_DWORD *)(a2 + 4) + 163840;
        v27 = *(_DWORD *)(a2 + 8);
        *(_DWORD *)(v26 + 12) = 0;
        *(_DWORD *)(v26 + 8) = v27 + 122880;
        *(_DWORD *)(v26 + 16) = 0;
        *(_DWORD *)(v26 + 20) = 0;
        *(_DWORD *)(v26 + 24) = 0;
        *(_DWORD *)(v26 + 28) = 213;
        *(_DWORD *)(v26 + 32) = 160;
      }
      v11 = sub_403820(a3);
      if ( v11 != 0xFFFFFF )
        goto LABEL_37;
      goto LABEL_38;
    default:
      goto LABEL_39;
  }
}

//----- (00403C40) --------------------------------------------------------
int __cdecl sub_403C40(int a1, int a2, int a3)
{
  int v3; // ebx@1
  int v4; // edi@1
  void *v5; // esi@1
  int v6; // ecx@2
  int result; // eax@2
  signed int v8; // [sp+10h] [bp-4h]@1

  v3 = a1;
  v4 = a3;
  v8 = 0;
  v5 = &unk_412570;
  do
  {
    v6 = *(_DWORD *)v5;
    result = 0;
    if ( v4 >= *(_DWORD *)v5 )
    {
      v8 = 1;
      do
      {
        v4 -= v6;
        ++result;
      }
      while ( v4 >= v6 );
LABEL_8:
      result = sub_4024C0((int)&unk_412680, v3, a2, (int)&unk_412430 + 16 * result, 4);
      goto LABEL_9;
    }
    if ( v8 || v5 == &unk_412584 )
      goto LABEL_8;
LABEL_9:
    v5 = (char *)v5 + 4;
    v3 += 8;
  }
  while ( (signed int)v5 < (signed int)&unk_412588 );
  return result;
}

//----- (00403CC0) --------------------------------------------------------
int __cdecl sub_403CC0(int a1, int a2, int a3)
{
  void *v3; // esi@1
  int v4; // edi@1
  int v5; // ecx@2
  int result; // eax@2
  signed int v7; // [sp+10h] [bp-4h]@1

  v3 = &unk_412570;
  v4 = a3;
  v7 = 0;
  do
  {
    v5 = *(_DWORD *)v3;
    result = 0;
    if ( v4 >= *(_DWORD *)v3 )
    {
      v7 = 1;
      do
      {
        v4 -= v5;
        ++result;
      }
      while ( v4 >= v5 );
LABEL_8:
      result = sub_4024C0((int)&unk_412680, (int)v3 + a1 - (_DWORD)&unk_412570, a2, (int)&unk_4124D0 + 16 * result, 4);
      goto LABEL_9;
    }
    if ( v7 || v3 == &unk_412584 )
      goto LABEL_8;
LABEL_9:
    v3 = (char *)v3 + 4;
  }
  while ( (signed int)v3 < (signed int)&unk_412588 );
  return result;
}

//----- (00403D40) --------------------------------------------------------
int __cdecl sub_403D40(LPCSTR lpString)
{
  return sub_402770(0, 1, lpString, 0xFFFFFFu, (HDC)6);
}

//----- (00403D60) --------------------------------------------------------
FILE *__cdecl sub_403D60(LPCSTR lpFileName, int a2)
{
  HANDLE v2; // edi@1
  FILE *result; // eax@1
  FILE *v4; // edi@1

  v2 = CreateFileA(lpFileName, 0x80000000, 0, NULL, 3u, 0x80u, NULL);
  *(_DWORD *)(a2 + 12) = GetFileSize(v2, NULL);
  CloseHandle(v2);
  *(_DWORD *)(a2 + 4) = LocalAlloc(0x40u, *(_DWORD *)(a2 + 12));
  result = fopen(lpFileName, aRb);
  v4 = result;
  if ( result )
  {
    fread(*(void **)(a2 + 4), 1u, *(_DWORD *)(a2 + 12), result);
    fclose(v4);
    result = (FILE *)1;
  }
  return result;
}

//----- (00403DF0) --------------------------------------------------------
FILE *__cdecl sub_403DF0(void *a1, int a2, int a3, int a4)
{
  FILE *result; // eax@1
  FILE *v5; // esi@1
  signed int v6; // ebx@2
  int v7; // edi@2
  char v8; // [sp+4h] [bp-104h]@1

  sprintf(&v8, aSS, &Filename, aIka_rec);
  result = fopen(&v8, aWb);
  v5 = result;
  if ( result )
  {
    fwrite(aIka_en03, 1u, 8u, result);
    fwrite(&dword_4170F4, 4u, 1u, v5);
    fwrite(&dword_4170F8, 4u, 1u, v5);
    fwrite(&word_41710C, 2u, 1u, v5);
    fwrite(&word_41710E, 2u, 1u, v5);
    fwrite(&byte_417110, 1u, 1u, v5);
    fwrite(&byte_4170F3, 1u, 1u, v5);
    fwrite(a1, 1u, 0x20u, v5);
    fwrite(*(const void **)a2, 1u, 0xAu, v5);
    fwrite((const void *)(a3 + 8), 4u, 1u, v5);
    fwrite((const void *)(a3 + 12), 4u, 1u, v5);
    fwrite(*(const void **)a3, 1u, *(_DWORD *)(a3 + 12) * *(_DWORD *)(a3 + 8), v5);
    v6 = 100;
    v7 = a4 + 20;
    do
    {
      fwrite((const void *)(v7 - 4), 4u, 1u, v5);
      fwrite((const void *)v7, 4u, 1u, v5);
      fwrite((const void *)(v7 + 12), 4u, 1u, v5);
      fwrite((const void *)(v7 + 16), 4u, 1u, v5);
      fwrite((const void *)(v7 + 4), 4u, 1u, v5);
      fwrite((const void *)(v7 + 8), 4u, 1u, v5);
      v7 += 40;
      --v6;
    }
    while ( v6 );
    fclose(v5);
    result = (FILE *)1;
  }
  return result;
}
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 41710C: using guessed type __int16 word_41710C;
// 41710E: using guessed type __int16 word_41710E;
// 417110: using guessed type char byte_417110;

//----- (00403F90) --------------------------------------------------------
int __cdecl sub_403F90(void *a1, int a2, int a3, int a4)
{
  FILE *v4; // eax@1
  FILE *v5; // esi@1
  int v7; // eax@3
  signed int v8; // ebx@6
  int v9; // edi@6
  char v10[8]; // [sp+4h] [bp-10Ch]@3
  char v11; // [sp+Ch] [bp-104h]@1

  sprintf(&v11, aSS, &Filename, aIka_rec);
  v4 = fopen(&v11, aRb);
  v5 = v4;
  if ( v4 )
  {
    fread(v10, 1u, 8u, v4);
    v7 = 0;
    while ( v10[v7] == aIka_en03[v7] )
    {
      if ( ++v7 >= 8 )
      {
        fread(&dword_4170F4, 4u, 1u, v5);
        fread(&dword_4170F8, 4u, 1u, v5);
        fread(&word_41710C, 2u, 1u, v5);
        fread(&word_41710E, 2u, 1u, v5);
        fread(&byte_417110, 1u, 1u, v5);
        fread(&byte_4170F3, 1u, 1u, v5);
        fread(a1, 1u, 0x20u, v5);
        fread(*(void **)a2, 1u, 0xAu, v5);
        fread((void *)(a3 + 8), 4u, 1u, v5);
        fread((void *)(a3 + 12), 4u, 1u, v5);
        fread(*(void **)a3, 1u, *(_DWORD *)(a3 + 8) * *(_DWORD *)(a3 + 12), v5);
        v8 = 100;
        v9 = a4 + 20;
        do
        {
          fread((void *)(v9 - 4), 4u, 1u, v5);
          fread((void *)v9, 4u, 1u, v5);
          fread((void *)(v9 + 12), 4u, 1u, v5);
          fread((void *)(v9 + 16), 4u, 1u, v5);
          fread((void *)(v9 + 4), 4u, 1u, v5);
          fread((void *)(v9 + 8), 4u, 1u, v5);
          v9 += 40;
          --v8;
        }
        while ( v8 );
        fclose(v5);
        return 1;
      }
    }
  }
  return 0;
}
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 41710C: using guessed type __int16 word_41710C;
// 41710E: using guessed type __int16 word_41710E;
// 417110: using guessed type char byte_417110;
// 403F90: using guessed type char var_10C[8];

//----- (00404140) --------------------------------------------------------
signed int __cdecl sub_404140(signed int a1, int a2)
{
  signed int result; // eax@2

  if ( a1 <= 256 )
  {
    *(_BYTE *)(a1 / 8 + a2) |= 1 << a1 % 8;
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}

//----- (00404180) --------------------------------------------------------
signed int __cdecl sub_404180(signed int a1, int a2)
{
  signed int result; // eax@2

  if ( a1 <= 256 )
  {
    *(_BYTE *)(a1 / 8 + a2) &= ~(1 << a1 % 8);
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}

//----- (004041C0) --------------------------------------------------------
int __cdecl sub_4041C0(signed int a1, int a2)
{
  int result; // eax@2

  if ( a1 <= 256 )
    result = (*(_BYTE *)(a1 / 8 + a2) & (unsigned __int8)(1 << a1 % 8)) != 0;
  else
    result = 0;
  return result;
}

//----- (00404200) --------------------------------------------------------
int __usercall sub_404200@<eax>(int a1@<esi>, int a2)
{
  int v2; // edx@1
  int v3; // eax@1
  int v4; // edi@1
  int v5; // esi@1
  int v6; // edx@1
  int v7; // edi@1
  int result; // eax@1

  v2 = *(_DWORD *)(a2 + 20);
  v3 = *(_DWORD *)(a2 + 4);
  LOWORD(a1) = *(_BYTE *)(v3 + v2);
  v4 = 1000 * a1 + 17536;
  v5 = v2 + 1;
  *(_DWORD *)(a2 + 20) = v2 + 1;
  LOWORD(v2) = *(_BYTE *)(v2 + 1 + v3);
  *(_DWORD *)(a2 + 20) = ++v5;
  v6 = 25 * (v2 - 48);
  v7 = v4 + 4 * v6;
  LOWORD(v6) = *(_BYTE *)(v5 + v3);
  *(_DWORD *)(a2 + 20) = v5 + 1;
  LOWORD(v3) = *(_BYTE *)(v5 + 1 + v3);
  result = v7 + 10 * (v6 - 48) + v3 - 48;
  *(_DWORD *)(a2 + 20) = v5 + 2;
  return result;
}

//----- (00404260) --------------------------------------------------------
signed int __cdecl sub_404260(int a1)
{
  int v1; // eax@1
  int v2; // ecx@2
  int v3; // eax@3
  int v4; // eax@4
  __int16 v5; // ax@5
  int v6; // edx@6
  signed int v7; // edx@7
  unsigned int v8; // edx@9
  unsigned int v9; // eax@9

  v1 = *(_DWORD *)(a1 + 12);
  *(_DWORD *)(a1 + 20) = 0;
  if ( !v1 )
    return 0;
  v2 = *(_DWORD *)(a1 + 4);
  while ( 1 )
  {
    v3 = *(_DWORD *)(a1 + 20);
    if ( *(_BYTE *)(v2 + v3) == 35 )
    {
      v4 = v3 + 1;
      *(_DWORD *)(a1 + 20) = v4;
      if ( *(_BYTE *)(v4 + v2) == 101 )
        break;
    }
LABEL_9:
    v8 = *(_DWORD *)(a1 + 12);
    v9 = *(_DWORD *)(a1 + 20) + 1;
    *(_DWORD *)(a1 + 20) = v9;
    if ( v9 >= v8 )
      return 0;
  }
  *(_DWORD *)(a1 + 20) = v4 + 1;
  v5 = sub_404200(a1, a1);
  v2 = *(_DWORD *)(a1 + 4);
  if ( *(_BYTE *)(v2 + *(_DWORD *)(a1 + 20)) != 10 )
  {
    do
    {
      v6 = *(_DWORD *)(a1 + 20) + 1;
      *(_DWORD *)(a1 + 20) = v6;
    }
    while ( *(_BYTE *)(v6 + v2) != 10 );
  }
  ++*(_DWORD *)(a1 + 20);
  v7 = *(_DWORD *)(a1 + 16);
  if ( v7 != v5 )
  {
    if ( v7 < v5 )
      return 0;
    goto LABEL_9;
  }
  return 1;
}

//----- (004042E0) --------------------------------------------------------
int __cdecl sub_4042E0(int a1)
{
  return sub_4024C0(
           (int)&unk_412680,
           292,
           214,
           (int)&a8[16 * ((signed int)((unsigned int)*(_BYTE *)(a1 + 24) >> 2) % 8)],
           14);
}

//----- (00404320) --------------------------------------------------------
char __cdecl sub_404320(int a1, void *a2, int a3, int a4, int a5, int a6, int a7, int a8)
{
  int v8; // eax@1
  char result; // al@3
  int v10; // ecx@6
  int v11; // eax@7
  int v12; // eax@9
  char v13; // dl@9
  unsigned int v14; // edx@95
  unsigned int v15; // eax@95
  __int16 v16; // ax@97
  int v17; // eax@99
  int v18; // eax@99
  __int16 v19; // dx@100
  CHAR v20; // cl@102
  int v21; // eax@102
  char v22; // cl@103
  int v23; // eax@103
  int v24; // eax@103
  int v25; // eax@110
  __int16 v26; // ax@111
  __int16 v27; // ax@112
  __int16 v28; // ax@113
  char v29; // al@115
  char v30; // al@116
  char v31; // al@117
  __int16 v32; // di@119
  __int16 v33; // bx@119
  int v34; // edi@120
  int v35; // ebx@120
  __int16 v36; // ax@120
  __int16 v37; // bp@120
  int v38; // ecx@120
  int v39; // esi@120
  __int16 v40; // ax@120
  __int16 v41; // ax@121
  int v42; // eax@130
  __int16 v43; // ax@141
  char v44; // dl@155
  char v45; // bl@155
  char v46; // al@156
  char v47; // al@158
  CHAR String; // [sp+10h] [bp-4h]@1
  char v49; // [sp+11h] [bp-3h]@1
  char v50; // [sp+12h] [bp-2h]@1

  String = 0;
  v8 = *(_BYTE *)a1 - 1;
  v49 = 0;
  v50 = 0;
  switch ( v8 )
  {
    case 0:
      if ( sub_404260(a1) )
        goto LABEL_162;
      *(_BYTE *)a1 = 0;
      return 0;
    case 1:
      if ( --*(_WORD *)(a1 + 26) >= 0 )
        goto LABEL_173;
      if ( *(_DWORD *)(a1 + 20) >= *(_DWORD *)(a1 + 12) )
        goto LABEL_96;
      v10 = *(_DWORD *)(a1 + 4);
      break;
    case 3:
      v44 = *(_BYTE *)(a1 + 32);
      v45 = *(_BYTE *)(a1 + 31) - 4;
      *(_BYTE *)(a1 + 31) = v45;
      *(_BYTE *)(a1 + 32) = v44 - 4;
      if ( v44 == 4 )
      {
        sub_402680((int)&unk_412588, 0, 6);
        v46 = *(_BYTE *)(a1 + 30) + 1;
        *(_BYTE *)(a1 + 31) = 20;
        *(_BYTE *)(a1 + 30) = v46;
        *(_BYTE *)a1 = 2;
        result = 0;
      }
      else
      {
        if ( v45 )
          goto LABEL_173;
        sub_402680((int)&unk_412588, 0, 7);
        v47 = *(_BYTE *)(a1 + 30) + 1;
        *(_BYTE *)(a1 + 32) = 20;
        *(_BYTE *)(a1 + 30) = v47;
        *(_BYTE *)a1 = 2;
        result = 0;
      }
      return result;
    case 4:
      if ( !(dword_416CA0 & 0x40) )
        goto LABEL_173;
      *(_BYTE *)a1 = 4;
      return 0;
    case 5:
      if ( !(dword_416CA0 & 0x40) )
        goto LABEL_173;
LABEL_162:
      *(_WORD *)(a1 + 26) = 0;
      *(_BYTE *)(a1 + 30) = 0;
      *(_BYTE *)(a1 + 31) = 0;
      *(_BYTE *)(a1 + 32) = 20;
      *(_BYTE *)(a1 + 33) = 0;
      sub_402680((int)&unk_412588, 0, 6);
      sub_402680((int)&unk_412588, 0, 7);
      *(_BYTE *)a1 = 2;
      return 0;
    case 6:
      if ( !(dword_416CA0 & 0x40) )
        goto LABEL_173;
      goto LABEL_164;
    case 7:
LABEL_164:
      *(_BYTE *)a1 = 0;
      *(_BYTE *)(a1 + 8) = 0;
      return 0;
    case 8:
      sub_4024C0((int)&unk_412680, 96 * *(_BYTE *)(a1 + 34) + 79, 93, (int)&unk_4125B8, 16);
      sub_4024C0((int)&unk_412680, 88, 100, (int)&unk_412598, 16);
      sub_4024C0((int)&unk_412680, 184, 100, (int)&unk_4125A8, 16);
      if ( dword_416CA0 & 1 )
      {
        *(_BYTE *)(a1 + 34) = 0;
        sub_40A9C0(6, 1);
      }
      if ( dword_416CA0 & 2 )
      {
        *(_BYTE *)(a1 + 34) = 1;
        sub_40A9C0(6, 1);
      }
      if ( !(dword_416CA0 & 0x40) )
        goto LABEL_173;
      sub_40A9C0(1, 1);
      if ( *(_BYTE *)(a1 + 34) )
      {
        *(_DWORD *)(a1 + 20) += 4;
        *(_WORD *)(a1 + 26) = 0;
        *(_BYTE *)(a1 + 30) = 0;
        *(_BYTE *)(a1 + 31) = 0;
        *(_BYTE *)(a1 + 32) = 20;
        *(_BYTE *)(a1 + 33) = 0;
        sub_402680((int)&unk_412588, 0, 6);
        sub_402680((int)&unk_412588, 0, 7);
        *(_BYTE *)a1 = 2;
LABEL_173:
        result = 0;
      }
      else
      {
LABEL_171:
        *(_DWORD *)(a1 + 16) = (signed __int16)sub_404200(a1, a1);
        *(_BYTE *)a1 = 1;
        result = 0;
      }
      return result;
    default:
      goto LABEL_173;
  }
  while ( 1 )
  {
    v11 = *(_DWORD *)(a1 + 20);
    if ( *(_BYTE *)(v10 + v11) == 45 )
      *(_DWORD *)(a1 + 20) = v11 + 1;
    v12 = *(_DWORD *)(a1 + 20);
    v13 = *(_BYTE *)(v10 + v12);
    if ( v13 & 0x80 )
    {
      v16 = *(_WORD *)(a1 + 28);
      *(_BYTE *)(a1 + 8) = 1;
      *(_WORD *)(a1 + 26) = v16;
      if ( dword_417A44 & 0x40 )
        *(_WORD *)(a1 + 26) = 0;
      v17 = v10 + *(_DWORD *)(a1 + 20);
      String = *(_BYTE *)v17;
      v49 = *(_BYTE *)(v17 + 1);
      sub_40A9C0(8, 1);
      sub_402770(8 * *(_BYTE *)(a1 + 33) + 1, 1, &String, 0xFF0000u, (HDC)(*(_BYTE *)(a1 + 30) % 2 + 6));
      sub_402770(8 * *(_BYTE *)(a1 + 33), 0, &String, 0xFFFFFFu, (HDC)(*(_BYTE *)(a1 + 30) % 2 + 6));
      v18 = *(_DWORD *)(a1 + 20) + 2;
      *(_BYTE *)(a1 + 33) += 2;
      *(_DWORD *)(a1 + 20) = v18;
      return 0;
    }
    if ( v13 == 43 )
    {
      v22 = *(_BYTE *)(a1 + 30);
      v23 = *(_DWORD *)(a1 + 20) + 3;
      *(_WORD *)(a1 + 26) = 0;
      *(_DWORD *)(a1 + 20) = v23;
      *(_BYTE *)(a1 + 33) = 0;
      v24 = v22 % 2;
      if ( v24 || *(_BYTE *)(a1 + 32) )
      {
        if ( v24 != 1 || *(_BYTE *)(a1 + 31) )
        {
          *(_BYTE *)(a1 + 30) = v22 + 1;
          result = 0;
        }
        else
        {
          *(_BYTE *)a1 = 5;
          result = 0;
        }
      }
      else
      {
        *(_BYTE *)a1 = 5;
        result = 0;
      }
      return result;
    }
    if ( v13 == 47 )
    {
      v25 = *(_DWORD *)(a1 + 20);
      *(_BYTE *)a1 = 6;
      *(_DWORD *)(a1 + 20) = v25 + 3;
      return 0;
    }
    if ( v13 == 60 )
      break;
    if ( v13 >= 32 && (v13 < 48 || v13 > 57 && v13 <= 122) )
    {
      v19 = *(_WORD *)(a1 + 28);
      *(_BYTE *)(a1 + 8) = 1;
      *(_WORD *)(a1 + 26) = v19;
      if ( dword_417A44 & 0x40 )
        *(_WORD *)(a1 + 26) = 0;
      v20 = *(_BYTE *)(v10 + *(_DWORD *)(a1 + 20));
      v49 = 0;
      String = v20;
      sub_40A9C0(8, 1);
      sub_402770(8 * *(_BYTE *)(a1 + 33) + 1, 1, &String, 0xFF0000u, (HDC)(*(_BYTE *)(a1 + 30) % 2 + 6));
      sub_402770(8 * *(_BYTE *)(a1 + 33), 0, &String, 0xFFFFFFu, (HDC)(*(_BYTE *)(a1 + 30) % 2 + 6));
      v21 = *(_DWORD *)(a1 + 20) + 1;
      ++*(_BYTE *)(a1 + 33);
      *(_DWORD *)(a1 + 20) = v21;
      return 0;
    }
LABEL_95:
    v14 = *(_DWORD *)(a1 + 12);
    v15 = v12 + 1;
    *(_DWORD *)(a1 + 20) = v15;
    if ( v15 >= v14 )
      goto LABEL_96;
  }
  if ( *(_BYTE *)(v12 + v10 + 1) == 102 && *(_BYTE *)(v12 + v10 + 2) == 43 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v26 = sub_404200(a1, a1);
    sub_404140(v26, (int)a2);
    return 0;
  }
  if ( *(_BYTE *)(v12 + v10 + 1) == 102 && *(_BYTE *)(v12 + v10 + 2) == 45 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v27 = sub_404200(a1, a1);
    sub_404180(v27, (int)a2);
    return 0;
  }
  if ( *(_BYTE *)(v12 + v10 + 1) == 102 && *(_BYTE *)(v12 + v10 + 2) == 106 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v28 = sub_404200(a1, a1);
    if ( sub_4041C0(v28, (int)a2) != 1 )
      goto LABEL_173;
    ++*(_DWORD *)(a1 + 20);
    goto LABEL_171;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 105 && *(_BYTE *)(v10 + v12 + 2) == 43 )
  {
    sub_40A9C0(3, 1);
    *(_DWORD *)(a1 + 20) += 3;
    v29 = sub_404200(a1, a1);
    sub_406550((int *)a3, v29);
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 105 && *(_BYTE *)(v10 + v12 + 2) == 45 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v30 = sub_404200(a1, a1);
    sub_4065A0((int *)a3, v30);
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 105 && *(_BYTE *)(v10 + v12 + 2) == 106 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v31 = sub_404200(a1, a1);
    if ( sub_406530((_DWORD *)a3, v31) != 1 )
      goto LABEL_173;
    ++*(_DWORD *)(a1 + 20);
    *(_DWORD *)(a1 + 16) = (signed __int16)sub_404200(a1, a1);
    *(_BYTE *)a1 = 1;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 112 && *(_BYTE *)(v10 + v12 + 2) == 99 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v32 = sub_404200(a1, a1);
    ++*(_DWORD *)(a1 + 20);
    v33 = sub_404200(a1, a1);
    ++*(_DWORD *)(a1 + 20);
    *(_BYTE *)(v32 + v33 * *(_DWORD *)(a5 + 8) + *(_DWORD *)a5) = sub_404200(a1, a1);
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 99 && *(_BYTE *)(v10 + v12 + 2) == 109 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v34 = (signed __int16)sub_404200(a1, a1);
    ++*(_DWORD *)(a1 + 20);
    v35 = sub_404200(a1, a1);
    ++*(_DWORD *)(a1 + 20);
    v36 = sub_404200(a1, a1);
    v37 = v36;
    ++*(_DWORD *)(a1 + 20);
    v38 = a4 + 40 * v34;
    v39 = v35 - *(_DWORD *)(v38 + 16) / 16 / 1024;
    v40 = v36 - *(_DWORD *)(v38 + 20) / 16 / 1024;
    *(_DWORD *)(v38 + 16) = (signed __int16)v35 << 14;
    *(_DWORD *)(v38 + 20) = v37 << 14;
    *(_DWORD *)(v38 + 32) += (signed __int16)v39 << 14;
    *(_DWORD *)(v38 + 36) += v40 << 14;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 115 && *(_BYTE *)(v10 + v12 + 2) == 101 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    v41 = sub_404200(a1, a1);
    sub_40A9C0(v41, 1);
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 119 && *(_BYTE *)(v10 + v12 + 2) == 97 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_WORD *)(a1 + 26) = sub_404200(a1, a1);
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 101 && *(_BYTE *)(v10 + v12 + 2) == 107 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_DWORD *)(a7 + 4) = 0;
    *(_BYTE *)(a7 + 1) = 1;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 108 && *(_BYTE *)(v10 + v12 + 2) == 101 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_DWORD *)(a7 + 4) = 0;
    *(_BYTE *)(a7 + 1) = 4;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 102 && *(_BYTE *)(v10 + v12 + 2) == 111 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_DWORD *)(a7 + 4) = 0;
    *(_BYTE *)(a7 + 1) = 2;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 102 && *(_BYTE *)(v10 + v12 + 2) == 105 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_DWORD *)(a7 + 4) = 0;
    *(_BYTE *)(a7 + 1) = 3;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 109 && *(_BYTE *)(v10 + v12 + 2) == 97 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_BYTE *)a7 = 1;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 110 && *(_BYTE *)(v10 + v12 + 2) == 109 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_BYTE *)a7 = 0;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 121 && *(_BYTE *)(v10 + v12 + 2) == 110 )
  {
    *(_DWORD *)(a1 + 20) += 3;
    *(_BYTE *)(a1 + 34) = 0;
    *(_BYTE *)a1 = 9;
    sub_40A9C0(14, 1);
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 109 && *(_BYTE *)(v10 + v12 + 2) == 99 )
  {
    v42 = *(_DWORD *)(a1 + 20);
    *(_BYTE *)(a1 + 8) = 0;
    *(_DWORD *)(a1 + 20) = v42 + 3;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) == 100 && *(_BYTE *)(v10 + v12 + 2) == 115 )
  {
    sub_40A9C0(13, 1);
    sub_403DF0(a2, a3, a5, a4);
    *(_DWORD *)(a1 + 20) += 3;
    return 0;
  }
  if ( *(_BYTE *)(v10 + v12 + 1) != 100 || *(_BYTE *)(v10 + v12 + 2) != 108 )
  {
    if ( *(_BYTE *)(v10 + v12 + 1) == 110 && *(_BYTE *)(v10 + v12 + 2) == 108 )
    {
      sub_403270(a4);
      word_41710A = 100;
      *(_DWORD *)(a1 + 20) += 3;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 99 && *(_BYTE *)(v10 + v12 + 2) == 101 )
    {
      sub_408260((char *)a4);
      sub_401000();
      *(_DWORD *)(a1 + 20) += 3;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 101 && *(_BYTE *)(v10 + v12 + 2) == 43 )
    {
      word_41710C = word_412FFC[byte_417110];
LABEL_139:
      *(_DWORD *)(a1 + 20) += 3;
      sub_40A9C0(12, 1);
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 103 && *(_BYTE *)(v10 + v12 + 2) == 101 )
    {
      byte_4170F2 = 2;
      byte_417116 = 2;
      *(_BYTE *)(a7 + 1) = 0;
      goto LABEL_139;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 114 && *(_BYTE *)(v10 + v12 + 2) == 101 )
    {
      byte_417119 = 0;
      byte_4170F0 = 1;
      v43 = word_412FFC[byte_417110];
      byte_4170F2 = 0;
      byte_417104 = 0;
      word_417106 = 0;
      word_417108 = 0;
      word_41710A = 100;
      dword_417100 = 0;
      dword_4170FC = 0;
      word_41710C = v43;
      *(_DWORD *)(a1 + 20) += 3;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 101 && *(_BYTE *)(v10 + v12 + 2) == 99 )
    {
      ++byte_417119;
      *(_DWORD *)(a1 + 20) += 3;
      sub_40A9C0(3, 1);
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 101 && *(_BYTE *)(v10 + v12 + 2) == 106 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      if ( byte_417119 != (signed __int16)sub_404200(a1, a1) )
        goto LABEL_173;
      ++*(_DWORD *)(a1 + 20);
      goto LABEL_171;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 102 && *(_BYTE *)(v10 + v12 + 2) == 116 )
    {
      word_41710C = word_412FFC[byte_417110];
      *(_DWORD *)(a1 + 20) += 3;
      *(_BYTE *)a8 = sub_404200(a1, a1);
      ++*(_DWORD *)(a1 + 20);
      *(_WORD *)(a8 + 2) = sub_404200(a1, a1);
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 98 && *(_BYTE *)(v10 + v12 + 2) == 111 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      sub_404200(a1, a1);
      byte_413BEE = 1;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 112 && *(_BYTE *)(v10 + v12 + 2) == 112 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      *(_BYTE *)a6 = 2;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 112 && *(_BYTE *)(v10 + v12 + 2) == 115 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      *(_BYTE *)a6 = 3;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 112 && *(_BYTE *)(v10 + v12 + 2) == 102 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      *(_BYTE *)a6 = 4;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 112 && *(_BYTE *)(v10 + v12 + 2) == 100 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      *(_BYTE *)(a6 + 1) = sub_404200(a1, a1);
      *(_BYTE *)a6 = 1;
      sub_4024C0((int)&unk_412680, 144, 116, (int)&unk_412690, 12);
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 112 && *(_BYTE *)(v10 + v12 + 2) == 104 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      *(_BYTE *)a6 = 5;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 112 && *(_BYTE *)(v10 + v12 + 2) == 110 )
    {
      *(_DWORD *)(a1 + 20) += 3;
      *(_BYTE *)a6 = 6;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 116 && *(_BYTE *)(v10 + v12 + 2) == 101 )
    {
      *(_BYTE *)a1 = 7;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 101 && *(_BYTE *)(v10 + v12 + 2) == 110 )
    {
LABEL_96:
      *(_BYTE *)a1 = 8;
      return 0;
    }
    if ( *(_BYTE *)(v10 + v12 + 1) == 101 && *(_BYTE *)(v10 + v12 + 2) == 120 )
      return 1;
    if ( *(_BYTE *)(v10 + v12 + 1) == 42 )
      return 3;
    goto LABEL_95;
  }
  sub_40A9C0(13, 1);
  if ( !sub_403F90(a2, a3, a5, a4) )
  {
    *(_DWORD *)(a1 + 20) += 3;
    return 1;
  }
  word_41710A = 100;
  *(_DWORD *)(a1 + 20) += 3;
  return 2;
}
// 412FFC: using guessed type __int16 word_412FFC[];
// 413BEE: using guessed type char byte_413BEE;
// 416CA0: using guessed type int dword_416CA0;
// 4170F0: using guessed type char byte_4170F0;
// 4170F2: using guessed type char byte_4170F2;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417104: using guessed type char byte_417104;
// 417106: using guessed type __int16 word_417106;
// 417108: using guessed type __int16 word_417108;
// 41710A: using guessed type __int16 word_41710A;
// 41710C: using guessed type __int16 word_41710C;
// 417110: using guessed type char byte_417110;
// 417116: using guessed type char byte_417116;
// 417119: using guessed type char byte_417119;
// 417A44: using guessed type int dword_417A44;

//----- (00405210) --------------------------------------------------------
void __cdecl sub_405210(int a1)
{
  char v1; // al@2

  if ( *(_BYTE *)(a1 + 8) == 1 )
  {
    ++*(_BYTE *)(a1 + 24);
    sub_4024C0((int)&unk_412680, 8, 184, (int)&unk_412668, 8);
    sub_4024C0((int)&unk_4125C8, 24, *(_BYTE *)(a1 + 31) + 190, (int)&unk_412588, 6);
    sub_4024C0((int)&unk_4125C8, 24, *(_BYTE *)(a1 + 32) + 190, (int)&unk_412588, 7);
    v1 = *(_BYTE *)a1;
    if ( *(_BYTE *)a1 == 5 || v1 == 6 || v1 == 7 )
      sub_4042E0(a1);
  }
}

//----- (004052A0) --------------------------------------------------------
int __cdecl sub_4052A0(void *a1)
{
  int result; // eax@1

  result = 0;
  memset(a1, 0, 0x20u);
  return result;
}

//----- (004052B0) --------------------------------------------------------
int __cdecl sub_4052B0(int a1)
{
  int result; // eax@1

  result = a1;
  *(_BYTE *)a1 = 0;
  *(_BYTE *)(a1 + 8) = 0;
  *(_DWORD *)(a1 + 16) = 0;
  *(_BYTE *)(a1 + 24) = 0;
  *(_WORD *)(a1 + 26) = 0;
  *(_WORD *)(a1 + 28) = 4;
  *(_BYTE *)(a1 + 30) = 0;
  *(_BYTE *)(a1 + 31) = 0;
  *(_BYTE *)(a1 + 32) = 20;
  *(_BYTE *)(a1 + 33) = 0;
  return result;
}

//----- (004052E0) --------------------------------------------------------
int sub_4052E0()
{
  int v0; // ecx@1
  int result; // eax@1
  int v2; // edx@1
  int v3; // ecx@2

  v0 = dword_417A44 & (dword_417A44 ^ dword_416C9C);
  dword_416C9C = dword_417A44;
  result = dword_417A48;
  dword_416CA0 = v0;
  v2 = dword_417A48 ^ dword_416CA4;
  dword_416CA4 = dword_417A48;
  dword_416CAC = dword_417A48 & v2;
  if ( dword_417A48 )
    v3 = dword_416C98 + 1;
  else
    v3 = 0;
  dword_416C98 = v3;
  dword_416CA8 = 0;
  if ( v3 > 20 || v3 == 1 )
    dword_416CA8 = dword_417A48;
  return result;
}
// 416C98: using guessed type int dword_416C98;
// 416C9C: using guessed type int dword_416C9C;
// 416CA0: using guessed type int dword_416CA0;
// 416CA4: using guessed type int dword_416CA4;
// 416CA8: using guessed type int dword_416CA8;
// 416CAC: using guessed type int dword_416CAC;
// 417A44: using guessed type int dword_417A44;
// 417A48: using guessed type int dword_417A48;

//----- (00405350) --------------------------------------------------------
signed int __usercall sub_405350@<eax>(int a1@<edi>, int a2@<esi>, HWND hWnd)
{
  char *v3; // eax@1
  signed int v4; // ecx@1
  char *v5; // eax@3
  signed int v6; // ecx@3
  int v7; // ST50_4@5
  int v8; // ST48_4@5
  int v9; // ST40_4@5
  int v10; // ST38_4@5
  int v11; // ST30_4@5
  int v12; // ST28_4@5
  int v13; // ST20_4@5
  int v14; // ST58_4@5
  int v15; // ST50_4@5
  int v16; // ST48_4@5
  int v17; // ST40_4@5
  int v18; // ST38_4@5
  int v19; // ST30_4@5
  int v20; // ST28_4@5
  int v21; // ST20_4@5
  int v22; // ST58_4@5
  char v23; // bl@5
  DWORD v24; // esi@6
  DWORD v26; // esi@18
  DWORD v27; // esi@31
  DWORD v28; // esi@41
  char v29; // al@59
  DWORD v30; // esi@73
  DWORD v31; // esi@84
  DWORD v32; // esi@91
  int v33; // [sp+0h] [bp-2004h]@0
  _WORD v34[3]; // [sp+10h] [bp-1FF4h]@5
  char v35; // [sp+17h] [bp-1FEDh]@17
  int v36; // [sp+18h] [bp-1FECh]@8
  int v37; // [sp+1Ch] [bp-1FE8h]@1
  int v38; // [sp+20h] [bp-1FE4h]@1
  int v39; // [sp+24h] [bp-1FE0h]@1
  int v40; // [sp+28h] [bp-1FDCh]@19
  int v41; // [sp+2Ch] [bp-1FD8h]@1
  char v42; // [sp+30h] [bp-1FD4h]@64
  int v43; // [sp+34h] [bp-1FD0h]@16
  int v44; // [sp+44h] [bp-1FC0h]@1
  LPCSTR lpString; // [sp+48h] [bp-1FBCh]@16
  char v46; // [sp+4Ch] [bp-1FB8h]@43
  int v47; // [sp+54h] [bp-1FB0h]@17
  __int16 v48; // [sp+60h] [bp-1FA4h]@17
  char v49; // [sp+68h] [bp-1F9Ch]@1
  char v50; // [sp+88h] [bp-1F7Ch]@5
  int v51; // [sp+98h] [bp-1F6Ch]@30
  CHAR FileName; // [sp+D8h] [bp-1F2Ch]@14
  char v53; // [sp+1DCh] [bp-1E28h]@1
  int v54; // [sp+344h] [bp-1CC0h]@1
  char v55; // [sp+12E4h] [bp-D20h]@3

  sub_4062E0();
  sub_406310((int)aGameStart, 0, 0, 0);
  sub_4052A0(&v49);
  sub_406390((HLOCAL *)&v41);
  sub_4052B0((int)&v44);
  sub_40A6F0();
  sub_406E10((int)&v54);
  sub_401000();
  sub_403270((int)&v54);
  sub_402710(NULL);
  word_416C6A = 0;
  v38 = dword_4170F8 - 114688;
  byte_416C68 = 0;
  v37 = dword_4170F4 - 155648;
  LOWORD(v39) = 0;
  v3 = &v53;
  v4 = 10;
  do
  {
    *v3 = 0;
    v3 += 36;
    --v4;
  }
  while ( v4 );
  v5 = &v55;
  v6 = 120;
  do
  {
    *v5 = 0;
    v5 += 28;
    --v6;
  }
  while ( v6 );
  sub_40A8A0(a1, a2, aDash, 1, v33);
  sub_40A8A0(a1, a2, aOuch, 2, v7);
  sub_40A8A0(a1, a2, aItem, 3, v8);
  sub_40A8A0(a1, a2, aHithead, 4, v9);
  sub_40A8A0(a1, a2, aCrash, 5, v10);
  sub_40A8A0(a1, a2, aReady, 6, v11);
  sub_40A8A0(a1, a2, aGo, 7, v12);
  sub_40A8A0(a1, a2, aMessage, 8, v13);
  sub_40A8A0(a1, a2, aDead, 9, v14);
  sub_40A8A0(a1, a2, aWin, 10, v15);
  sub_40A8A0(a1, a2, aLevelup, 11, v16);
  sub_40A8A0(a1, a2, aLifeup, 12, v17);
  sub_40A8A0(a1, a2, aSave, 13, v18);
  sub_40A8A0(a1, a2, aYesno, 14, v19);
  sub_40A8A0(a1, a2, aNodmg, 0, v20);
  sub_40A8A0(a1, a2, aQuake, 15, v21);
  sub_40A8A0(a1, a2, aBossouch, 20, v22);
  sub_40AA30(0, 1200);
  sub_40AA30(15, 700);
  sub_40AA30(20, 1200);
  sub_4021D0((int)aPbmFade_pbm, 18);
  v23 = 0;
  sub_4083B0((int)&v50);
  v34[0] = 769;
  sub_408F10((int)v34);
  while ( 2 )
  {
    v24 = GetTickCount();
    sub_408F10((int)v34);
    sub_4052E0();
    sub_402600((int)&unk_412680, 0);
    if ( dword_416CA0 & 0x40 )
      BYTE1(v39) = 2;
    sub_4083F0((int *)&v50);
    if ( sub_403920((int)&v39, (int)&v36, &v53) == 1 )
      v23 = 6;
    sub_401E90(hWnd);
    do
    {
      sub_408BA0();
      if ( !sub_40B580() )
        return 1;
    }
    while ( GetTickCount() < v24 + 13 );
    if ( !v23 )
      continue;
    break;
  }
  sprintf(&FileName, aSS, &Filename, aEvent_ptx);
  if ( !sub_403D60(&FileName, (int)&v44) )
    return 1;
  sub_4021D0((int)aPbmMsgbox_pbm, 8);
  sub_4021D0((int)aPbmCursor_pbm, 14);
  sub_4021D0((int)aPbmYesno_pbm, 16);
  sub_402380(272, 16, 6);
  sub_402380(272, 16, 7);
  sub_403D40(lpString);
  sprintf(&FileName, aSS, &Filename, aPbmMap1_pbm);
  if ( sub_4065F0(&FileName, (int)&v43) )
  {
    LOBYTE(v44) = 1;
    v48 = 4;
    v47 = 1;
    v35 = 5;
    if ( v23 == 6 )
    {
LABEL_18:
      v26 = GetTickCount();
      sub_408F10((int)v34);
      sub_4052E0();
      sub_402600((int)&unk_412680, 0);
      if ( sub_404320((int)&v44, &v49, (int)&v41, (int)&v54, (int)&v43, (int)v34, (int)&v39, (int)&v36) == 2 )
      {
        v40 = 0;
        BYTE1(v39) = 3;
        v35 = 1;
      }
      if ( !(_BYTE)v44 )
        v23 = v35;
      sub_405210((int)&v44);
      sub_401E90(hWnd);
      while ( 1 )
      {
        sub_408BA0();
        if ( !sub_40B580() )
          return 1;
        if ( GetTickCount() >= v26 + 13 )
        {
          if ( v23 == 6 )
            goto LABEL_18;
          break;
        }
      }
    }
    if ( dword_417A44 & 0x80 )
    {
      v23 = 2;
    }
    else if ( v23 == 5 )
    {
      v34[0] = 257;
      sub_408F10((int)v34);
      v47 = 2;
      LOBYTE(v44) = 1;
    }
    sprintf(&FileName, aSS, &Filename, aWords_ptx);
    sub_4085A0((int)&v51, &FileName, 2);
    if ( v23 == 5 )
    {
LABEL_31:
      v27 = GetTickCount();
      sub_4052E0();
      sub_408F10((int)v34);
      sub_402600((int)&unk_412680, 0xFFFF);
      if ( sub_408620((int)&v51, (_BYTE *)v34) == 1 )
      {
        v23 = 1;
        LOBYTE(v39) = 1;
      }
      sub_401E90(hWnd);
      while ( 1 )
      {
        sub_408BA0();
        if ( !sub_40B580() )
          return 1;
        if ( GetTickCount() >= v27 + 13 )
        {
          if ( v23 == 5 )
            goto LABEL_31;
          break;
        }
      }
    }
    sub_408820((HLOCAL *)&v51);
    sub_402600((int)&unk_412680, 0);
    sub_4021D0((int)aPbmLoading_pbm, 12);
    sub_4024C0((int)&unk_412680, 144, 116, (int)&unk_412690, 12);
    sub_401E90(hWnd);
    sub_4021D0((int)aPbmPrtback_pbm, 70);
    sub_4021D0((int)aPbmPrtfilt_pbm, 71);
    sub_4021D0((int)aPbmPrtdir_pbm, 73);
    sub_4021D0((int)aPbmPrtblock_pb, 74);
    sub_4021D0((int)aPbmPrtdmg_pbm, 75);
    sub_4021D0((int)aPbmPrtitem_pbm, 72);
    sub_4021D0((int)aPbmPrtsnack_pb, 77);
    sub_4021D0((int)aPbmBack_pbm, 11);
    sub_4021D0((int)aPbmStatus_pbm, 0);
    sub_4021D0((int)aPbmFigure_pbm, 4);
    sub_4021D0((int)aPbmItem_pbm, 10);
    sub_4021D0((int)aPbmItembox_pbm, 9);
    sub_4021D0((int)aPbmHari_pbm, 80);
    sub_4021D0((int)aPbmIsogin_pbm, 81);
    sub_4021D0((int)aPbmKani_pbm, 82);
    sub_4021D0((int)aPbmSleep_pbm, 83);
    sub_4021D0((int)aPbmChibi_pbm, 84);
    sub_4021D0((int)aPbmHoshi_pbm, 85);
    sub_4021D0((int)aPbmDum_pbm, 86);
    sub_4021D0((int)aPbmCarry_pbm, 87);
    sub_4021D0((int)aPbmJuel_pbm, 88);
    sub_4021D0((int)aPbmUfo_pbm, 89);
    sub_4021D0((int)aPbmIronhead_pb, 100);
    sub_4021D0((int)aPbmMychar_pbm, 2);
    sub_4021D0((int)aPbmMychar2_pbm, 22);
    sub_4021D0((int)aPbmMychar3_pbm, 21);
    sub_4021D0((int)aPbmStar_pbm, 60);
    sub_4021D0((int)aPbmBubble_pbm, 61);
    sub_4021D0((int)aPbmDamage_pbm, 62);
    sub_4021D0((int)aPbmLevelup_pbm, 63);
    sub_4021D0((int)aPbmEditor_pbm, 15);
    sub_4021D0((int)aPbmNpctype_pbm, 13);
    sub_402380(320, 240, 19);
    v34[0] = 1;
    sub_408F10((int)v34);
    LOBYTE(v36) = 0;
    HIWORD(v36) = 0;
    v37 = dword_4170F4 - 155648;
    v38 = dword_4170F8 - 114688;
    sub_4021A0(17);
    sub_4021A0(20);
    if ( v23 == 2 )
    {
      sub_402820();
      goto LABEL_40;
    }
    if ( v23 != 7 )
    {
LABEL_40:
      while ( v23 != 1 )
      {
LABEL_72:
        if ( v23 == 3 )
        {
LABEL_73:
          v30 = GetTickCount();
          sub_4052E0();
          sub_408F10((int)v34);
          sub_402600((int)&unk_412680, 0);
          if ( !(_BYTE)v44 )
            sub_4064A0((int)&v41, (int)&v44);
          sub_4063B0((int)&v41);
          if ( dword_416CA0 & 0x80 )
            v23 = 1;
          sub_404320((int)&v44, &v49, (int)&v41, (int)&v54, (int)&v43, (int)v34, (int)&v39, (int)&v36);
          sub_405210((int)&v44);
          sub_40A060();
          sub_401E90(hWnd);
          while ( 1 )
          {
            sub_408BA0();
            if ( !sub_40B580() )
              return 1;
            if ( GetTickCount() >= v30 + 13 )
            {
              if ( v23 == 3 )
                goto LABEL_73;
              break;
            }
          }
        }
        if ( v23 == 2 )
        {
LABEL_84:
          v31 = GetTickCount();
          sub_4052E0();
          sub_402600((int)&unk_412680, 0);
          if ( dword_416CA0 & 0x80 )
            sub_403370((int)&v54);
          sub_406D10((int)&v36, (int)&v43);
          sub_406830((int)&v43, v37, v38);
          sub_407310((int)&v54, (int)&v36);
          sub_406950((int)&v43, v37, v38);
          sub_406A50((int)&v43, v37, v38);
          sub_402C20((int)&v54);
          sub_4028D0((int)&v54, (int)&v36);
          sub_403140((int)&v54);
          sub_402860();
          sub_404320((int)&v44, &v49, (int)&v41, (int)&v54, (int)&v43, (int)v34, (int)&v39, (int)&v36);
          sub_405210((int)&v44);
          sub_401E90(hWnd);
          while ( sub_40B580() )
          {
            if ( GetTickCount() >= v31 )
              goto LABEL_84;
          }
          return 1;
        }
        if ( v23 == 7 )
          goto LABEL_90;
      }
LABEL_41:
      v28 = GetTickCount();
      sub_408F10((int)v34);
      sub_4052E0();
      sub_402600((int)&unk_412680, 0);
      sub_406BE0((int)&v36, (int)&v54, (int)&v43);
      if ( dword_416CA0 & 0x20 )
        dword_4170F4 += 512;
      sub_406730((int)&v36);
      sub_406830((int)&v43, v37, v38);
      if ( !v46 )
        sub_401340(&v53);
      if ( byte_4170F2 != 2 )
        sub_4010B0((int)&v36);
      sub_401890((int)&v44, &v53);
      sub_407CE0((int)&v54, (int)&v43);
      if ( !v46 )
        sub_4079B0((int)&v54);
      sub_407310((int)&v54, (int)&v36);
      if ( byte_4170F0 )
      {
        if ( !v46 )
          sub_40A6D0((int)&v55);
        if ( byte_4170F2 != 2 )
        {
          sub_407E30((int)&v54, (int)&v44, &v53);
          sub_409CA0((int)&v43, &v53);
        }
        if ( !(word_417108 % 2) || v46 == 1 )
          sub_409F50((int)&v36);
      }
      if ( byte_4170F1 )
      {
        byte_4170F1 = 0;
        LOBYTE(v44) = 1;
        v47 = 6;
      }
      sub_406950((int)&v43, v37, v38);
      sub_406A50((int)&v43, v37, v38);
      sub_4037E0((int)&v55, (int)&v43, (int)&v36);
      sub_403840((int)&v53, (int)&v55);
      sub_403920((int)&v39, (int)&v36, &v53);
      v29 = sub_404320((int)&v44, &v49, (int)&v41, (int)&v54, (int)&v43, (int)v34, (int)&v39, (int)&v36);
      if ( v29 != 1 )
      {
        if ( v29 == 3 )
          v23 = 7;
        sub_405210((int)&v44);
        if ( dword_416CA0 & 0x80 && !(_BYTE)v44 )
        {
          sub_402440(19, (int)&unk_412680);
          v23 = 3;
          v42 = 0;
        }
        sub_40A060();
        if ( dword_4170F8 < -32768 && !v46 )
        {
          v46 = 1;
          v47 = 4000;
          LOBYTE(v44) = 1;
        }
        sub_401E90(hWnd);
        while ( 1 )
        {
          sub_408BA0();
          if ( !sub_40B580() )
            break;
          if ( GetTickCount() >= v28 + 13 )
          {
            if ( v23 == 1 )
              goto LABEL_41;
            goto LABEL_72;
          }
        }
      }
      return 1;
    }
LABEL_90:
    v34[0] = 1281;
    sub_408F10((int)v34);
    sub_4021D0((int)aPbmStaff_pbm, 20);
    sub_4021D0((int)aPbmEnd_pbm, 23);
    sprintf(&FileName, aSS, &Filename, aStaff_ptx);
    sub_4085A0((int)&v51, &FileName, 4);
    if ( v23 == 7 )
    {
LABEL_91:
      v32 = GetTickCount();
      sub_4052E0();
      sub_408F10((int)v34);
      sub_402600((int)&unk_412680, 0);
      sub_408620((int)&v51, (_BYTE *)v34);
      sub_401E90(hWnd);
      while ( 1 )
      {
        sub_408BA0();
        if ( !sub_40B580() )
          return 1;
        if ( GetTickCount() >= v32 + 13 )
          goto LABEL_91;
      }
    }
  }
  return 0;
}
// 416C68: using guessed type char byte_416C68;
// 416C6A: using guessed type __int16 word_416C6A;
// 416CA0: using guessed type int dword_416CA0;
// 4170F0: using guessed type char byte_4170F0;
// 4170F1: using guessed type char byte_4170F1;
// 4170F2: using guessed type char byte_4170F2;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 417108: using guessed type __int16 word_417108;
// 417A44: using guessed type int dword_417A44;

//----- (00406070) --------------------------------------------------------
signed int __cdecl sub_406070(int a1, signed int *a2, int a3)
{
  signed int result; // eax@1
  const void **v4; // edx@1
  char v5; // [sp+Ch] [bp-44h]@1
  char *v6; // [sp+1Ch] [bp-34h]@1
  char *v7; // [sp+20h] [bp-30h]@1
  char *v8; // [sp+24h] [bp-2Ch]@1
  char *v9; // [sp+28h] [bp-28h]@1
  char *v10; // [sp+2Ch] [bp-24h]@1
  char *v11; // [sp+30h] [bp-20h]@1
  char *v12; // [sp+34h] [bp-1Ch]@1
  char *v13; // [sp+38h] [bp-18h]@1
  char *v14; // [sp+3Ch] [bp-14h]@1
  char *v15; // [sp+40h] [bp-10h]@1
  char *v16; // [sp+44h] [bp-Ch]@1
  char *v17; // [sp+48h] [bp-8h]@1
  char *v18; // [sp+4Ch] [bp-4h]@1

  v6 = aXxx;
  v7 = aJan;
  v8 = aFeb;
  v9 = aMar;
  v10 = aApr;
  v11 = aMay;
  v12 = aJun;
  v13 = aJul;
  v14 = aAug;
  v15 = aSep;
  v16 = aOct;
  v17 = aNov;
  v18 = aDec;
  sscanf(aNov92003, aSDD, &v5, a3, a1);
  result = 0;
  v4 = (const void **)&v6;
  while ( memcmp(&v5, *v4, 3u) )
  {
    ++result;
    ++v4;
    if ( result >= 12 )
    {
      *a2 = result;
      return result;
    }
  }
  *a2 = result;
  return result;
}

//----- (00406140) --------------------------------------------------------
signed int __cdecl sub_406140(_DWORD *a1, _DWORD *a2, _DWORD *a3, _DWORD *a4)
{
  signed int v4; // ebx@1
  DWORD v5; // eax@1
  DWORD v6; // esi@1
  void *v7; // eax@2
  const void *v8; // edi@2
  _WORD *v9; // eax@5
  LPVOID lpBuffer; // [sp+Ch] [bp-110h]@4
  DWORD dwHandle; // [sp+10h] [bp-10Ch]@1
  unsigned int puLen; // [sp+14h] [bp-108h]@4
  CHAR Filename; // [sp+18h] [bp-104h]@1

  v4 = 0;
  GetModuleFileNameA(NULL, &Filename, 0x104u);
  v5 = GetFileVersionInfoSizeA(&Filename, &dwHandle);
  v6 = v5;
  if ( v5 )
  {
    v7 = malloc(v5);
    v8 = v7;
    if ( v7 )
    {
      if ( GetFileVersionInfoA(&Filename, 0, v6, v7) && VerQueryValueA(v8, SubBlock, &lpBuffer, &puLen) )
      {
        v9 = lpBuffer;
        v4 = 1;
        *a1 = *((_DWORD *)lpBuffer + 2) >> 16;
        *a2 = v9[4];
        *a3 = *((_DWORD *)v9 + 3) >> 16;
        *a4 = v9[6];
      }
      free((void *)v8);
    }
  }
  return v4;
}

//----- (00406210) --------------------------------------------------------
BOOL __cdecl sub_406210(HWND hwnd)
{
  unsigned int v1; // ecx@1
  char v2; // dl@2
  HINSTANCE v3; // ebx@3
  HINSTANCE v4; // eax@3
  char v6; // [sp+Bh] [bp-30Dh]@2
  CHAR Buffer[260]; // [sp+Ch] [bp-30Ch]@1
  CHAR File; // [sp+110h] [bp-208h]@1
  CHAR v9; // [sp+214h] [bp-104h]@3

  GetSystemDirectoryA(Buffer, 0x104u);
  sprintf(&File, aSSndvol32_exe, Buffer);
  v1 = strlen(Buffer);
  if ( Buffer[v1] != 92 )
  {
    do
      v2 = *(&v6 + v1--);
    while ( v2 != 92 );
  }
  Buffer[v1] = 0;
  sprintf(&v9, aSSndvol32_exe, Buffer);
  v3 = ShellExecuteA(hwnd, Operation, &File, NULL, NULL, 5);
  v4 = ShellExecuteA(hwnd, Operation, &v9, NULL, NULL, 5);
  return (signed int)v3 > 32 || (signed int)v4 > 32;
}
// 406210: using guessed type CHAR Buffer[260];

//----- (004062E0) --------------------------------------------------------
BOOL sub_4062E0()
{
  CHAR FileName; // [sp+0h] [bp-104h]@1

  sprintf(&FileName, aSDebug_txt, &Filename);
  return DeleteFileA(&FileName);
}

//----- (00406310) --------------------------------------------------------
FILE *__cdecl sub_406310(int a1, int a2, int a3, int a4)
{
  FILE *result; // eax@1
  FILE *v5; // esi@1
  char v6; // [sp+4h] [bp-104h]@1

  sprintf(&v6, aSDebug_txt, &Filename);
  result = fopen(&v6, aAT);
  v5 = result;
  if ( result )
  {
    fprintf(result, aSDDD, a1, a2, a3, a4);
    fclose(v5);
    result = (FILE *)1;
  }
  return result;
}

//----- (00406390) --------------------------------------------------------
signed int __cdecl sub_406390(HLOCAL *a1)
{
  signed int result; // eax@1

  *a1 = LocalAlloc(0x40u, 0xAu);
  result = 0;
  do
    *((char *)*a1 + ++result - 1) = 0;
  while ( result < 10 );
  return result;
}

//----- (004063B0) --------------------------------------------------------
int __cdecl sub_4063B0(int a1)
{
  int v1; // edi@1
  int v2; // esi@1
  int v4; // [sp+Ch] [bp-30h]@1
  int v5; // [sp+10h] [bp-2Ch]@1
  int v6; // [sp+14h] [bp-28h]@1
  int v7; // [sp+18h] [bp-24h]@1
  int v8; // [sp+1Ch] [bp-20h]@1
  int v9; // [sp+20h] [bp-1Ch]@1
  int v10; // [sp+24h] [bp-18h]@1
  int v11; // [sp+28h] [bp-14h]@1
  int v12; // [sp+2Ch] [bp-10h]@1
  int v13; // [sp+30h] [bp-Ch]@1
  int v14; // [sp+34h] [bp-8h]@1
  int v15; // [sp+38h] [bp-4h]@1

  v1 = 0;
  v8 = 0;
  v9 = 0;
  v10 = 176;
  v11 = 32;
  v4 = 0;
  v5 = 0;
  v6 = 0;
  v7 = 16;
  v12 = 32;
  v13 = 0;
  v14 = 48;
  v15 = 16;
  sub_4024C0((int)&unk_412680, 0, 0, (int)&unk_412680, 19);
  sub_4024C0((int)&unk_412680, 72, 128, (int)&v8, 9);
  v2 = 80;
  do
  {
    v4 = 16 * *(_BYTE *)(*(_DWORD *)a1 + v1) - 16;
    v6 = v4 + 16;
    sub_4024C0((int)&unk_412680, v2, 136, (int)&v4, 10);
    v2 += 16;
    ++v1;
  }
  while ( v2 < 240 );
  return sub_4024C0((int)&unk_412680, 16 * (*(_BYTE *)(a1 + 4) + 5), 136, (int)&v12, 14);
}

//----- (004064A0) --------------------------------------------------------
char __cdecl sub_4064A0(int a1, int a2)
{
  char result; // al@1
  int v3; // edx@9

  result = dword_416CA0;
  if ( dword_416CA0 & 1 )
  {
    sub_40A9C0(1, 1);
    result = *(_BYTE *)(a1 + 4) - 1;
    *(_BYTE *)(a1 + 4) = result;
    if ( result < 0 )
      *(_BYTE *)(a1 + 4) = 9;
  }
  if ( dword_416CA0 & 2 )
  {
    sub_40A9C0(1, 1);
    result = *(_BYTE *)(a1 + 4) + 1;
    *(_BYTE *)(a1 + 4) = result;
    if ( result >= 10 )
      *(_BYTE *)(a1 + 4) = 0;
  }
  if ( dword_416CA0 & 0x40 )
  {
    sub_40A9C0(1, 1);
    result = *(_BYTE *)(*(_BYTE *)(a1 + 4) + *(_DWORD *)a1);
    if ( result )
    {
      v3 = result;
      result = a2;
      *(_DWORD *)(a2 + 16) = v3 + 2000;
      *(_BYTE *)a2 = 1;
    }
  }
  return result;
}
// 416CA0: using guessed type int dword_416CA0;

//----- (00406530) --------------------------------------------------------
signed int __cdecl sub_406530(_DWORD *a1, char a2)
{
  int v2; // eax@1

  v2 = 0;
  while ( *(_BYTE *)(*a1 + v2) != a2 )
  {
    if ( ++v2 >= 10 )
      return 0;
  }
  return 1;
}

//----- (00406550) --------------------------------------------------------
signed int __cdecl sub_406550(int *a1, char a2)
{
  signed int v2; // eax@1
  int v3; // ecx@2
  signed int result; // eax@5

  v2 = sub_406530(a1, a2);
  if ( v2 )
  {
LABEL_5:
    result = 0;
  }
  else
  {
    v3 = *a1;
    while ( *(_BYTE *)(v3 + v2) )
    {
      if ( ++v2 >= 10 )
        goto LABEL_5;
    }
    *(_BYTE *)(v3 + v2) = a2;
    byte_4170F3 |= byte_412A60[a2];
    result = 1;
  }
  return result;
}
// 4170F2: using guessed type char byte_4170F2;
// 4170F3: using guessed type char byte_4170F3;

//----- (004065A0) --------------------------------------------------------
signed int __cdecl sub_4065A0(int *a1, char a2)
{
  int v2; // ecx@2
  int v3; // eax@2
  signed int result; // eax@5

  if ( sub_406530(a1, a2) == 1 )
  {
    v2 = *a1;
    v3 = 0;
    while ( *(_BYTE *)(v2 + v3) != a2 )
    {
      if ( ++v3 >= 10 )
        goto LABEL_5;
    }
    *(_BYTE *)(v2 + v3) = 0;
    byte_4170F3 &= ~byte_412A60[a2];
    result = 1;
  }
  else
  {
LABEL_5:
    result = 0;
  }
  return result;
}
// 4170F3: using guessed type char byte_4170F3;

//----- (004065F0) --------------------------------------------------------
FILE *__cdecl sub_4065F0(char *a1, int a2)
{
  FILE *result; // eax@1
  FILE *v3; // edi@1
  int v4; // eax@6
  int v5; // ecx@6
  char *v6; // eax@6
  char *v7; // esi@6
  unsigned int v8; // ecx@6
  int v9; // edi@6
  int v10; // edx@6
  int v11; // eax@6
  int v12; // esi@7
  bool v13; // sf@7
  unsigned __int8 v14; // of@7
  char *v15; // [sp+4h] [bp-440h]@6
  char *v16; // [sp+8h] [bp-43Ch]@6
  char v17; // [sp+Ch] [bp-438h]@2
  int v18; // [sp+10h] [bp-434h]@6
  int v19; // [sp+14h] [bp-430h]@6
  __int16 v20; // [sp+1Ah] [bp-42Ah]@4
  __int16 v21; // [sp+34h] [bp-410h]@2
  char v22; // [sp+44h] [bp-400h]@2

  result = fopen(a1, aRb);
  v3 = result;
  if ( result )
  {
    fread(&v21, 0xEu, 1u, result);
    fread(&v17, 0x28u, 1u, v3);
    fread(&v22, 4u, 0x100u, v3);
    if ( v21 == 19778 )
    {
      if ( v20 == 8 )
      {
        v4 = v19;
        v5 = v18;
        *(_DWORD *)(a2 + 12) = v19;
        *(_DWORD *)(a2 + 8) = v5;
        v15 = (char *)malloc(v5 * v4);
        v6 = (char *)malloc(v18 * v19);
        v7 = v6;
        v16 = v6;
        fread(v6, 1u, v18 * v19, v3);
        fclose(v3);
        v8 = *(_DWORD *)(a2 + 8);
        v9 = *(_DWORD *)(a2 + 12);
        v10 = 0;
        v11 = v8 * (v9 - 1);
        if ( v9 * *(_DWORD *)(a2 + 8) > 0 )
        {
          do
          {
            qmemcpy(&v15[v11], &v7[v10], v8);
            v8 = *(_DWORD *)(a2 + 8);
            v12 = v8 * *(_DWORD *)(a2 + 12);
            v10 += v8;
            v11 -= v8;
            v14 = __OFSUB__(v10, v12);
            v13 = v10 - v12 < 0;
            v7 = v16;
          }
          while ( v13 ^ v14 );
        }
        free(v7);
        *(_DWORD *)a2 = v15;
        result = (FILE *)1;
      }
      else
      {
        result = NULL;
      }
    }
    else
    {
      result = NULL;
    }
  }
  return result;
}

//----- (00406730) --------------------------------------------------------
int __cdecl sub_406730(int a1)
{
  signed int v1; // esi@1
  signed __int64 v2; // rax@2
  int result; // eax@2
  int v4; // [sp+Ch] [bp-20h]@1
  int v5; // [sp+10h] [bp-1Ch]@1
  int v6; // [sp+14h] [bp-18h]@1
  int v7; // [sp+18h] [bp-14h]@1
  int v8; // [sp+1Ch] [bp-10h]@1
  int v9; // [sp+20h] [bp-Ch]@1
  int v10; // [sp+24h] [bp-8h]@1
  int v11; // [sp+28h] [bp-4h]@1

  v1 = 0;
  v4 = 0;
  v5 = 0;
  v6 = 32;
  v7 = 32;
  v8 = 32;
  v9 = 0;
  v10 = 64;
  v11 = 32;
  do
  {
    v2 = 2863311532i64 * (*(_DWORD *)(a1 + 4) / 1024);
    result = sub_4024C0(
               (int)&unk_412680,
               32 * (v1 % 13) - (signed int)((HIDWORD(v2) >> 31) + HIDWORD(v2)) % 64,
               32 * (v1 / 13) - 2 * (*(_DWORD *)(a1 + 8) / 1024) / 3 % 64,
               (int)(&v4 + 4 * (v1 % 2)),
               11);
    ++v1;
  }
  while ( v1 < 143 );
  return result;
}

//----- (00406830) --------------------------------------------------------
int __cdecl sub_406830(int a1, signed int a2, signed int a3)
{
  int result; // eax@1
  int v4; // edi@1
  int v5; // ecx@1
  int v6; // edx@1
  int v7; // ebp@2
  int v8; // ebx@3
  int v9; // esi@4
  int v10; // ecx@6
  int v11; // [sp+4h] [bp-Ch]@1
  int v12; // [sp+8h] [bp-8h]@1
  int v13; // [sp+Ch] [bp-4h]@1
  int v14; // [sp+18h] [bp+8h]@1
  char v15; // [sp+1Ch] [bp+Ch]@5

  v12 = a2 / 1024;
  v11 = a3 / 1024;
  result = (((unsigned __int64)(a3 / 1024) >> 32) & 0xF) + a3 / 1024;
  v4 = a3 / 1024 / 16;
  v5 = a2 / 1024 / 16;
  v6 = v4 + 16;
  v14 = a2 / 1024 / 16;
  v13 = v4 + 16;
  if ( __OFSUB__(v4, v4 + 16) ^ 1 )
  {
    result = v5 + 21;
    v7 = 16 * v4;
    do
    {
      v8 = v5;
      if ( v5 < result )
      {
        v9 = 16 * v5;
        do
        {
          v15 = *(_BYTE *)(*(_DWORD *)a1 + *(_DWORD *)(a1 + 8) * v4 + v8);
          if ( v15 )
          {
            v10 = v15 & 0xE0;
            if ( v10 == 128 || !(v15 & 0xE0) || v10 == 160 || v10 == 64 || v10 == 224 )
              sub_4024C0(
                (int)&unk_412680,
                v9 - v12,
                v7 - v11,
                (int)&unk_412A70 + 16 * ((unsigned __int8)v15 % 32),
                ((unsigned int)(unsigned __int8)v15 >> 5) + 70);
            v5 = v14;
          }
          ++v8;
          result = v5 + 21;
          v9 += 16;
        }
        while ( v8 < v5 + 21 );
        v6 = v13;
      }
      ++v4;
      v7 += 16;
    }
    while ( v4 < v6 );
  }
  return result;
}

//----- (00406950) --------------------------------------------------------
int __cdecl sub_406950(int a1, signed int a2, signed int a3)
{
  int result; // eax@1
  int v4; // edi@1
  int v5; // ecx@1
  int v6; // edx@1
  int v7; // ebp@2
  int v8; // ebx@3
  int v9; // esi@4
  int v10; // [sp+4h] [bp-Ch]@1
  int v11; // [sp+8h] [bp-8h]@1
  char v12; // [sp+18h] [bp+8h]@5
  int v13; // [sp+1Ch] [bp+Ch]@1

  v10 = a2 / 1024;
  v13 = a3 / 1024;
  result = (((unsigned __int64)v13 >> 32) & 0xF) + v13;
  v4 = v13 / 16;
  v5 = a2 / 1024 / 16;
  v6 = v13 / 16 + 16;
  v11 = a2 / 1024 / 16;
  if ( v13 / 16 < v6 )
  {
    result = v5 + 21;
    v7 = 16 * v4;
    do
    {
      v8 = v5;
      if ( v5 < result )
      {
        v9 = 16 * v5;
        do
        {
          v12 = *(_BYTE *)(*(_DWORD *)a1 + *(_DWORD *)(a1 + 8) * v4 + v8);
          if ( v12 )
          {
            if ( (v12 & 0xE0) == 32 )
            {
              sub_4024C0(
                (int)&unk_412680,
                v9 - v10,
                v7 - v13,
                (int)&unk_412A70 + 16 * ((unsigned __int8)v12 % 32),
                ((unsigned int)(unsigned __int8)v12 >> 5) + 70);
              v5 = v11;
            }
          }
          ++v8;
          result = v5 + 21;
          v9 += 16;
        }
        while ( v8 < v5 + 21 );
        v6 = v13 / 16 + 16;
      }
      ++v4;
      v7 += 16;
    }
    while ( v4 < v6 );
  }
  return result;
}

//----- (00406A50) --------------------------------------------------------
int __cdecl sub_406A50(int a1, signed int a2, signed int a3)
{
  int v3; // esi@1
  int v4; // ebx@1
  unsigned __int8 v5; // cl@1
  int v6; // ebp@1
  int result; // eax@1
  int v8; // ecx@3
  int v9; // edi@3
  int v10; // edx@3
  int v11; // ecx@4
  int v12; // edi@6
  int v13; // [sp+10h] [bp-4Ch]@1
  int v14; // [sp+14h] [bp-48h]@1
  int v15; // [sp+18h] [bp-44h]@3
  int v16; // [sp+1Ch] [bp-40h]@3
  int v17; // [sp+20h] [bp-3Ch]@3
  int v18; // [sp+24h] [bp-38h]@3
  int v19; // [sp+28h] [bp-34h]@3
  int v20; // [sp+2Ch] [bp-30h]@3
  int v21; // [sp+30h] [bp-2Ch]@3
  int v22; // [sp+34h] [bp-28h]@3
  int v23; // [sp+38h] [bp-24h]@3
  int v24; // [sp+3Ch] [bp-20h]@3
  int v25; // [sp+40h] [bp-1Ch]@3
  int v26; // [sp+44h] [bp-18h]@3
  int v27; // [sp+48h] [bp-14h]@3
  int v28; // [sp+4Ch] [bp-10h]@3
  int v29; // [sp+50h] [bp-Ch]@3
  int v30; // [sp+54h] [bp-8h]@3
  int v31; // [sp+58h] [bp-4h]@3
  char v32; // [sp+60h] [bp+4h]@7
  int v33; // [sp+64h] [bp+8h]@4
  int v34; // [sp+68h] [bp+Ch]@3

  v3 = a1;
  v4 = a2 / 1024;
  v5 = *(_BYTE *)(a1 + 4) + 2;
  *(_BYTE *)(a1 + 4) = v5;
  v14 = a3 / 1024;
  v6 = a2 / 1024 / 16;
  result = a3 / 1024 / 16;
  v13 = a2 / 1024 / 16;
  if ( v5 >= 0x10u )
    *(_BYTE *)(a1 + 4) = 0;
  v17 = 0;
  v8 = *(_BYTE *)(a1 + 4);
  v23 = 16;
  v16 = v8;
  v25 = v8;
  v26 = 16;
  v18 = v8 + 16;
  v19 = 16;
  v20 = 16 - v8;
  v29 = 16 - v8;
  v22 = 16 - v8 + 16;
  v21 = 0;
  v24 = 0;
  v28 = 0;
  v31 = 16 - v8 + 16;
  v9 = result + 16;
  v10 = a3 / 1024 / 16;
  v27 = v8 + 16;
  v30 = 16;
  v34 = a3 / 1024 / 16;
  v15 = result + 16;
  if ( __OFSUB__(result, result + 16) ^ 1 )
  {
    v11 = v6 + 21;
    v33 = 16 * result;
    do
    {
      if ( v6 < v11 )
      {
        v12 = 16 * v6;
        do
        {
          v32 = *(_BYTE *)(*(_DWORD *)v3 + v10 * *(_DWORD *)(v3 + 8) + v6);
          if ( *(_BYTE *)(*(_DWORD *)v3 + v10 * *(_DWORD *)(v3 + 8) + v6) )
          {
            if ( (v32 & 0xE0) == 96 )
            {
              sub_4024C0(
                (int)&unk_412680,
                v12 - v4,
                v33 - v14,
                (int)(&v16 + 4 * ((unsigned __int8)v32 % 32)),
                ((unsigned int)(unsigned __int8)v32 >> 5) + 70);
              v10 = v34;
            }
          }
          ++v6;
          v12 += 16;
          v11 = v13 + 21;
        }
        while ( v6 < v13 + 21 );
        v9 = v15;
        v6 = v13;
      }
      ++v10;
      result = v33 + 16;
      v34 = v10;
      v33 += 16;
    }
    while ( v10 < v9 );
  }
  return result;
}

//----- (00406BE0) --------------------------------------------------------
int __cdecl sub_406BE0(int a1, int a2, int a3)
{
  int v3; // esi@4
  int v4; // ebx@4
  int v5; // edi@8
  int v6; // edi@10
  int v7; // esi@12
  int v8; // esi@14
  int v9; // eax@18
  int result; // eax@22

  if ( *(_BYTE *)a1 )
  {
    if ( *(_BYTE *)a1 == 1 )
    {
      v3 = *(_DWORD *)(a2 + 40 * *(_WORD *)(a1 + 2) + 16);
      v4 = *(_DWORD *)(a2 + 40 * *(_WORD *)(a1 + 2) + 20);
    }
    else if ( *(_BYTE *)a1 == 2 )
    {
      v3 = dword_413BF8;
      v4 = dword_413BFC;
    }
    else
    {
      v3 = a1;
      v4 = a1;
    }
  }
  else
  {
    v3 = dword_4170F4;
    v4 = dword_4170F8;
  }
  v5 = *(_DWORD *)(a1 + 4);
  if ( v3 < v5 + 155648 )
    *(_DWORD *)(a1 + 4) = v5 + (v3 - v5 - 155648) / 16;
  v6 = *(_DWORD *)(a1 + 4);
  if ( v3 > v6 + 155648 )
    *(_DWORD *)(a1 + 4) = v6 + (v3 - v6 - 155648) / 16;
  v7 = *(_DWORD *)(a1 + 8);
  if ( v4 < v7 + 122880 )
    *(_DWORD *)(a1 + 8) = v7 + (v4 - v7 - 122880) / 16;
  v8 = *(_DWORD *)(a1 + 8);
  if ( v4 > v8 + 122880 )
    *(_DWORD *)(a1 + 8) = v8 + (v4 - v8 - 122880) / 16;
  if ( *(_DWORD *)(a1 + 4) < 0 )
    *(_DWORD *)(a1 + 4) = 0;
  v9 = (*(_DWORD *)(a3 + 8) - 20) << 14;
  if ( *(_DWORD *)(a1 + 4) > v9 )
    *(_DWORD *)(a1 + 4) = v9;
  if ( *(_DWORD *)(a1 + 8) < 0 )
    *(_DWORD *)(a1 + 8) = 0;
  result = (*(_DWORD *)(a3 + 12) - 15) << 14;
  if ( *(_DWORD *)(a1 + 8) > result )
    *(_DWORD *)(a1 + 8) = result;
  return result;
}
// 413BF8: using guessed type int dword_413BF8;
// 413BFC: using guessed type int dword_413BFC;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;

//----- (00406D10) --------------------------------------------------------
int __cdecl sub_406D10(int a1, int a2)
{
  int result; // eax@1
  char v3; // cl@9
  bool v4; // sf@10
  unsigned __int8 v5; // of@10
  int v6; // ecx@22
  int v7; // ecx@26

  result = a1;
  if ( dword_416CA0 & 1 )
    *(_DWORD *)(a1 + 4) -= 4096;
  if ( dword_416CA0 & 2 )
    *(_DWORD *)(a1 + 4) += 4096;
  if ( dword_416CA0 & 4 )
    *(_DWORD *)(a1 + 8) -= 4096;
  if ( dword_416CA0 & 8 )
    *(_DWORD *)(a1 + 8) += 4096;
  v3 = dword_417A44;
  if ( dword_417A44 & 0xF )
  {
    v5 = __OFSUB__(dword_416CB0 + 1, 20);
    v4 = dword_416CB0++ - 19 < 0;
    if ( !(v4 ^ v5) )
    {
      dword_416CB0 = 20;
      if ( dword_417A44 & 1 )
      {
        *(_DWORD *)(a1 + 4) -= 4096;
        v3 = dword_417A44;
      }
      if ( v3 & 2 )
      {
        *(_DWORD *)(a1 + 4) += 4096;
        v3 = dword_417A44;
      }
      if ( v3 & 4 )
      {
        *(_DWORD *)(a1 + 8) -= 4096;
        v3 = dword_417A44;
      }
      if ( v3 & 8 )
        *(_DWORD *)(a1 + 8) += 4096;
    }
  }
  else
  {
    dword_416CB0 = 0;
  }
  if ( *(_DWORD *)(a1 + 4) < 0 )
    *(_DWORD *)(a1 + 4) = 0;
  v6 = (*(_DWORD *)(a2 + 8) - 20) << 14;
  if ( *(_DWORD *)(a1 + 4) > v6 )
    *(_DWORD *)(a1 + 4) = v6;
  if ( *(_DWORD *)(a1 + 8) < 0 )
    *(_DWORD *)(a1 + 8) = 0;
  v7 = (*(_DWORD *)(a2 + 12) - 15) << 14;
  if ( *(_DWORD *)(a1 + 8) > v7 )
    *(_DWORD *)(a1 + 8) = v7;
  return result;
}
// 416CA0: using guessed type int dword_416CA0;
// 416CB0: using guessed type int dword_416CB0;
// 417A44: using guessed type int dword_417A44;

//----- (00406E10) --------------------------------------------------------
int __cdecl sub_406E10(int a1)
{
  signed int v1; // edx@1
  int result; // eax@1

  v1 = 100;
  result = a1 + 2;
  do
  {
    *(_BYTE *)(result - 2) = 0;
    *(_BYTE *)(result - 1) = 0;
    *(_BYTE *)result = 0;
    *(_WORD *)(result + 2) = 0;
    *(_WORD *)(result + 4) = 0;
    *(_BYTE *)(result + 6) = 0;
    *(_BYTE *)(result + 7) = 0;
    *(_WORD *)(result + 8) = 0;
    *(_BYTE *)(result + 10) = 0;
    *(_DWORD *)(result + 14) = 0;
    *(_DWORD *)(result + 18) = 0;
    *(_DWORD *)(result + 22) = 0;
    *(_DWORD *)(result + 26) = 0;
    *(_DWORD *)(result + 30) = 0;
    *(_DWORD *)(result + 34) = 0;
    result += 40;
    --v1;
  }
  while ( v1 );
  return result;
}

//----- (00406E60) --------------------------------------------------------
int __cdecl sub_406E60(int a1, int a2)
{
  int result; // eax@2

  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               *(_DWORD *)(a1 + 16) / 1024 - *(_DWORD *)(a2 + 4) / 1024,
               *(_DWORD *)(a1 + 20) / 1024 - *(_DWORD *)(a2 + 8) / 1024,
               (int)&unk_412B60 + 16 * (char)(*(_BYTE *)(a1 + 9) + 4 * *(_BYTE *)(a1 + 12)),
               *(_BYTE *)(a1 + 2) + 80);
  return result;
}

//----- (00406EF0) --------------------------------------------------------
int __cdecl sub_406EF0(int a1, int a2)
{
  char *v2; // edx@2
  signed int v3; // edi@2
  int v4; // esi@2
  signed int v5; // eax@2
  int v6; // esi@2
  int v7; // eax@2
  int v8; // ST10_4@2
  signed int v9; // eax@2
  int result; // eax@2
  int v11; // [sp+0h] [bp-10h]@2
  int v12; // [sp+4h] [bp-Ch]@2
  int v13; // [sp+8h] [bp-8h]@2
  int v14; // [sp+Ch] [bp-4h]@2

  if ( *(_BYTE *)a1 )
  {
    v2 = (char *)&unk_412BE0 + 16 * (char)(*(_BYTE *)(a1 + 9) + 2 * *(_BYTE *)(a1 + 12));
    v3 = *(_DWORD *)(a1 + 16);
    v4 = *(_DWORD *)v2;
    v12 = *((_DWORD *)v2 + 1);
    v13 = *((_DWORD *)v2 + 2);
    v5 = *(_DWORD *)(a1 + 32) - v3;
    v14 = *((_DWORD *)v2 + 3);
    v6 = 16 * (v5 / 0x4000) + v4;
    v7 = *(_BYTE *)(a1 + 2) + 80;
    v11 = v6;
    v8 = v7;
    v9 = *(_DWORD *)(a1 + 20);
    v13 = v6 + 16;
    result = sub_4024C0(
               (int)&unk_412680,
               v3 / 1024 - *(_DWORD *)(a2 + 4) / 1024,
               v9 / 1024 - *(_DWORD *)(a2 + 8) / 1024,
               (int)&v11,
               v8);
  }
  return result;
}

//----- (00406FC0) --------------------------------------------------------
int __cdecl sub_406FC0(int a1, int a2)
{
  int result; // eax@2

  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               *(_DWORD *)(a1 + 16) / 1024 - *(_DWORD *)(a2 + 4) / 1024,
               *(_DWORD *)(a1 + 20) / 1024 - *(_DWORD *)(a2 + 8) / 1024,
               (int)&unk_412C20 + 16 * (char)(*(_BYTE *)(a1 + 9) + 4 * *(_BYTE *)(a1 + 12)),
               *(_BYTE *)(a1 + 2) + 80);
  return result;
}

//----- (00407050) --------------------------------------------------------
int __cdecl sub_407050(int a1, int a2)
{
  int result; // eax@2

  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               *(_DWORD *)(a1 + 16) / 1024 - *(_DWORD *)(a2 + 4) / 1024 - 2,
               *(_DWORD *)(a1 + 20) / 1024 - *(_DWORD *)(a2 + 8) / 1024 - 4,
               (int)&unk_412CA0 + 16 * *(_BYTE *)(a1 + 9),
               *(_BYTE *)(a1 + 2) + 80);
  return result;
}

//----- (004070E0) --------------------------------------------------------
int __cdecl sub_4070E0(int a1, int a2)
{
  int result; // eax@2

  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               *(_DWORD *)(a1 + 16) / 1024 - *(_DWORD *)(a2 + 4) / 1024 + 4,
               *(_DWORD *)(a1 + 20) / 1024 - *(_DWORD *)(a2 + 8) / 1024 + 4,
               (int)&unk_412CE0 + 16 * (char)(*(_BYTE *)(a1 + 9) + 2 * *(_BYTE *)(a1 + 12)),
               *(_BYTE *)(a1 + 2) + 80);
  return result;
}

//----- (00407170) --------------------------------------------------------
int __cdecl sub_407170(int a1, int a2)
{
  int result; // eax@2

  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               *(_DWORD *)(a1 + 16) / 1024 - *(_DWORD *)(a2 + 4) / 1024,
               *(_DWORD *)(a1 + 20) / 1024 - *(_DWORD *)(a2 + 8) / 1024,
               (int)&unk_412D40 + 16 * (char)(*(_BYTE *)(a1 + 9) + 2 * *(_BYTE *)(a1 + 12)),
               *(_BYTE *)(a1 + 2) + 80);
  return result;
}

//----- (00407200) --------------------------------------------------------
int __cdecl sub_407200(int a1, int a2)
{
  int result; // eax@2

  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               *(_DWORD *)(a1 + 16) / 1024 - *(_DWORD *)(a2 + 4) / 1024 - 6,
               *(_DWORD *)(a1 + 20) / 1024 - *(_DWORD *)(a2 + 8) / 1024 - 2,
               (int)&unk_412DA0 + 16 * (char)(*(_BYTE *)(a1 + 9) + 2 * *(_BYTE *)(a1 + 12)),
               *(_BYTE *)(a1 + 2) + 80);
  return result;
}

//----- (00407290) --------------------------------------------------------
int __cdecl sub_407290(int a1, int a2)
{
  int result; // eax@2

  if ( *(_BYTE *)a1 )
    result = sub_4024C0(
               (int)&unk_412680,
               *(_DWORD *)(a1 + 16) / 1024 - *(_DWORD *)(a2 + 4) / 1024 - 8,
               *(_DWORD *)(a1 + 20) / 1024 - *(_DWORD *)(a2 + 8) / 1024 - 16,
               (int)&unk_412DE0,
               *(_BYTE *)(a1 + 2) + 80);
  return result;
}

//----- (00407310) --------------------------------------------------------
int __cdecl sub_407310(int a1, int a2)
{
  int v2; // esi@1
  signed int v3; // edi@1
  int result; // eax@3

  v2 = a1;
  v3 = 100;
  do
  {
    if ( *(_BYTE *)v2 )
      result = off_412B38[*(_BYTE *)(v2 + 2)](v2, a2);
    v2 += 40;
    --v3;
  }
  while ( v3 );
  return result;
}
// 412B38: using guessed type int (__cdecl *off_412B38[10])(int, int);

//----- (00407340) --------------------------------------------------------
int __cdecl NPC0(int a1)
{
  int result; // eax@1
  int v2; // ecx@3
  bool v3; // sf@3
  unsigned __int8 v4; // of@3
  char v5; // dl@8
  int v6; // ecx@12
  int v7; // edx@12
  bool v8; // sf@12
  unsigned __int8 v9; // of@12
  int v10; // edx@13
  int v11; // ecx@16
  int v12; // edx@16
  bool v13; // sf@16
  unsigned __int8 v14; // of@16
  int v15; // edx@17
  signed int v16; // ecx@20
  char v17; // dl@25
  int v18; // esi@35
  int v19; // edi@35
  int v20; // ecx@35
  int v21; // esi@35
  __int16 v22; // cx@35

  result = a1;
  if ( *(_BYTE *)(a1 + 8) )
  {
    if ( *(_BYTE *)(a1 + 8) == 1 )
    {
      v2 = *(_DWORD *)(a1 + 16);
      v4 = __OFSUB__(v2, dword_4170F4);
      v3 = v2 - dword_4170F4 < 0;
      if ( v2 > dword_4170F4 )
      {
        *(_BYTE *)(a1 + 12) = 0;
        v4 = __OFSUB__(v2, dword_4170F4);
        v3 = v2 - dword_4170F4 < 0;
      }
      if ( v3 ^ v4 )
        *(_BYTE *)(a1 + 12) = 1;
      if ( ++*(_WORD *)(a1 + 10) > 2 )
      {
        v5 = *(_BYTE *)(a1 + 9);
        *(_WORD *)(a1 + 10) = 0;
        *(_BYTE *)(a1 + 9) = ++v5;
        if ( v5 > 3 )
          *(_BYTE *)(a1 + 9) = 2;
      }
      if ( --*(_WORD *)(a1 + 6) <= 200 )
      {
        *(_BYTE *)(a1 + 8) = 0;
        *(_BYTE *)(a1 + 9) = 0;
      }
    }
  }
  else
  {
    v6 = *(_DWORD *)(a1 + 32);
    v7 = *(_DWORD *)(a1 + 16);
    v9 = __OFSUB__(v7, v6);
    v8 = v7 - v6 < 0;
    if ( v7 > v6 )
    {
      *(_DWORD *)(a1 + 24) -= 6;
      v10 = *(_DWORD *)(a1 + 16);
      v9 = __OFSUB__(v10, v6);
      v8 = v10 - v6 < 0;
    }
    if ( v8 ^ v9 )
      *(_DWORD *)(a1 + 24) += 6;
    v11 = *(_DWORD *)(a1 + 36);
    v12 = *(_DWORD *)(a1 + 20);
    v14 = __OFSUB__(v12, v11);
    v13 = v12 - v11 < 0;
    if ( v12 > v11 )
    {
      *(_DWORD *)(a1 + 28) -= 4;
      v15 = *(_DWORD *)(a1 + 20);
      v14 = __OFSUB__(v15, v11);
      v13 = v15 - v11 < 0;
    }
    if ( v13 ^ v14 )
      *(_DWORD *)(a1 + 28) += 4;
    v16 = *(_DWORD *)(a1 + 24);
    if ( v16 < 0 )
      *(_BYTE *)(a1 + 12) = 0;
    if ( v16 > 0 )
      *(_BYTE *)(a1 + 12) = 1;
    if ( ++*(_WORD *)(a1 + 10) > 60 )
    {
      v17 = *(_BYTE *)(a1 + 9);
      *(_WORD *)(a1 + 10) = 0;
      *(_BYTE *)(a1 + 9) = ++v17;
      if ( v17 > 1 )
        *(_BYTE *)(a1 + 9) = 0;
    }
    if ( v16 > 2048 )
      *(_DWORD *)(a1 + 24) = 2048;
    if ( *(_DWORD *)(a1 + 24) < -2048 )
      *(_DWORD *)(a1 + 24) = -2048;
    if ( *(_DWORD *)(a1 + 28) > 2048 )
      *(_DWORD *)(a1 + 28) = 2048;
    if ( *(_DWORD *)(a1 + 28) < -2048 )
      *(_DWORD *)(a1 + 28) = -2048;
    v18 = *(_DWORD *)(a1 + 20);
    v19 = *(_DWORD *)(a1 + 24) + *(_DWORD *)(a1 + 16);
    v20 = *(_DWORD *)(a1 + 28);
    *(_DWORD *)(a1 + 16) = v19;
    v21 = v20 + v18;
    v22 = *(_WORD *)(a1 + 6);
    *(_DWORD *)(a1 + 20) = v21;
    if ( v22 > 0 )
      *(_WORD *)(a1 + 6) = v22 - 1;
    if ( !*(_WORD *)(a1 + 6)
      && !(byte_4170F3 & 4)
      && v19 - 40960 < dword_4170F4
      && v19 + 40960 > dword_4170F4
      && v21 - 40960 < dword_4170F8
      && v21 + 40960 > dword_4170F8 )
    {
      if ( *(_BYTE *)(a1 + 1) == 2 )
        *(_BYTE *)(a1 + 8) = 1;
      *(_WORD *)(a1 + 6) = 300;
    }
  }
  return result;
}
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;

//----- (004074D0) --------------------------------------------------------
__int64 __cdecl NPC1_7(int a1)
{
  __int64 result; // rax@1
  signed int v2; // ecx@1
  __int16 v3; // si@1
  int v4; // ecx@3
  char v5; // cl@8

  LODWORD(result) = a1;
  v2 = *(_DWORD *)(a1 + 28);
  ++*(_WORD *)(result + 10);
  v3 = *(_WORD *)(a1 + 10);
  if ( v2 < 2048 )
    *(_DWORD *)(a1 + 28) = v2 + 20;
  v4 = *(_DWORD *)(a1 + 16);
  *(_DWORD *)(a1 + 20) += *(_DWORD *)(a1 + 28);
  if ( v4 < dword_4170F4 )
    *(_BYTE *)(a1 + 12) = 1;
  HIDWORD(result) = 0;
  if ( v4 > dword_4170F4 )
    *(_BYTE *)(a1 + 12) = 0;
  if ( v3 > 40 )
  {
    v5 = *(_BYTE *)(a1 + 9);
    *(_WORD *)(a1 + 10) = 0;
    *(_BYTE *)(a1 + 9) = ++v5;
    if ( v5 > 1 )
      *(_BYTE *)(a1 + 9) = 0;
  }
  return result;
}
// 4170F4: using guessed type int dword_4170F4;

//----- (00407540) --------------------------------------------------------
int __cdecl NPC2(int a1)
{
  int result; // eax@1
  char v2; // dl@4
  int v3; // ecx@6
  int v4; // esi@6
  char v5; // dl@10
  signed int v6; // ecx@11
  signed int v7; // ecx@14
  signed int v8; // ecx@16
  int v9; // ecx@18
  int v10; // esi@18
  int v11; // ecx@18
  int v12; // ecx@20
  int v13; // esi@20
  char v14; // dl@24
  signed int v15; // ecx@25
  signed int v16; // ecx@28
  char v17; // dl@30
  char v18; // cl@33
  char v19; // cl@38
  signed int v20; // ecx@40
  int v21; // ecx@42
  int v22; // esi@42

  result = a1;
  if ( *(_BYTE *)(a1 + 8) )
  {
    if ( *(_BYTE *)(a1 + 8) == 1 )
    {
      if ( ++*(_WORD *)(a1 + 10) > 2 )
      {
        v2 = *(_BYTE *)(a1 + 9);
        *(_WORD *)(a1 + 10) = 0;
        *(_BYTE *)(a1 + 9) = v2 + 1;
        if ( (char)(v2 + 1) > 3 )
          *(_BYTE *)(a1 + 9) = 2;
      }
      v3 = *(_DWORD *)(a1 + 32);
      v4 = *(_DWORD *)(a1 + 16);
      if ( v4 < v3 - 0x10000 )
        *(_BYTE *)(a1 + 12) = 1;
      if ( v4 > v3 + 0x10000 )
        *(_BYTE *)(a1 + 12) = 0;
      v5 = *(_BYTE *)(a1 + 12);
      if ( !v5 )
      {
        v6 = *(_DWORD *)(a1 + 24);
        if ( v6 > -512 )
          *(_DWORD *)(a1 + 24) = v6 - 16;
      }
      if ( v5 == 1 )
      {
        v7 = *(_DWORD *)(a1 + 24);
        if ( v7 < 512 )
          *(_DWORD *)(a1 + 24) = v7 + 16;
      }
      v8 = *(_DWORD *)(a1 + 28);
      if ( v8 < 2048 )
        *(_DWORD *)(a1 + 28) = v8 + 20;
      v9 = v4 + *(_DWORD *)(a1 + 24);
      v10 = *(_DWORD *)(a1 + 20);
      *(_DWORD *)(a1 + 16) = v9;
      v11 = *(_DWORD *)(a1 + 28);
      *(_DWORD *)(a1 + 20) = v11 + v10;
      if ( v11 > 0 )
        *(_BYTE *)(a1 + 8) = 0;
    }
  }
  else
  {
    v12 = *(_DWORD *)(a1 + 32);
    v13 = *(_DWORD *)(a1 + 16);
    if ( v13 < v12 - 0x10000 )
      *(_BYTE *)(a1 + 12) = 1;
    if ( v13 > v12 + 0x10000 )
      *(_BYTE *)(a1 + 12) = 0;
    v14 = *(_BYTE *)(a1 + 12);
    if ( !v14 )
    {
      v15 = *(_DWORD *)(a1 + 24);
      if ( v15 > -512 )
        *(_DWORD *)(a1 + 24) = v15 - 16;
    }
    if ( v14 == 1 )
    {
      v16 = *(_DWORD *)(a1 + 24);
      if ( v16 < 512 )
        *(_DWORD *)(a1 + 24) = v16 + 16;
    }
    v17 = *(_BYTE *)(a1 + 14);
    if ( !v17 )
      ++*(_WORD *)(a1 + 6);
    if ( *(_WORD *)(a1 + 6) > 80 )
    {
      v18 = *(_BYTE *)(a1 + 1);
      *(_WORD *)(a1 + 6) = 0;
      if ( v18 != 2 || byte_4170F3 & 4 )
      {
        *(_DWORD *)(a1 + 28) = -1024;
      }
      else
      {
        *(_DWORD *)(a1 + 28) = -1536;
        *(_BYTE *)(a1 + 8) = 1;
      }
    }
    if ( ++*(_WORD *)(a1 + 10) > 10 )
    {
      v19 = *(_BYTE *)(a1 + 9);
      *(_WORD *)(a1 + 10) = 0;
      *(_BYTE *)(a1 + 9) = ++v19;
      if ( v19 > 1 )
        *(_BYTE *)(a1 + 9) = 0;
    }
    v20 = *(_DWORD *)(a1 + 28);
    if ( v20 < 2048 )
      *(_DWORD *)(a1 + 28) = v20 + 20;
    v21 = v13 + *(_DWORD *)(a1 + 24);
    v22 = *(_DWORD *)(a1 + 20);
    *(_DWORD *)(a1 + 16) = v21;
    *(_DWORD *)(a1 + 20) = *(_DWORD *)(a1 + 28) + v22;
    if ( v17 == 1 )
      *(_BYTE *)(a1 + 9) = 2;
  }
  return result;
}
// 4170F3: using guessed type char byte_4170F3;

//----- (004076E0) --------------------------------------------------------
int __cdecl NPC3(int a1)
{
  int result; // eax@1
  signed int v2; // ecx@1
  int v3; // edx@3
  char v4; // cl@3
  __int16 v5; // cx@4
  int v6; // ecx@6
  char v7; // cl@11
  char v8; // cl@14

  result = a1;
  v2 = *(_DWORD *)(a1 + 28);
  if ( v2 < 2048 )
    *(_DWORD *)(a1 + 28) = v2 + 20;
  v3 = *(_DWORD *)(a1 + 28) + *(_DWORD *)(a1 + 20);
  v4 = *(_BYTE *)(a1 + 8);
  *(_DWORD *)(a1 + 20) = v3;
  if ( !v4 )
  {
    v5 = *(_WORD *)(a1 + 6);
    if ( v5 > 0 )
      *(_WORD *)(a1 + 6) = v5 - 1;
    v6 = *(_DWORD *)(a1 + 16);
    if ( v6 - 0x8000 >= dword_4170F4 || v6 + 0x8000 <= dword_4170F4 || v3 - 0x8000 >= dword_4170F8 || v3 <= dword_4170F8 )
    {
      if ( ++*(_WORD *)(a1 + 10) > 5 )
      {
        v8 = *(_BYTE *)(a1 + 9);
        *(_WORD *)(a1 + 10) = 0;
        *(_BYTE *)(a1 + 9) = --v8;
        if ( v8 < 0 )
          *(_BYTE *)(a1 + 9) = 0;
      }
    }
    else if ( ++*(_WORD *)(a1 + 10) > 2 )
    {
      v7 = *(_BYTE *)(a1 + 9);
      *(_WORD *)(a1 + 10) = 0;
      *(_BYTE *)(a1 + 9) = ++v7;
      if ( v7 > 3 )
        *(_BYTE *)(a1 + 9) = 3;
    }
  }
  return result;
}
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;

//----- (004077A0) --------------------------------------------------------
int __cdecl NPC4_5(int a1)
{
  int result; // eax@1
  int v2; // esi@1
  bool v3; // sf@1
  unsigned __int8 v4; // of@1
  int v5; // edi@5
  bool v6; // sf@5
  unsigned __int8 v7; // of@5
  char v8; // bl@22
  int v9; // ecx@32

  result = a1;
  v2 = *(_DWORD *)(a1 + 16);
  v4 = __OFSUB__(v2, dword_4170F4);
  v3 = v2 - dword_4170F4 < 0;
  if ( v2 > dword_4170F4 )
  {
    *(_DWORD *)(a1 + 24) -= 24;
    v4 = __OFSUB__(v2, dword_4170F4);
    v3 = v2 - dword_4170F4 < 0;
  }
  if ( v3 ^ v4 )
    *(_DWORD *)(a1 + 24) += 24;
  v5 = *(_DWORD *)(a1 + 20);
  v7 = __OFSUB__(v5, dword_4170F8);
  v6 = v5 - dword_4170F8 < 0;
  if ( v5 > dword_4170F8 )
  {
    *(_DWORD *)(a1 + 28) -= 16;
    v7 = __OFSUB__(v5, dword_4170F8);
    v6 = v5 - dword_4170F8 < 0;
  }
  if ( v6 ^ v7 )
    *(_DWORD *)(a1 + 28) += 16;
  if ( v2 > dword_4170F4 )
    *(_BYTE *)(a1 + 12) = 0;
  if ( v2 < dword_4170F4 )
    *(_BYTE *)(a1 + 12) = 1;
  if ( v2 - 0x8000 < dword_4170F4
    && v2 + 0x8000 > dword_4170F4
    && v5 - 0x8000 < dword_4170F8
    && v5 + 0x8000 > dword_4170F8 )
  {
    *(_BYTE *)(a1 + 12) = 2;
  }
  *(_BYTE *)(a1 + 8) = v5 + 0x2000 > dword_4170F8;
  if ( ++*(_WORD *)(a1 + 10) > 8 )
  {
    v8 = *(_BYTE *)(a1 + 9);
    *(_WORD *)(a1 + 10) = 0;
    *(_BYTE *)(a1 + 9) = ++v8;
    if ( v8 > 1 )
      *(_BYTE *)(a1 + 9) = 0;
  }
  if ( *(_DWORD *)(a1 + 24) > 1024 )
    *(_DWORD *)(a1 + 24) = 1024;
  if ( *(_DWORD *)(a1 + 24) < -1024 )
    *(_DWORD *)(a1 + 24) = -1024;
  if ( *(_DWORD *)(a1 + 28) > 1024 )
    *(_DWORD *)(a1 + 28) = 1024;
  if ( *(_DWORD *)(a1 + 28) < -1024 )
    *(_DWORD *)(a1 + 28) = -1024;
  v9 = *(_DWORD *)(a1 + 28);
  *(_DWORD *)(a1 + 16) = *(_DWORD *)(a1 + 24) + v2;
  *(_DWORD *)(a1 + 20) = v5 + v9;
  return result;
}
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;

//----- (004078C0) --------------------------------------------------------
int __cdecl NPC6_9(int a1)
{
  int result; // eax@1
  signed int v2; // ecx@1

  result = a1;
  v2 = *(_DWORD *)(a1 + 28);
  if ( v2 < 2048 )
    *(_DWORD *)(a1 + 28) = v2 + 20;
  *(_DWORD *)(a1 + 20) += *(_DWORD *)(a1 + 28);
  return result;
}

//----- (004078F0) --------------------------------------------------------
int __cdecl NPC8(int a1)
{
  int result; // eax@1
  int v2; // ecx@2
  int v3; // edi@2
  bool v4; // sf@2
  unsigned __int8 v5; // of@2
  int v6; // esi@6
  int v7; // ecx@6
  bool v8; // sf@6
  unsigned __int8 v9; // of@6
  signed int v10; // ecx@10
  char v11; // bl@15

  result = a1;
  if ( !*(_BYTE *)(a1 + 8) )
  {
    v2 = *(_DWORD *)(a1 + 32);
    v3 = *(_DWORD *)(a1 + 16);
    v5 = __OFSUB__(v3, v2);
    v4 = v3 - v2 < 0;
    if ( v3 > v2 )
    {
      v5 = __OFSUB__(v3, v2);
      v4 = v3 - v2 < 0;
      *(_DWORD *)(a1 + 24) -= 12;
    }
    if ( v4 ^ v5 )
      *(_DWORD *)(a1 + 24) += 12;
    v6 = *(_DWORD *)(a1 + 20);
    v7 = *(_DWORD *)(a1 + 36);
    v9 = __OFSUB__(v6, v7);
    v8 = v6 - v7 < 0;
    if ( v6 > v7 )
    {
      v9 = __OFSUB__(v6, v7);
      v8 = v6 - v7 < 0;
      *(_DWORD *)(a1 + 28) -= 8;
    }
    if ( v8 ^ v9 )
      *(_DWORD *)(a1 + 28) += 8;
    v10 = *(_DWORD *)(a1 + 24);
    if ( v10 < 0 )
      *(_BYTE *)(a1 + 12) = 0;
    if ( v10 > 0 )
      *(_BYTE *)(a1 + 12) = 1;
    if ( ++*(_WORD *)(a1 + 10) > 30 )
    {
      v11 = *(_BYTE *)(a1 + 9);
      *(_WORD *)(a1 + 10) = 0;
      *(_BYTE *)(a1 + 9) = ++v11;
      if ( v11 > 1 )
        *(_BYTE *)(a1 + 9) = 0;
    }
    if ( v10 > 2048 )
      *(_DWORD *)(a1 + 24) = 2048;
    if ( *(_DWORD *)(a1 + 24) < -2048 )
      *(_DWORD *)(a1 + 24) = -2048;
    if ( *(_DWORD *)(a1 + 28) > 2048 )
      *(_DWORD *)(a1 + 28) = 2048;
    if ( *(_DWORD *)(a1 + 28) < -2048 )
      *(_DWORD *)(a1 + 28) = -2048;
    *(_DWORD *)(a1 + 16) = v3 + *(_DWORD *)(a1 + 24);
    *(_DWORD *)(a1 + 20) = *(_DWORD *)(a1 + 28) + v6;
  }
  return result;
}

//----- (004079B0) --------------------------------------------------------
int __cdecl sub_4079B0(int a1)
{
  int v1; // esi@1
  signed int v2; // edi@1
  int result; // eax@3
  int v4; // [sp+0h] [bp-8h]@0

  v1 = a1;
  v2 = 100;
  do
  {
    if ( *(_BYTE *)v1 )
      result = ((int (__cdecl *)(int, int))NPC_function_Table[*(_BYTE *)(v1 + 2)])(v1, v4);
    v1 += 40;
    --v2;
  }
  while ( v2 );
  return result;
}
// 412B10: using guessed type int (__cdecl *NPC_function_Table[10])(int);

//----- (004079E0) --------------------------------------------------------
char __cdecl sub_4079E0(int a1, int a2, int a3, char a4)
{
  char v4; // al@8
  char v5; // al@16
  char v6; // al@31
  int v7; // eax@34

  if ( a4 & 1 && a4 & 2 )
  {
    if ( *(_DWORD *)(a1 + 16) / 1024 < 16 * a2 + 15 && *(_DWORD *)(a1 + 20) / 1024 < 16 * a3 + 12 )
    {
      *(_DWORD *)(a1 + 24) = 0;
      *(_DWORD *)(a1 + 16) = (a2 << 14) + 15360;
      *(_BYTE *)(a1 + 13) |= 1u;
    }
    if ( *(_DWORD *)(a1 + 20) / 1024 < 16 * a3 + 15 && *(_DWORD *)(a1 + 16) / 1024 < 16 * a2 + 12 )
    {
      v4 = *(_BYTE *)(a1 + 13) | 2;
      *(_DWORD *)(a1 + 20) = (a3 + 1) << 14;
      *(_DWORD *)(a1 + 28) = 0;
      *(_BYTE *)(a1 + 13) = v4;
    }
  }
  if ( a4 & 4 && a4 & 2 )
  {
    if ( (*(_DWORD *)(a1 + 16) + 1023) / 1024 > 16 * a2 - 14 && *(_DWORD *)(a1 + 20) / 1024 < 16 * a3 + 12 )
    {
      *(_DWORD *)(a1 + 24) = 0;
      *(_DWORD *)(a1 + 16) = (a2 << 14) - 14336;
      *(_BYTE *)(a1 + 13) |= 4u;
    }
    if ( *(_DWORD *)(a1 + 20) / 1024 < 16 * a3 + 15 && *(_DWORD *)(a1 + 16) / 1024 > 16 * a2 - 12 )
    {
      v5 = *(_BYTE *)(a1 + 13) | 2;
      *(_DWORD *)(a1 + 20) = (a3 + 1) << 14;
      *(_DWORD *)(a1 + 28) = 0;
      *(_BYTE *)(a1 + 13) = v5;
    }
  }
  if ( a4 & 1 && a4 & 8 )
  {
    if ( *(_DWORD *)(a1 + 16) / 1024 < 16 * a2 + 15 && *(_DWORD *)(a1 + 20) / 1024 > 16 * a3 - 12 )
    {
      *(_DWORD *)(a1 + 24) = 0;
      *(_DWORD *)(a1 + 16) = (a2 << 14) + 15360;
      *(_BYTE *)(a1 + 13) |= 1u;
    }
    if ( *(_DWORD *)(a1 + 20) / 1024 >= 16 * a3 - 16 && *(_DWORD *)(a1 + 16) / 1024 < 16 * a2 + 12 )
    {
      *(_BYTE *)(a1 + 14) = 0;
      *(_DWORD *)(a1 + 20) = (a3 << 14) - 0x4000;
      if ( *(_DWORD *)(a1 + 28) > 0 )
        *(_DWORD *)(a1 + 28) = 0;
      *(_BYTE *)(a1 + 13) |= 8u;
    }
  }
  if ( a4 & 4 && a4 & 8 )
  {
    if ( (*(_DWORD *)(a1 + 16) + 1023) / 1024 > 16 * a2 - 14 && *(_DWORD *)(a1 + 20) / 1024 > 16 * a3 - 12 )
    {
      v6 = *(_BYTE *)(a1 + 13);
      *(_DWORD *)(a1 + 24) = 0;
      *(_DWORD *)(a1 + 16) = (a2 << 14) - 14336;
      *(_BYTE *)(a1 + 13) = v6 | 4;
    }
    if ( *(_DWORD *)(a1 + 20) / 1024 >= 16 * a3 - 16 && *(_DWORD *)(a1 + 16) / 1024 > 16 * a2 - 12 )
    {
      v7 = *(_DWORD *)(a1 + 28);
      *(_BYTE *)(a1 + 14) = 0;
      *(_DWORD *)(a1 + 20) = (a3 << 14) - 0x4000;
      if ( v7 > 0 )
        *(_DWORD *)(a1 + 28) = 0;
      *(_BYTE *)(a1 + 13) |= 8u;
    }
  }
  return *(_BYTE *)(a1 + 13);
}

//----- (00407CE0) --------------------------------------------------------
int __cdecl sub_407CE0(int a1, int a2)
{
  int v2; // ebx@1
  int v3; // ebp@1
  signed int v4; // eax@3
  int v5; // kr00_4@3
  int v6; // eax@3
  int v7; // edi@3
  int v8; // esi@3
  int v9; // ecx@5
  int v10; // edx@5
  unsigned __int8 v11; // al@5
  char v12; // al@10
  int result; // eax@16
  char v14; // [sp+10h] [bp-18h]@1
  char v15; // [sp+11h] [bp-17h]@1
  char v16; // [sp+12h] [bp-16h]@1
  char v17; // [sp+13h] [bp-15h]@1
  char v18; // [sp+14h] [bp-14h]@1
  char v19; // [sp+15h] [bp-13h]@1
  char v20; // [sp+16h] [bp-12h]@1
  char v21; // [sp+17h] [bp-11h]@1
  char v22; // [sp+18h] [bp-10h]@1
  char v23; // [sp+19h] [bp-Fh]@1
  char v24; // [sp+1Ah] [bp-Eh]@1
  char v25; // [sp+1Bh] [bp-Dh]@1
  char v26; // [sp+1Ch] [bp-Ch]@1
  char v27; // [sp+1Dh] [bp-Bh]@1
  char v28; // [sp+1Eh] [bp-Ah]@1
  char v29; // [sp+1Fh] [bp-9h]@1
  int v30; // [sp+20h] [bp-8h]@1
  int v31; // [sp+24h] [bp-4h]@5
  int v32; // [sp+2Ch] [bp+4h]@3
  char v33; // [sp+30h] [bp+8h]@3

  v2 = a2;
  v3 = a1;
  v22 = 0;
  v23 = 1;
  v24 = 0;
  v25 = 1;
  v18 = 0;
  v19 = 0;
  v20 = 1;
  v21 = 1;
  v14 = 0;
  v15 = 0;
  v16 = 1;
  v17 = 1;
  v26 = 3;
  v27 = 6;
  v28 = 9;
  v29 = 12;
  v30 = 100;
  do
  {
    if ( !*(_BYTE *)v3 )
      goto LABEL_16;
    v4 = *(_DWORD *)(v3 + 16);
    v33 = 2;
    *(_BYTE *)(v3 + 13) = 0;
    v5 = v4 / 1024;
    v6 = *(_DWORD *)(v3 + 20) / 1024 / 16;
    v7 = v5 / 16;
    v32 = *(_DWORD *)(v3 + 20) / 1024 / 16;
    v8 = 0;
    while ( 1 )
    {
      if ( ((v9 = v6 + *(&v18 + v8),
             v10 = *(&v22 + v8),
             v11 = *(_BYTE *)(v10 + *(_DWORD *)v2 + v9 * *(_DWORD *)(v2 + 8) + v7),
             LOBYTE(v31) = v11,
             v11 <= 0x7Fu)
         || v11 >= 0xA0u)
        && (v11 <= 0xDFu || (signed int)(unsigned __int8)v31 >= 256) )
      {
        v12 = v33 - *(&v14 + v8);
      }
      else
      {
        if ( sub_4079E0(v3, v7 + v10, v9, *(&v26 + v8)) & 8 )
          goto LABEL_13;
        v12 = v33 - *(&v14 + v8);
      }
      v33 = v12;
LABEL_13:
      if ( ++v8 >= 4 )
        break;
      v6 = v32;
    }
    if ( v33 < 1 )
      *(_BYTE *)(v3 + 14) = 1;
LABEL_16:
    v3 += 40;
    result = v30-- - 1;
  }
  while ( v30 );
  return result;
}

//----- (00407E30) --------------------------------------------------------
int __cdecl sub_407E30(int a1, int a2, _BYTE *a3)
{
  int result; // eax@1
  int v4; // ebp@1
  int v5; // esi@1
  char v6; // bl@2
  char v7; // cl@3
  int v8; // ecx@8
  int v9; // ecx@10
  int v10; // edx@13
  int v11; // ecx@13
  int v12; // edx@15
  int v13; // ecx@19
  int v14; // ecx@21
  int v15; // edx@26
  int v16; // ecx@26
  int v17; // edx@28
  int v18; // ecx@32
  int v19; // ecx@34
  bool v20; // zf@45
  bool v21; // sf@45
  unsigned __int8 v22; // of@45
  int v23; // eax@46
  _BYTE *v24; // ebx@49
  signed int v25; // eax@57
  int v26; // eax@58
  char v27; // dl@58
  int v28; // edx@58
  signed int v29; // eax@59
  int v30; // eax@60
  int v31; // edx@60
  signed int v32; // [sp+10h] [bp-4h]@1

  result = dword_4170F8;
  v4 = dword_4170F4;
  v5 = a1;
  v32 = 100;
  do
  {
    v6 = 0;
    if ( !*(_BYTE *)v5 )
      goto LABEL_64;
    v7 = *(_BYTE *)(v5 + 1);
    if ( v7 != 3 && (v7 != 2 || word_417108) )
    {
      if ( !v7 && !word_41710A )
      {
        v8 = *(_DWORD *)(v5 + 16);
        if ( v4 < v8 + 4096 && v4 > v8 - 4096 )
        {
          v9 = *(_DWORD *)(v5 + 20);
          if ( result < v9 + 4096 && result > v9 - 4096 )
            goto LABEL_43;
        }
      }
    }
    else
    {
      v10 = *(_DWORD *)(v5 + 16);
      v11 = v10 + 13312;
      if ( v4 < v10 + 13312 && v4 > v10 + 0x2000 )
      {
        v12 = *(_DWORD *)(v5 + 20);
        if ( result >= v12 + 12288 || result <= v12 - 12288 )
        {
          v4 = dword_4170F4;
        }
        else
        {
          v4 = v11;
          dword_4170F4 = v11;
          dword_4170FC = 0;
          byte_417118 |= 1u;
          v6 = 1;
        }
      }
      v13 = *(_DWORD *)(v5 + 20);
      if ( result < v13 + 13312 && result > v13 + 0x2000 )
      {
        v14 = *(_DWORD *)(v5 + 16);
        if ( v4 < v14 + 12288 && v4 > v14 - 12288 )
        {
          if ( dword_417100 < -100 )
          {
            sub_40A9C0(4, 1);
            v4 = dword_4170F4;
          }
          result = *(_DWORD *)(v5 + 20) + 13312;
          dword_4170F8 = *(_DWORD *)(v5 + 20) + 13312;
          dword_417100 = 0;
          byte_417118 |= 2u;
          v6 = 1;
        }
      }
      v15 = *(_DWORD *)(v5 + 16);
      v16 = v15 - 13312;
      if ( v4 > v15 - 13312 )
      {
        if ( v4 + 1023 >= v15 - 0x2000 || (v17 = *(_DWORD *)(v5 + 20), result >= v17 + 12288) || result <= v17 - 12288 )
        {
          v4 = dword_4170F4;
        }
        else
        {
          v4 = v16;
          dword_4170F4 = v16;
          dword_4170FC = 0;
          byte_417118 |= 4u;
          v6 = 1;
        }
      }
      v18 = *(_DWORD *)(v5 + 20);
      if ( result < v18 - 13312
        || result >= v18 - 0x2000
        || (v19 = *(_DWORD *)(v5 + 16), v4 <= v19 - 12288)
        || v4 >= v19 + 12288 )
      {
        if ( !v6 )
          goto LABEL_64;
      }
      else
      {
        byte_417117 = 0;
        result = *(_DWORD *)(v5 + 20) - 13312;
        dword_4170F8 = *(_DWORD *)(v5 + 20) - 13312;
        if ( dword_417100 > 0 )
          dword_417100 = 0;
        byte_417118 |= 8u;
      }
      if ( !word_41710A )
      {
        if ( *(_BYTE *)(v5 + 1) != 2 )
        {
          if ( *(_BYTE *)(v5 + 1) != 3 )
            goto LABEL_64;
          goto LABEL_43;
        }
        if ( *(_BYTE *)(v5 + 8) == 1 )
        {
          v22 = __OFSUB__(v4, *(_DWORD *)(v5 + 16));
          v20 = v4 == *(_DWORD *)(v5 + 16);
          v21 = v4 - *(_DWORD *)(v5 + 16) < 0;
          if ( v4 < *(_DWORD *)(v5 + 16) )
          {
            dword_4170FC = -1024;
            v23 = *(_DWORD *)(v5 + 16);
            v22 = __OFSUB__(v4, v23);
            v20 = v4 == v23;
            v21 = v4 - v23 < 0;
          }
          if ( !((unsigned __int8)(v21 ^ v22) | v20) )
            dword_4170FC = 1024;
          v24 = a3;
          sub_409030(a3, byte_412AF0[*(_BYTE *)(v5 + 2)]);
          result = dword_4170F8;
          v4 = dword_4170F4;
        }
        else
        {
          v24 = a3;
        }
        if ( byte_417118 && byte_4170F2 == 1 && byte_417118 != 8 || byte_417118 & 2 && byte_4170F3 & 1 )
        {
          if ( byte_412AF8[*(_BYTE *)(v5 + 2)] > byte_417110 )
          {
            if ( !word_41710A )
            {
              sub_40A9C0(0, 1);
              result = dword_4170F8;
              v4 = dword_4170F4;
            }
            word_41710A = 100;
            goto LABEL_64;
          }
          sub_40A9C0(10, 1);
          word_41710E += byte_412B04[*(_BYTE *)(v5 + 2)];
          v25 = sub_403820(v24);
          if ( v25 != 0xFFFFFF )
          {
            v26 = (int)&v24[36 * v25];
            *(_BYTE *)v26 = 1;
            *(_BYTE *)(v26 + 1) = 2;
            v27 = byte_412B04[*(_BYTE *)(v5 + 2)];
            *(_BYTE *)(v26 + 3) = 1;
            *(_BYTE *)(v26 + 2) = v27 + 10;
            *(_DWORD *)(v26 + 4) = *(_DWORD *)(v5 + 16) + 0x2000;
            v28 = *(_DWORD *)(v5 + 20) - 4096;
            *(_DWORD *)(v26 + 28) = 1;
            *(_DWORD *)(v26 + 8) = v28;
            *(_DWORD *)(v26 + 32) = 0;
          }
          *(_BYTE *)v5 = 0;
          v29 = sub_403820(v24);
          if ( v29 != 0xFFFFFF )
          {
            v30 = (int)&v24[36 * v29];
            *(_BYTE *)v30 = 1;
            *(_BYTE *)(v30 + 1) = 0;
            *(_BYTE *)(v30 + 2) = 0;
            *(_BYTE *)(v30 + 3) = 6;
            *(_DWORD *)(v30 + 4) = *(_DWORD *)(v5 + 16) + 0x2000;
            v31 = *(_DWORD *)(v5 + 20) + 0x2000;
            *(_DWORD *)(v30 + 16) = -2048;
            *(_DWORD *)(v30 + 24) = -2048;
            *(_DWORD *)(v30 + 8) = v31;
            *(_DWORD *)(v30 + 12) = 2048;
            *(_DWORD *)(v30 + 20) = -512;
            *(_DWORD *)(v30 + 28) = 8;
            *(_DWORD *)(v30 + 32) = 8;
          }
LABEL_43:
          *(_BYTE *)a2 = 1;
          *(_WORD *)(a2 + 28) = 4;
          *(_DWORD *)(a2 + 16) = *(_WORD *)(v5 + 4);
          result = dword_4170F8;
          v4 = dword_4170F4;
          word_41710A = 100;
          goto LABEL_64;
        }
      }
    }
LABEL_64:
    v5 += 40;
    --v32;
  }
  while ( v32 );
  return result;
}
// 4170F2: using guessed type char byte_4170F2;
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417108: using guessed type __int16 word_417108;
// 41710A: using guessed type __int16 word_41710A;
// 41710E: using guessed type __int16 word_41710E;
// 417110: using guessed type char byte_417110;
// 417117: using guessed type char byte_417117;
// 417118: using guessed type char byte_417118;

//----- (00408260) --------------------------------------------------------
signed int __cdecl sub_408260(char *a1)
{
  FILE *v1; // ebp@1
  signed int result; // eax@2
  char *v3; // edi@3
  bool v4; // zf@6
  signed int v5; // [sp+8h] [bp-134h]@3
  char *v6; // [sp+Ch] [bp-130h]@3
  char v7; // [sp+10h] [bp-12Ch]@4
  char v8; // [sp+11h] [bp-12Bh]@4
  char v9; // [sp+12h] [bp-12Ah]@4
  char v10; // [sp+14h] [bp-128h]@4
  __int16 v11; // [sp+16h] [bp-126h]@4
  char v12; // [sp+18h] [bp-124h]@4
  char v13; // [sp+19h] [bp-123h]@4
  __int16 v14; // [sp+1Ah] [bp-122h]@4
  char v15; // [sp+1Ch] [bp-120h]@4
  char v16; // [sp+20h] [bp-11Ch]@4
  char v17; // [sp+24h] [bp-118h]@4
  int v18; // [sp+28h] [bp-114h]@4
  int v19; // [sp+2Ch] [bp-110h]@4
  char v20; // [sp+30h] [bp-10Ch]@4
  char v21; // [sp+34h] [bp-108h]@4
  char v22; // [sp+38h] [bp-104h]@1

  sprintf(&v22, aSS, &Filename, aNpchar_dat);
  v1 = fopen(&v22, aRb);
  if ( v1 )
  {
    v3 = a1;
    v5 = 100;
    v6 = a1;
    do
    {
      fread(&v7, 1u, 1u, v1);
      fread(&v8, 1u, 1u, v1);
      fread(&v9, 1u, 1u, v1);
      fread(&v10, 2u, 1u, v1);
      fread(&v15, 1u, 1u, v1);
      fread(&v16, 4u, 1u, v1);
      fread(&v17, 4u, 1u, v1);
      fread(&v20, 4u, 1u, v1);
      fread(&v21, 4u, 1u, v1);
      v11 = 0;
      v12 = 0;
      v13 = 0;
      v14 = 0;
      v18 = 0;
      v19 = 0;
      if ( v8 == 2 )
        qmemcpy(v3, &v7, 0x28u);
      v3 = v6 + 40;
      v4 = v5 == 1;
      v6 += 40;
      --v5;
    }
    while ( !v4 );
    fclose(v1);
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}

//----- (004083B0) --------------------------------------------------------
HANDLE __cdecl sub_4083B0(int a1)
{
  *(_DWORD *)a1 = -83;
  *(_DWORD *)(a1 + 12) = -128;
  *(_DWORD *)(a1 + 8) = -64;
  *(_DWORD *)(a1 + 4) = 320;
  sub_4021D0((int)aPbmOpening_pbm, 17);
  return sub_4021D0((int)aPbmMaruame_pbm, 20);
}

//----- (004083F0) --------------------------------------------------------
int __cdecl sub_4083F0(int *a1)
{
  signed int v1; // edi@1
  int v2; // eax@3
  int v3; // edi@3
  bool v4; // sf@3
  unsigned __int8 v5; // of@3
  signed int v6; // eax@9
  int result; // eax@10

  sub_402600((int)&unk_412680, 0xFFFFFF);
  sub_4024C0((int)&unk_412680, 65, *a1, (int)&unk_412E10, 17);
  sub_4024C0((int)&unk_412680, 132, 137, (int)&unk_412E20, 17);
  sub_4024C0((int)&unk_412680, a1[1], 205, (int)&unk_412E30, 17);
  v1 = 0;
  do
  {
    sub_4024C0((int)&unk_412680, a1[3] / 2, v1 + a1[2], (int)&unk_412DF0, 17);
    sub_4024C0((int)&unk_412680, 272 - a1[3] / 2, v1 + a1[2], (int)&unk_412E00, 17);
    v1 += 64;
  }
  while ( v1 < 320 );
  v2 = *a1;
  v3 = a1[2] + 1;
  v5 = __OFSUB__(*a1, 45);
  v4 = *a1 - 45 < 0;
  a1[2] = v3;
  if ( v4 ^ v5 )
    *a1 = v2 + 1;
  if ( v3 >= 0 )
    a1[2] = v3 - 64;
  if ( a1[3] / 2 < 0 )
    ++a1[3];
  v6 = a1[1];
  if ( v6 <= 64 )
  {
    result = a1[2] / 32 % 2;
    if ( result )
      result = sub_4024C0((int)&unk_412680, 128, 126, (int)&unk_412E40, 17);
  }
  else
  {
    result = v6 - 2;
    a1[1] = result;
  }
  return result;
}

//----- (00408520) --------------------------------------------------------
FILE *__cdecl sub_408520(int a1, LPCSTR lpFileName)
{
  HANDLE v2; // edi@1
  FILE *result; // eax@1
  FILE *v4; // edi@1

  v2 = CreateFileA(lpFileName, 0x80000000, 0, NULL, 3u, 0x80u, NULL);
  *(_DWORD *)(a1 + 8) = GetFileSize(v2, NULL);
  CloseHandle(v2);
  *(_DWORD *)a1 = LocalAlloc(0x40u, *(_DWORD *)(a1 + 8));
  result = fopen(lpFileName, aRb);
  v4 = result;
  if ( result )
  {
    fread(*(void **)a1, 1u, *(_DWORD *)(a1 + 8), result);
    fclose(v4);
    result = (FILE *)1;
  }
  return result;
}

//----- (004085A0) --------------------------------------------------------
int __cdecl sub_4085A0(int a1, LPCSTR lpFileName, char a3)
{
  signed int v3; // esi@1
  _DWORD *v4; // ebp@1

  v3 = 0;
  *(_BYTE *)(a1 + 61) = 0;
  *(_DWORD *)(a1 + 4) = 0;
  *(_BYTE *)(a1 + 60) = a3;
  *(_DWORD *)(a1 + 56) = 0;
  v4 = (_DWORD *)(a1 + 12);
  do
  {
    *v4 = 24 * v3 * *(_BYTE *)(a1 + 60);
    sub_402380(320, 16, v3 + 40);
    sub_402680((int)&unk_412E70, 0, v3++ + 40);
    ++v4;
  }
  while ( v3 < 11 );
  sub_408520(a1, lpFileName);
  return sub_403D40(*(LPCSTR *)a1);
}

//----- (00408620) --------------------------------------------------------
signed int __cdecl sub_408620(int a1, _BYTE *a2)
{
  int v3; // ebx@4
  int *v4; // ebp@4
  int v5; // eax@5
  signed int v6; // eax@8
  int v7; // edx@9
  int v8; // edi@9
  CHAR v9; // cl@9
  int v10; // edx@12
  int v11; // edx@20
  int v12; // eax@20
  CHAR String; // [sp+10h] [bp-2Ch]@10
  char v14[43]; // [sp+11h] [bp-2Bh]@12

  sub_4024C0((int)&unk_412680, 0, 0, (int)&unk_412E50, 20);
  if ( !*(_BYTE *)(a1 + 61) )
  {
    v3 = 40;
    v4 = (int *)(a1 + 12);
    while ( 1 )
    {
      sub_4024C0((int)&unk_412680, 0, *v4 / *(_BYTE *)(a1 + 60), (int)&unk_412E70, v3);
      v5 = *v4 - 2;
      *v4 = v5;
      if ( dword_417A44 & 0x10 )
        *v4 = v5 - 6;
      if ( *v4 / *(_BYTE *)(a1 + 60) < -24 )
        break;
LABEL_31:
      ++v4;
      if ( ++v3 >= 51 )
      {
        if ( *(_BYTE *)(a1 + 61) )
          sub_4024C0((int)&unk_412680, 136, 106, (int)&unk_412E60, 23);
        return 0;
      }
    }
    *v4 = 240 * *(_BYTE *)(a1 + 60);
    sub_402680((int)&unk_412E70, 0, v3);
    v6 = 0;
    while ( 1 )
    {
      v7 = *(_DWORD *)(a1 + 4);
      v8 = v7 + *(_DWORD *)a1;
      v9 = *(_BYTE *)(v7 + *(_DWORD *)a1);
      if ( v9 == 32 )
      {
        *(&String + v6) = 32;
        goto LABEL_28;
      }
      if ( v9 & 0x80 )
        break;
      if ( v9 >= 65 && v9 <= 122 || v9 == 46 || v9 == 44 )
      {
        *(&String + v6) = v9;
LABEL_28:
        v10 = v7 + 1;
LABEL_29:
        *(_DWORD *)(a1 + 4) = v10;
        goto LABEL_30;
      }
      if ( v9 == 60 && *(_BYTE *)(v8 + 1) == 101 )
        return 1;
      if ( v9 == 43 )
      {
        v11 = *(_DWORD *)(a1 + 56);
        *(&String + v6) = 0;
        sub_402770(8, 1, &String, 0xFF0000u, (HDC)(v11 + 40));
        sub_402770(8, 0, &String, 0xFF8800u, (HDC)(*(_DWORD *)(a1 + 56) + 40));
        v12 = *(_DWORD *)(a1 + 56) + 1;
        *(_DWORD *)(a1 + 56) = v12;
        if ( v12 > 10 )
          *(_DWORD *)(a1 + 56) = 0;
        *(_DWORD *)(a1 + 4) += 3;
        v6 = 999;
        goto LABEL_30;
      }
      if ( v9 != 60 || *(_BYTE *)(v8 + 1) != 112 || *(_BYTE *)(v8 + 2) != 102 )
        goto LABEL_28;
      *(_DWORD *)(a1 + 4) = v7 + 5;
      *a2 = 4;
      v6 = 999;
LABEL_30:
      if ( ++v6 >= 40 )
        goto LABEL_31;
    }
    *(&String + v6) = v9;
    v14[v6++] = *(_BYTE *)(v8 + 1);
    v10 = v7 + 2;
    goto LABEL_29;
  }
  sub_4024C0((int)&unk_412680, 136, 106, (int)&unk_412E60, 23);
  return 1;
}
// 417A44: using guessed type int dword_417A44;
// 408620: using guessed type char var_2B[43];

//----- (00408820) --------------------------------------------------------
int __cdecl sub_408820(HLOCAL *a1)
{
  signed int v1; // esi@1
  int result; // eax@2

  LocalFree(*a1);
  v1 = 0;
  do
    result = sub_4021A0(v1++ + 40);
  while ( v1 < 11 );
  return result;
}

//----- (00408850) --------------------------------------------------------
#error "40885A: call analysis failed (funcsize=136)"

//----- (00408A90) --------------------------------------------------------
HLOCAL sub_408A90()
{
  HLOCAL result; // eax@7

  if ( hMem )
  {
    LocalFree(hMem);
    hMem = NULL;
  }
  if ( dword_4170E0 )
  {
    LocalFree(dword_4170E0);
    dword_4170E0 = NULL;
  }
  if ( dword_4170E4 )
  {
    LocalFree(dword_4170E4);
    dword_4170E4 = NULL;
  }
  result = dword_4170E8;
  if ( dword_4170E8 )
  {
    result = LocalFree(dword_4170E8);
    dword_4170E8 = NULL;
  }
  return result;
}

//----- (00408AF0) --------------------------------------------------------
FILE *__cdecl sub_408AF0(char *a1)
{
  FILE *result; // eax@2
  FILE *v2; // esi@3

  if ( dword_4170EC )
  {
    result = fopen(a1, aRb);
    v2 = result;
    if ( result )
    {
      fread(&unk_416CB8, 0x418u, 1u, result);
      fread(hMem, 4u, dword_416CCC, v2);
      fread(dword_4170E0, 4u, dword_416CCC, v2);
      fread(dword_4170E4, 4u, dword_416CCC, v2);
      fread(dword_4170E8, 4u, dword_416CCC, v2);
      fclose(v2);
      dword_4170D4 = -1;
      result = (FILE *)1;
    }
  }
  else
  {
    result = NULL;
  }
  return result;
}
// 4170D4: using guessed type int dword_4170D4;
// 4170EC: using guessed type int dword_4170EC;

//----- (00408BA0) --------------------------------------------------------
DWORD sub_408BA0()
{
  DWORD result; // eax@1
  int v1; // ecx@4
  int v2; // esi@7
  HLOCAL *v3; // eax@7
  signed int v4; // ebx@9
  signed int v5; // edi@10
  int v6; // ebp@10
  signed int v7; // esi@12
  bool v8; // sf@16
  unsigned __int8 v9; // of@16
  signed int v10; // [sp+0h] [bp-28h]@7
  HLOCAL *v11; // [sp+4h] [bp-24h]@7
  int v12; // [sp+8h] [bp-20h]@1
  int v13; // [sp+Ch] [bp-1Ch]@1
  int v14; // [sp+10h] [bp-18h]@1
  int v15; // [sp+14h] [bp-14h]@1
  int v16; // [sp+18h] [bp-10h]@1
  int v17; // [sp+1Ch] [bp-Ch]@1
  int v18; // [sp+20h] [bp-8h]@1
  int v19; // [sp+24h] [bp-4h]@1

  result = dword_4170EC;
  v12 = 0;
  v13 = 96;
  v14 = 180;
  v15 = 224;
  v16 = 256;
  v17 = 288;
  v18 = 332;
  v19 = 420;
  if ( dword_4170EC )
  {
    if ( byte_4170D0 == 1 )
    {
      result = GetTickCount();
      if ( result > dword_4170D8 + dword_416CC0 )
      {
        v1 = dword_4170D4++ + 1;
        if ( dword_4170D4 > dword_416CC8 - 1 || v1 > (signed int)(dword_416CCC - 1) )
        {
          v1 = dword_416CC4;
          dword_4170D4 = dword_416CC4;
        }
        v2 = 400;
        v3 = &hMem;
        v10 = 400;
        v11 = &hMem;
        while ( 1 )
        {
          v4 = *((_DWORD *)*v3 + v1);
          if ( v4 & 0xFF000000 )
          {
            v5 = 24;
            v6 = *(&v12 + (v4 >> 24));
            do
            {
              sub_40AA90(v2++, v6);
              --v5;
            }
            while ( v5 );
          }
          v7 = 0;
          do
          {
            if ( v4 & 1 )
              sub_40A9C0(v7 + v10, 1);
            v4 >>= 1;
            ++v7;
          }
          while ( v7 < 24 );
          v3 = v11 + 1;
          v2 = v10 + 24;
          v9 = __OFSUB__(v11 + 1, &dword_4170EC);
          v8 = (char *)(v11 + 1) - (char *)&dword_4170EC < 0;
          ++v11;
          v10 += 24;
          if ( !(v8 ^ v9) )
            break;
          v1 = dword_4170D4;
        }
        result = GetTickCount();
        dword_4170D8 = result;
      }
    }
  }
  return result;
}
// 416CC0: using guessed type int dword_416CC0;
// 416CC4: using guessed type int dword_416CC4;
// 416CC8: using guessed type int dword_416CC8;
// 4170D0: using guessed type char byte_4170D0;
// 4170D4: using guessed type int dword_4170D4;
// 4170D8: using guessed type int dword_4170D8;
// 4170EC: using guessed type int dword_4170EC;

//----- (00408CE0) --------------------------------------------------------
int sub_408CE0()
{
  int result; // eax@1
  int v1; // ebx@2
  void *v2; // esi@2
  int v3; // edi@3
  int v4; // ebp@3
  signed int v5; // edi@8
  int v6; // esi@11
  int v7; // [sp+0h] [bp-8h]@2
  signed int v8; // [sp+4h] [bp-4h]@3

  result = dword_4170EC;
  if ( dword_4170EC )
  {
    sub_406310((int)aGbgcgugGkgebGa, 0, 0, 0);
    v7 = 0;
    v1 = 400;
    v2 = &unk_416CD4;
    do
    {
      v3 = 1 << *((char *)v2 - 4);
      v4 = v1;
      v8 = 24;
      do
      {
        sub_40A870(v4++);
        --v8;
      }
      while ( v8 );
      if ( sub_40AAC0((int)v2 + 16, (int)v2 + 272, v3, *(_DWORD *)v2, (void *)v1) == 1 )
        sub_406310((int)&unk_412F80, v7, 0, 0);
      else
        sub_406310((int)&unk_412F6C, v7, 0, 0);
      v5 = 24;
      do
      {
        sub_40AA60(v1++, *((_DWORD *)v2 + 1));
        --v5;
      }
      while ( v5 );
      v2 = (char *)v2 + 340;
      ++v7;
      v1 = v4;
    }
    while ( (signed int)v2 < (signed int)&byte_4170D0 );
    sub_406310((int)aGbgcgugGkgeb_0, 0, 0, 0);
    v6 = 473;
    do
    {
      sub_40AA60(v6 - 1, dword_4170CC);
      result = sub_40AA60(v6, 70 * dword_4170CC / 100);
      v6 += 2;
    }
    while ( v6 - 473 < 24 );
  }
  return result;
}
// 4170CC: using guessed type int dword_4170CC;
// 4170D0: using guessed type char byte_4170D0;
// 4170EC: using guessed type int dword_4170EC;

//----- (00408E20) --------------------------------------------------------
FILE *__cdecl sub_408E20(int a1)
{
  FILE *result; // eax@1
  int v2; // esi@2
  _DWORD *v3; // ebx@2
  signed int v4; // ebp@3
  int v5; // esi@6

  result = (FILE *)dword_4170EC;
  if ( dword_4170EC )
  {
    sub_406310((int)aGtgfbGhbigbgng, 0, 0, 0);
    v2 = 400;
    v3 = &unk_416CD8;
    do
    {
      v4 = 24;
      do
      {
        sub_40AA60(v2++, *v3 - *(_WORD *)(a1 + 4));
        --v4;
      }
      while ( v4 );
      v3 += 85;
    }
    while ( (signed int)v3 < (signed int)&dword_4170D4 );
    sub_406310((int)aGtgfbGhbighgig, 0, 0, 0);
    v5 = 473;
    do
    {
      sub_40AA60(v5 - 1, dword_4170CC - *(_WORD *)(a1 + 4));
      sub_40AA60(v5, 70 * dword_4170CC / 100 - *(_WORD *)(a1 + 4));
      v5 += 2;
    }
    while ( v5 - 473 < 24 );
    result = sub_406310((int)aGGkgebGaokvV, 0, 0, 0);
  }
  return result;
}
// 4170CC: using guessed type int dword_4170CC;
// 4170D4: using guessed type int dword_4170D4;
// 4170EC: using guessed type int dword_4170EC;

//----- (00408F10) --------------------------------------------------------
char __cdecl sub_408F10(int a1)
{
  char result; // al@1
  char v2; // dl@5
  char v3; // [sp+8h] [bp-104h]@5

  result = dword_4170EC;
  if ( dword_4170EC )
  {
    result = *(_BYTE *)a1 - 1;
    switch ( *(_BYTE *)a1 )
    {
      case 1:
        result = *(_BYTE *)(a1 + 1);
        if ( result == *(_BYTE *)(a1 + 2) && byte_4170D0 )
          goto LABEL_8;
        byte_4170D0 = 0;
        sprintf(&v3, aSS, &Filename, off_412EA0[*(_BYTE *)(a1 + 1)]);
        sub_408AF0(&v3);
        result = sub_408CE0();
        v2 = *(_BYTE *)(a1 + 1);
        *(_BYTE *)a1 = 2;
        *(_BYTE *)(a1 + 2) = v2;
        break;
      case 2:
        dword_4170D4 = -1;
        byte_4170D0 = 1;
        goto LABEL_7;
      case 6:
LABEL_7:
        *(_WORD *)(a1 + 4) = 0;
        result = (unsigned int)sub_408E20(a1);
LABEL_8:
        *(_BYTE *)a1 = 0;
        break;
      case 3:
        byte_4170D0 = 0;
        *(_BYTE *)a1 = 0;
        break;
      case 4:
        ++*(_WORD *)(a1 + 4);
        result = (unsigned int)sub_408E20(a1);
        if ( *(_WORD *)(a1 + 4) > 250 )
        {
          *(_BYTE *)a1 = 0;
          byte_4170D0 = 0;
        }
        break;
      case 5:
        *(_WORD *)(a1 + 4) = 100;
        result = (unsigned int)sub_408E20(a1);
        *(_BYTE *)a1 = 0;
        break;
      default:
        return result;
    }
  }
  return result;
}
// 412EA0: using guessed type char *off_412EA0[6];
// 4170D0: using guessed type char byte_4170D0;
// 4170D4: using guessed type int dword_4170D4;
// 4170EC: using guessed type int dword_4170EC;

//----- (00409030) --------------------------------------------------------
void __cdecl sub_409030(_BYTE *a1, char a2)
{
  bool v2; // sf@2
  signed int v3; // eax@4
  int v4; // eax@5
  int v5; // edx@5
  signed int v6; // eax@7
  int v7; // eax@8
  int v8; // edx@8

  if ( !word_417108 )
  {
    v2 = (signed __int16)(word_41710C - a2) < 0;
    word_41710C -= a2;
    word_417108 = 100;
    if ( v2 )
      word_41710C = 0;
    v3 = sub_403820(a1);
    if ( v3 != 0xFFFFFF )
    {
      v4 = (int)&a1[36 * v3];
      *(_BYTE *)v4 = 1;
      *(_BYTE *)(v4 + 1) = 2;
      *(_BYTE *)(v4 + 2) = 10 - a2;
      *(_BYTE *)(v4 + 3) = 1;
      *(_DWORD *)(v4 + 4) = dword_4170F4 + 0x2000;
      v5 = dword_4170F8 - 4096;
      *(_DWORD *)(v4 + 28) = 1;
      *(_DWORD *)(v4 + 8) = v5;
      *(_DWORD *)(v4 + 32) = 0;
    }
    if ( word_41710C )
    {
      sub_40A9C0(2, 1);
    }
    else
    {
      sub_40A9C0(9, 1);
      byte_4170F0 = 0;
      byte_4170F1 = 1;
      v6 = sub_403820(a1);
      if ( v6 != 0xFFFFFF )
      {
        v7 = (int)&a1[36 * v6];
        *(_BYTE *)v7 = 1;
        *(_BYTE *)(v7 + 1) = 0;
        *(_BYTE *)(v7 + 2) = 0;
        *(_BYTE *)(v7 + 3) = 30;
        *(_DWORD *)(v7 + 4) = dword_4170F4 + 0x2000;
        v8 = dword_4170F8 + 0x2000;
        *(_DWORD *)(v7 + 32) = 0;
        *(_DWORD *)(v7 + 8) = v8;
        *(_DWORD *)(v7 + 12) = 3072;
        *(_DWORD *)(v7 + 16) = -3072;
        *(_DWORD *)(v7 + 20) = 512;
        *(_DWORD *)(v7 + 24) = -3072;
        *(_DWORD *)(v7 + 28) = 1;
      }
    }
  }
}
// 4170F0: using guessed type char byte_4170F0;
// 4170F1: using guessed type char byte_4170F1;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 417108: using guessed type __int16 word_417108;
// 41710C: using guessed type __int16 word_41710C;

//----- (00409150) --------------------------------------------------------
char __cdecl sub_409150(int a1, int a2, char a3)
{
  signed int v3; // ecx@3
  signed int v4; // esi@4
  char result; // al@50

  if ( a3 & 1 && a3 & 2 )
  {
    v3 = dword_4170F4;
    if ( dword_4170F4 / 1024 >= 16 * a1 + 15 )
    {
      v4 = dword_4170F8;
    }
    else
    {
      v4 = dword_4170F8;
      if ( dword_4170F8 / 1024 < 16 * a2 + 12 )
      {
        if ( dword_4170FC < -1024 )
        {
          sub_40A9C0(4, 1);
          v4 = dword_4170F8;
        }
        v3 = (a1 << 14) + 15360;
        dword_4170F4 = (a1 << 14) + 15360;
        dword_4170FC = 0;
        byte_417118 |= 1u;
      }
    }
    if ( v4 / 1024 < 16 * a2 + 15 && v3 / 1024 < 16 * a1 + 12 )
    {
      if ( dword_417100 < -1024 )
      {
        sub_40A9C0(4, 1);
        v3 = dword_4170F4;
      }
      v4 = (a2 + 1) << 14;
      dword_4170F8 = (a2 + 1) << 14;
      dword_417100 = 0;
      byte_417118 |= 2u;
    }
  }
  else
  {
    v4 = dword_4170F8;
    v3 = dword_4170F4;
  }
  if ( a3 & 4 && a3 & 2 )
  {
    if ( (v3 + 1023) / 1024 > 16 * a1 - 14 && v4 / 1024 < 16 * a2 + 12 )
    {
      if ( dword_4170FC > 1024 )
      {
        sub_40A9C0(4, 1);
        v4 = dword_4170F8;
      }
      v3 = (a1 << 14) - 14336;
      dword_4170F4 = (a1 << 14) - 14336;
      dword_4170FC = 0;
      byte_417118 |= 4u;
    }
    if ( v4 / 1024 < 16 * a2 + 15 && v3 / 1024 > 16 * a1 - 12 )
    {
      if ( dword_417100 < -1024 )
      {
        sub_40A9C0(4, 1);
        v3 = dword_4170F4;
      }
      v4 = (a2 + 1) << 14;
      dword_4170F8 = (a2 + 1) << 14;
      dword_417100 = 0;
      byte_417118 |= 2u;
    }
  }
  if ( a3 & 1 && a3 & 8 )
  {
    if ( v3 / 1024 < 16 * a1 + 15 && v4 / 1024 > 16 * a2 - 12 )
    {
      if ( dword_4170FC < -1024 )
      {
        sub_40A9C0(4, 1);
        v4 = dword_4170F8;
      }
      v3 = (a1 << 14) + 15360;
      dword_4170F4 = (a1 << 14) + 15360;
      dword_4170FC = 0;
      byte_417118 |= 1u;
    }
    if ( v4 / 1024 >= 16 * a2 - 16 && v3 / 1024 < 16 * a1 + 12 )
    {
      v4 = (a2 << 14) - 0x4000;
      byte_417117 = 0;
      dword_4170F8 = (a2 << 14) - 0x4000;
      if ( dword_417100 > 0 )
        dword_417100 = 0;
      byte_417118 |= 8u;
    }
  }
  if ( !(a3 & 4) || !(a3 & 8) )
    goto LABEL_54;
  if ( (v3 + 1023) / 1024 > 16 * a1 - 14 && v4 / 1024 > 16 * a2 - 12 )
  {
    if ( dword_4170FC > 1024 )
    {
      sub_40A9C0(4, 1);
      v4 = dword_4170F8;
    }
    v3 = (a1 << 14) - 14336;
    dword_4170F4 = (a1 << 14) - 14336;
    dword_4170FC = 0;
    byte_417118 |= 4u;
  }
  if ( v4 / 1024 >= 16 * a2 - 16 && v3 / 1024 > 16 * a1 - 12 )
  {
    byte_417117 = 0;
    dword_4170F8 = (a2 << 14) - 0x4000;
    if ( dword_417100 > 0 )
      dword_417100 = 0;
    result = byte_417118 | 8;
    byte_417118 |= 8u;
  }
  else
  {
LABEL_54:
    result = byte_417118;
  }
  return result;
}
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417117: using guessed type char byte_417117;
// 417118: using guessed type char byte_417118;

//----- (00409590) --------------------------------------------------------
char __cdecl sub_409590(int a1, int a2, char a3, _BYTE *a4, int a5)
{
  int v5; // ebp@1
  signed int v6; // ecx@3
  int v7; // edi@3
  bool v8; // sf@3
  unsigned __int8 v9; // of@3
  signed int v10; // edi@3
  int v11; // ebx@41
  char result; // al@53
  signed int v13; // eax@58
  int v14; // eax@59
  int v15; // [sp+18h] [bp+4h]@3

  v5 = a1;
  byte_417118 = 0;
  if ( a3 & 1 && a3 & 2 )
  {
    v6 = dword_4170F4;
    v15 = 16 * a1;
    v7 = 16 * v5 + 15;
    v9 = __OFSUB__(dword_4170F4 / 1024, v7);
    v8 = dword_4170F4 / 1024 - v7 < 0;
    v10 = dword_4170F8;
    if ( v8 ^ v9 && dword_4170F8 / 1024 < 16 * a2 + 12 )
    {
      if ( byte_4170F2 != 1 )
        dword_4170FC = 0;
      byte_417118 = 1;
      v6 = (v5 << 14) + 15360;
      dword_4170F4 = (v5 << 14) + 15360;
    }
    if ( dword_4170F8 / 1024 < 16 * a2 + 15 && v6 / 1024 < v15 + 12 )
    {
      if ( byte_4170F2 != 1 )
        dword_417100 = 0;
      v10 = (a2 + 1) << 14;
      dword_4170F8 = (a2 + 1) << 14;
      byte_417118 |= 2u;
    }
  }
  else
  {
    v10 = dword_4170F8;
    v6 = dword_4170F4;
  }
  if ( a3 & 4 && a3 & 2 )
  {
    if ( (v6 + 1023) / 1024 > 16 * v5 - 14 && v10 / 1024 < 16 * a2 + 12 )
    {
      if ( byte_4170F2 != 1 )
        dword_4170FC = 0;
      v6 = (v5 << 14) - 14336;
      dword_4170F4 = (v5 << 14) - 14336;
      byte_417118 |= 4u;
    }
    if ( v10 / 1024 < 16 * a2 + 15 && v6 / 1024 > 16 * v5 - 12 )
    {
      if ( byte_4170F2 != 1 )
        dword_417100 = 0;
      v10 = (a2 + 1) << 14;
      dword_4170F8 = (a2 + 1) << 14;
      byte_417118 |= 2u;
    }
  }
  if ( a3 & 1 && a3 & 8 )
  {
    if ( v6 / 1024 < 16 * v5 + 15 && v10 / 1024 > 16 * a2 - 12 )
    {
      if ( byte_4170F2 != 1 )
        dword_4170FC = 0;
      v6 = (v5 << 14) + 15360;
      dword_4170F4 = (v5 << 14) + 15360;
      byte_417118 |= 1u;
    }
    if ( v10 / 1024 >= 16 * a2 - 16 && v6 / 1024 < 16 * v5 + 12 )
    {
      if ( byte_4170F2 != 1 )
      {
        byte_417117 = 0;
        if ( dword_417100 > 0 )
          dword_417100 = 0;
      }
      v10 = (a2 << 14) - 0x4000;
      dword_4170F8 = (a2 << 14) - 0x4000;
      byte_417118 |= 8u;
    }
  }
  if ( a3 & 4 && a3 & 8 )
  {
    v11 = 16 * v5;
    if ( (v6 + 1023) / 1024 > 16 * v5 - 14 )
    {
      if ( v10 / 1024 > 16 * a2 - 12 )
      {
        if ( byte_4170F2 != 1 )
          dword_4170FC = 0;
        v6 = (v5 << 14) - 14336;
        dword_4170F4 = (v5 << 14) - 14336;
        byte_417118 |= 4u;
      }
      v11 = 16 * v5;
    }
    if ( v10 / 1024 >= 16 * a2 - 16 && v6 / 1024 > v11 - 12 )
    {
      if ( byte_4170F2 != 1 )
      {
        byte_417117 = 0;
        if ( dword_417100 > 0 )
          dword_417100 = 0;
      }
      dword_4170F8 = (a2 << 14) - 0x4000;
      byte_417118 |= 8u;
    }
  }
  result = byte_417118;
  if ( byte_4170F2 == 1 && byte_417118 != 8 && byte_417118 || byte_4170F3 & 1 && byte_417118 & 2 )
  {
    sub_40A9C0(5, 1);
    *(_BYTE *)(*(_DWORD *)a5 + a2 * *(_DWORD *)(a5 + 8) + v5) = 0;
    v13 = sub_403820(a4);
    if ( v13 != 0xFFFFFF )
    {
      v14 = (int)&a4[36 * v13];
      *(_DWORD *)(v14 + 16) = -1024;
      *(_DWORD *)(v14 + 24) = -1024;
      *(_BYTE *)v14 = 1;
      *(_BYTE *)(v14 + 1) = 1;
      *(_BYTE *)(v14 + 2) = 0;
      *(_BYTE *)(v14 + 3) = 5;
      *(_DWORD *)(v14 + 4) = (v5 << 14) + 0x2000;
      *(_DWORD *)(v14 + 8) = (a2 << 14) + 0x2000;
      *(_DWORD *)(v14 + 12) = 1024;
      *(_DWORD *)(v14 + 20) = 1024;
      *(_DWORD *)(v14 + 28) = 8;
      *(_DWORD *)(v14 + 32) = 8;
    }
    result = byte_417118;
  }
  return result;
}
// 4170F2: using guessed type char byte_4170F2;
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417117: using guessed type char byte_417117;
// 417118: using guessed type char byte_417118;

//----- (00409A30) --------------------------------------------------------
void __cdecl sub_409A30(int a1, int a2, _BYTE *a3)
{
  if ( dword_4170F4 / 1024 < 16 * a1 + 10
    && dword_4170F4 / 1024 > 16 * a1 - 10
    && dword_4170F8 / 1024 < 16 * a2 + 10
    && dword_4170F8 / 1024 > 16 * a2 - 10 )
  {
    sub_409030(a3, 3);
  }
}
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;

//----- (00409A90) --------------------------------------------------------
int __cdecl sub_409A90(int a1, int a2, unsigned __int8 a3)
{
  int result; // eax@1

  result = dword_4170F4 / 1024;
  if ( dword_4170F4 / 1024 < 16 * a1 + 8 && result >= 16 * a1 - 8 )
  {
    result = dword_4170F8 / 1024;
    if ( dword_4170F8 / 1024 < 16 * a2 + 8 && result >= 16 * a2 - 8 )
    {
      result = a3;
      switch ( a3 )
      {
        case 0x60u:
          dword_4170FC -= 50;
          break;
        case 0x61u:
          dword_4170FC += 50;
          break;
        case 0x62u:
          dword_417100 -= 50;
          break;
        case 0x63u:
          dword_417100 += 50;
          break;
        default:
          return result;
      }
    }
  }
  return result;
}
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;

//----- (00409B30) --------------------------------------------------------
int __cdecl sub_409B30(int a1, int a2, _BYTE *a3, int a4)
{
  int result; // eax@1
  __int16 v5; // ax@5
  signed int v6; // eax@7
  int v7; // eax@8
  int v8; // edx@8

  result = dword_4170F4 / 1024;
  if ( dword_4170F4 / 1024 < 16 * a1 + 8 && result > 16 * a1 - 8 )
  {
    result = dword_4170F8 / 1024;
    if ( dword_4170F8 / 1024 < 16 * a2 + 8 && result > 16 * a2 - 8 )
    {
      *(_BYTE *)(*(_DWORD *)a4 + a2 * *(_DWORD *)(a4 + 8) + a1) = 0;
      sub_40A9C0(3, 1);
      v5 = word_412FFC[byte_417110];
      ++word_41710E;
      if ( ++word_41710C > v5 )
        word_41710C = v5;
      v6 = sub_403820(a3);
      if ( v6 != 0xFFFFFF )
      {
        v7 = (int)&a3[36 * v6];
        *(_BYTE *)v7 = 1;
        *(_BYTE *)(v7 + 1) = 2;
        *(_BYTE *)(v7 + 2) = 11;
        *(_BYTE *)(v7 + 3) = 1;
        *(_DWORD *)(v7 + 4) = dword_4170F4 + 0x2000;
        v8 = dword_4170F8 - 4096;
        *(_DWORD *)(v7 + 28) = 1;
        *(_DWORD *)(v7 + 8) = v8;
        *(_DWORD *)(v7 + 32) = 0;
      }
      result = sub_403820(a3);
      if ( result != 0xFFFFFF )
      {
        result = (int)&a3[36 * result];
        *(_BYTE *)result = 1;
        *(_BYTE *)(result + 1) = 0;
        *(_BYTE *)(result + 2) = 0;
        *(_BYTE *)(result + 3) = 4;
        *(_DWORD *)(result + 4) = dword_4170F4 + 0x2000;
        *(_DWORD *)(result + 8) = dword_4170F8 + 0x2000;
        *(_DWORD *)(result + 12) = 2048;
        *(_DWORD *)(result + 16) = -2048;
        *(_DWORD *)(result + 20) = 0;
        *(_DWORD *)(result + 24) = -2048;
        *(_DWORD *)(result + 28) = 1;
        *(_DWORD *)(result + 32) = 0;
      }
    }
  }
  return result;
}
// 412FFC: using guessed type __int16 word_412FFC[];
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 41710C: using guessed type __int16 word_41710C;
// 41710E: using guessed type __int16 word_41710E;
// 417110: using guessed type char byte_417110;

//----- (00409CA0) --------------------------------------------------------
char __cdecl sub_409CA0(int a1, _BYTE *a2)
{
  int v2; // esi@1
  int v3; // eax@1
  int v4; // ecx@1
  int v5; // ebp@3
  int v6; // edi@3
  unsigned __int8 v7; // bl@3
  bool v8; // sf@22
  unsigned __int8 v9; // of@22
  __int16 v10; // cx@23
  signed int v11; // eax@27
  int v12; // eax@28
  int v13; // ecx@28
  char result; // al@29
  char v15; // [sp+13h] [bp-1Dh]@1
  char v16; // [sp+14h] [bp-1Ch]@1
  char v17; // [sp+15h] [bp-1Bh]@1
  char v18; // [sp+16h] [bp-1Ah]@1
  char v19; // [sp+17h] [bp-19h]@1
  int v20; // [sp+18h] [bp-18h]@1
  char v21; // [sp+1Ch] [bp-14h]@1
  char v22; // [sp+1Dh] [bp-13h]@1
  char v23; // [sp+1Eh] [bp-12h]@1
  char v24; // [sp+1Fh] [bp-11h]@1
  char v25; // [sp+20h] [bp-10h]@1
  char v26; // [sp+21h] [bp-Fh]@1
  char v27; // [sp+22h] [bp-Eh]@1
  char v28; // [sp+23h] [bp-Dh]@1
  char v29; // [sp+24h] [bp-Ch]@1
  char v30; // [sp+25h] [bp-Bh]@1
  char v31; // [sp+26h] [bp-Ah]@1
  char v32; // [sp+27h] [bp-9h]@1
  int v33; // [sp+28h] [bp-8h]@3
  int v34; // [sp+2Ch] [bp-4h]@1

  v29 = 0;
  v30 = 1;
  v31 = 0;
  v32 = 1;
  v25 = 0;
  v2 = dword_4170F4 / 1024 / 16;
  v3 = dword_4170F8 / 1024 / 16;
  v4 = 0;
  v26 = 0;
  v27 = 1;
  v28 = 1;
  v16 = 0;
  v17 = 0;
  v18 = 1;
  v19 = 1;
  v21 = 3;
  v22 = 6;
  v23 = 9;
  v24 = 12;
  v34 = dword_4170F8 / 1024 / 16;
  v15 = 4;
  byte_417118 = 0;
  v20 = 0;
  while ( 1 )
  {
    v5 = *(&v29 + v4);
    v6 = *(&v25 + v4) + v3;
    LOBYTE(v33) = *(_BYTE *)(*(_DWORD *)a1 + v5 + v6 * *(_DWORD *)(a1 + 8) + v2);
    v7 = v33;
    if ( (unsigned __int8)v33 <= 0x7Fu || (unsigned __int8)v33 >= 0xA0u )
    {
      v15 -= *(&v16 + v4);
    }
    else if ( !(sub_409150(v2 + v5, v6, *(&v21 + v4)) & 8) )
    {
      v15 -= *(&v16 + v20);
    }
    if ( v7 > 0x5Fu && v7 < 0x80u )
      sub_409A90(v2 + v5, v6, v33);
    if ( v7 <= 0x9Fu || v7 >= 0xC0u )
    {
      if ( v7 <= 0x3Fu || v7 >= 0x60u )
      {
        if ( v7 <= 0xDFu || (signed int)(unsigned __int8)v33 >= 256 )
        {
          v15 -= *(&v16 + v20);
        }
        else if ( !(sub_409590(v2 + v5, v6, *(&v21 + v20), a2, a1) & 8) )
        {
          v15 -= *(&v16 + v20);
        }
      }
      else
      {
        sub_409B30(v2 + v5, v6, a2, a1);
      }
    }
    else
    {
      sub_409A30(v2 + v5, v6, a2);
    }
    v4 = v20 + 1;
    v9 = __OFSUB__(v20 + 1, 4);
    v8 = v20++ - 3 < 0;
    if ( !(v8 ^ v9) )
      break;
    v3 = v34;
  }
  v10 = word_41300C[byte_417110];
  if ( word_41710E >= v10 )
  {
    word_41710E -= v10;
    if ( ++byte_417110 <= 6 )
      sub_40A9C0(11, 1);
    else
      byte_417110 = 6;
    word_41710C = word_412FFC[byte_417110];
    v11 = sub_403820(a2);
    if ( v11 != 0xFFFFFF )
    {
      v12 = (int)&a2[36 * v11];
      *(_BYTE *)v12 = 1;
      *(_BYTE *)(v12 + 1) = 3;
      *(_BYTE *)(v12 + 2) = 0;
      *(_BYTE *)(v12 + 3) = 1;
      *(_DWORD *)(v12 + 4) = dword_4170F4 + 0x2000;
      v13 = dword_4170F8 - 4096;
      *(_DWORD *)(v12 + 28) = 1;
      *(_DWORD *)(v12 + 8) = v13;
      *(_DWORD *)(v12 + 32) = 0;
    }
  }
  result = v15;
  if ( v15 < 1 )
    byte_417117 = 1;
  return result;
}
// 412FFC: using guessed type __int16 word_412FFC[];
// 41300C: using guessed type __int16 word_41300C[];
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 41710C: using guessed type __int16 word_41710C;
// 41710E: using guessed type __int16 word_41710E;
// 417110: using guessed type char byte_417110;
// 417117: using guessed type char byte_417117;
// 417118: using guessed type char byte_417118;

//----- (00409F50) --------------------------------------------------------
int __cdecl sub_409F50(int a1)
{
  char v1; // al@1
  int result; // eax@2

  v1 = byte_417104 + 4 * byte_417116;
  if ( byte_4170F3 & 8 )
  {
    result = sub_4024C0(
               (int)&unk_412680,
               dword_4170F4 / 1024 - *(_DWORD *)(a1 + 4) / 1024 - 12,
               dword_4170F8 / 1024 - *(_DWORD *)(a1 + 8) / 1024 - 12,
               (int)&unk_4130E0 + 16 * v1,
               21);
  }
  else if ( byte_4170F3 & 1 )
  {
    result = sub_4024C0(
               (int)&unk_412680,
               dword_4170F4 / 1024 - *(_DWORD *)(a1 + 4) / 1024,
               dword_4170F8 / 1024 - *(_DWORD *)(a1 + 8) / 1024,
               (int)&unk_413020 + 16 * v1,
               2);
  }
  else
  {
    result = sub_4024C0(
               (int)&unk_412680,
               dword_4170F4 / 1024 - *(_DWORD *)(a1 + 4) / 1024,
               dword_4170F8 / 1024 - *(_DWORD *)(a1 + 8) / 1024,
               (int)&unk_413020 + 16 * v1,
               22);
  }
  return result;
}
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 417104: using guessed type char byte_417104;
// 417116: using guessed type char byte_417116;

//----- (0040A060) --------------------------------------------------------
int sub_40A060()
{
  int v1; // [sp+0h] [bp-10h]@1
  int v2; // [sp+4h] [bp-Ch]@1
  int v3; // [sp+8h] [bp-8h]@1
  int v4; // [sp+Ch] [bp-4h]@1

  v3 = 88;
  v1 = 0;
  v2 = 0;
  v4 = 32;
  sub_4024C0((int)&unk_412680, 8, 8, (int)&v1, 0);
  sub_403C40(16, 8, byte_417110);
  sub_403C40(16, 16, word_41710E);
  sub_403C40(48, 16, word_41300C[byte_417110]);
  sub_403C40(16, 24, word_41710C);
  return sub_403C40(48, 24, word_412FFC[byte_417110]);
}
// 412FFC: using guessed type __int16 word_412FFC[];
// 41300C: using guessed type __int16 word_41300C[];
// 41710C: using guessed type __int16 word_41710C;
// 41710E: using guessed type __int16 word_41710E;
// 417110: using guessed type char byte_417110;

//----- (0040A100) --------------------------------------------------------
int __cdecl sub_40A100(_BYTE *a1)
{
  char v1; // dl@1
  int v2; // esi@6
  signed int v3; // edi@7
  int v4; // edx@16
  int v5; // eax@16
  int v6; // edi@16
  int v7; // ecx@16
  int result; // eax@16
  bool v9; // zf@23
  unsigned __int8 v10; // of@23
  signed int v11; // eax@26
  int v12; // ecx@27
  __int64 v13; // rax@27
  int v14; // edx@30
  int v15; // eax@31
  int v16; // eax@35
  bool v17; // sf@55
  bool v18; // sf@60

  v1 = dword_417A44;
  byte_417116 = 2;
  if ( dword_417A44 & 1 )
    byte_417116 = 0;
  if ( dword_417A44 & 2 )
    byte_417116 = 1;
  if ( !(dword_416CA0 & 0x40) )
  {
    v2 = (int)a1;
    goto LABEL_18;
  }
  v2 = (int)a1;
  if ( word_417112 )
  {
LABEL_18:
    result = dword_417100;
    v7 = dword_4170FC;
    goto LABEL_19;
  }
  v3 = sub_403470(a1);
  if ( v3 != 0xFFFFFF )
  {
    sub_40A9C0(1, 1);
    v2 = (int)&a1[28 * v3];
    *(_BYTE *)(v2 + 1) = 1;
    *(_DWORD *)(v2 + 12) = -dword_4131E0[(unsigned __int8)byte_417116];
    *(_DWORD *)(v2 + 16) = -dword_4131EC[(unsigned __int8)byte_417116];
    *(_BYTE *)v2 = 1;
    *(_BYTE *)(v2 + 20) = 0;
    *(_DWORD *)(v2 + 24) = 0;
    if ( byte_417116 )
    {
      if ( byte_417116 == 1 )
      {
        *(_DWORD *)(v2 + 4) = dword_4170F4 + 2048;
        *(_DWORD *)(v2 + 8) = dword_4170F8 + 12288;
      }
      else if ( byte_417116 == 2 )
      {
        *(_DWORD *)(v2 + 4) = dword_4170F4 + 9216;
        *(_DWORD *)(v2 + 8) = dword_4170F8 + 14336;
      }
    }
    else
    {
      *(_DWORD *)(v2 + 4) = dword_4170F4 + 14336;
      *(_DWORD *)(v2 + 8) = dword_4170F8 + 12288;
    }
  }
  word_417112 = 8;
  byte_417104 = 1;
  if ( word_417106 < 100 )
    word_417106 += 10;
  v4 = (unsigned __int8)byte_417116;
  v5 = dword_4131E0[v4];
  v6 = dword_4131EC[v4];
  v1 = dword_417A44;
  v7 = v5 + dword_4170FC;
  dword_4170FC += v5;
  result = v6 + dword_417100;
  dword_417100 += v6;
LABEL_19:
  if ( !(v1 & 0x40) || !(byte_4170F3 & 2) )
  {
    if ( word_417114 != 32 )
    {
      word_417114 = 0;
      goto LABEL_37;
    }
    sub_40A9C0(7, 1);
    v11 = sub_403470((_BYTE *)v2);
    if ( v11 == 0xFFFFFF )
      goto LABEL_35;
    v12 = v2 + 28 * v11;
    *(_BYTE *)(v12 + 1) = 1;
    v13 = dword_4131F8[(unsigned __int8)byte_417116];
    *(_DWORD *)(v12 + 12) = -(((BYTE4(v13) & 7) + (signed int)v13) >> 3);
    LODWORD(v13) = dword_413204[(unsigned __int8)byte_417116];
    *(_BYTE *)v12 = 1;
    *(_BYTE *)(v12 + 20) = 0;
    *(_DWORD *)(v12 + 24) = 0;
    *(_DWORD *)(v12 + 16) = (signed int)v13 / -8;
    if ( byte_417116 )
    {
      if ( byte_417116 != 1 )
      {
        if ( byte_417116 == 2 )
        {
          *(_DWORD *)(v12 + 4) = dword_4170F4 + 9216;
          v14 = dword_4170F8 + 14336;
LABEL_34:
          *(_DWORD *)(v12 + 8) = v14;
        }
LABEL_35:
        byte_4170F2 = 1;
        v16 = (unsigned __int8)byte_417116;
        v7 = dword_4131F8[v16];
        result = dword_413204[v16];
        dword_4170FC = v7;
        dword_417100 = result;
        goto LABEL_37;
      }
      v15 = dword_4170F4 + 2048;
    }
    else
    {
      v15 = dword_4170F4 + 14336;
    }
    *(_DWORD *)(v12 + 4) = v15;
    v14 = dword_4170F8 + 12288;
    goto LABEL_34;
  }
  if ( word_417114 == 31 )
  {
    sub_40A9C0(6, 1);
    result = dword_417100;
    v7 = dword_4170FC;
  }
  v10 = __OFSUB__(word_417114 + 1, 32);
  v9 = word_417114 == 31;
  v17 = (signed __int16)(word_417114++ - 31) < 0;
  if ( !((unsigned __int8)(v17 ^ v10) | v9) )
    word_417114 = 32;
LABEL_37:
  if ( word_417106 <= 0 )
    byte_417104 = 0;
  else
    --word_417106;
  if ( word_417112 > 0 )
    --word_417112;
  if ( word_417114 == 32 )
    byte_417104 = 2;
  if ( result < 2048 )
  {
    result += 20;
    dword_417100 = result;
  }
  if ( result >= -2048 )
  {
    if ( result <= 2048 )
      goto LABEL_51;
    result = 2048;
  }
  else
  {
    result = -2048;
  }
  dword_417100 = result;
LABEL_51:
  if ( v7 >= -2048 )
  {
    if ( v7 <= 2048 )
    {
      v17 = v7 < 0;
      if ( v7 <= 0 )
        goto LABEL_57;
    }
    else
    {
      v7 = 2048;
    }
    v7 -= 8;
    dword_4170FC = v7;
    v17 = v7 < 0;
LABEL_57:
    if ( !v17 )
      goto LABEL_59;
    goto LABEL_58;
  }
  v7 = -2048;
LABEL_58:
  v7 += 8;
  dword_4170FC = v7;
LABEL_59:
  if ( !byte_417117 )
  {
    v18 = v7 < 0;
    if ( v7 > 0 )
    {
      v7 -= 24;
      dword_4170FC = v7;
      v18 = v7 < 0;
    }
    if ( v18 )
    {
      v7 += 24;
      dword_4170FC = v7;
    }
  }
  if ( v7 >= 8 || v7 <= -8 )
    dword_4170F4 += v7;
  dword_4170F8 += result;
  if ( word_417108 )
    --word_417108;
  if ( word_41710A )
    --word_41710A;
  return result;
}
// 4131E0: using guessed type int dword_4131E0[];
// 4131EC: using guessed type int dword_4131EC[];
// 4131F8: using guessed type int dword_4131F8[];
// 413204: using guessed type int dword_413204[];
// 416CA0: using guessed type int dword_416CA0;
// 4170F2: using guessed type char byte_4170F2;
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417104: using guessed type char byte_417104;
// 417106: using guessed type __int16 word_417106;
// 417108: using guessed type __int16 word_417108;
// 41710A: using guessed type __int16 word_41710A;
// 417112: using guessed type __int16 word_417112;
// 417114: using guessed type __int16 word_417114;
// 417116: using guessed type char byte_417116;
// 417117: using guessed type char byte_417117;
// 417A44: using guessed type int dword_417A44;

//----- (0040A4F0) --------------------------------------------------------
int __cdecl sub_40A4F0(_BYTE *a1)
{
  __int16 v1; // ax@1
  bool v2; // zf@3
  signed int v3; // eax@3
  signed int v4; // eax@6
  int v5; // esi@7
  int v6; // ecx@7
  __int64 v7; // rax@7
  int v8; // ecx@7
  signed int v9; // eax@7
  int result; // eax@8

  v1 = word_417114-- - 1;
  if ( word_417114 <= 0 )
    byte_4170F2 = 0;
  v3 = v1 & 0x80000003;
  v2 = v3 == 0;
  if ( v3 < 0 )
    v2 = (((_BYTE)v3 - 1) | 0xFFFFFFFC) == -1;
  if ( v2 )
  {
    v4 = sub_403470(a1);
    if ( v4 != 0xFFFFFF )
    {
      v5 = (int)&a1[28 * v4];
      *(_BYTE *)(v5 + 1) = 1;
      v6 = Random(-512, 512);
      v7 = dword_4131F8[(unsigned __int8)byte_417116];
      *(_DWORD *)(v5 + 12) = v6 - (((BYTE4(v7) & 7) + (signed int)v7) >> 3);
      v8 = Random(-512, 512);
      v9 = dword_413204[(unsigned __int8)byte_417116];
      *(_BYTE *)v5 = 1;
      *(_BYTE *)(v5 + 20) = 0;
      *(_DWORD *)(v5 + 24) = 0;
      *(_DWORD *)(v5 + 16) = v8 - v9 / 8;
      *(_DWORD *)(v5 + 4) = dword_4170F4 + 0x2000;
      *(_DWORD *)(v5 + 8) = dword_4170F8 + 0x2000;
    }
  }
  result = dword_417100;
  dword_4170F4 += dword_4170FC;
  dword_4170F8 += dword_417100;
  byte_417104 = 3;
  if ( word_417108 )
    --word_417108;
  return result;
}
// 4131F8: using guessed type int dword_4131F8[];
// 413204: using guessed type int dword_413204[];
// 4170F2: using guessed type char byte_4170F2;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417104: using guessed type char byte_417104;
// 417108: using guessed type __int16 word_417108;
// 417114: using guessed type __int16 word_417114;
// 417116: using guessed type char byte_417116;

//----- (0040A620) --------------------------------------------------------
int __cdecl sub_40A620(int a1, _BYTE *a2)
{
  signed int v2; // eax@1
  int v3; // eax@2
  int v4; // edx@2
  int result; // eax@3
  int v6; // edx@3

  v2 = sub_403820(a2);
  if ( v2 != 0xFFFFFF )
  {
    v3 = (int)&a2[36 * v2];
    *(_BYTE *)v3 = 1;
    *(_BYTE *)(v3 + 1) = 0;
    *(_BYTE *)(v3 + 2) = 0;
    *(_BYTE *)(v3 + 3) = 1;
    *(_DWORD *)(v3 + 4) = dword_4170F4 + 0x2000;
    v4 = dword_4170F8 + 24576;
    *(_DWORD *)(v3 + 16) = -3072;
    *(_DWORD *)(v3 + 8) = v4;
    *(_DWORD *)(v3 + 12) = 3072;
    *(_DWORD *)(v3 + 20) = 3072;
    *(_DWORD *)(v3 + 24) = 0;
    *(_DWORD *)(v3 + 28) = 1;
    *(_DWORD *)(v3 + 32) = 0;
  }
  result = dword_417100 - 16;
  dword_4170FC = 0;
  v6 = dword_417100 - 16 + dword_4170F8;
  dword_417100 -= 16;
  dword_4170F8 = v6;
  byte_417104 = 3;
  if ( word_417108 )
    word_417108 = 0;
  return result;
}
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417104: using guessed type char byte_417104;
// 417108: using guessed type __int16 word_417108;

//----- (0040A6D0) --------------------------------------------------------
int __cdecl sub_40A6D0(int a1)
{
  return off_412FF0[(unsigned __int8)byte_4170F2](a1);
}
// 412FF0: using guessed type int (__cdecl *off_412FF0[2])(int);
// 4170F2: using guessed type char byte_4170F2;

//----- (0040A6F0) --------------------------------------------------------
int sub_40A6F0()
{
  int result; // eax@1

  result = 0;
  byte_4170F0 = 1;
  byte_4170F3 = 0;
  byte_4170F1 = 0;
  byte_417110 = 0;
  word_41710C = word_412FFC[0];
  word_41710E = 0;
  dword_4170F4 = 655360;
  dword_4170F8 = 1703936;
  dword_417100 = 0;
  dword_4170FC = 0;
  byte_417117 = 1;
  word_417106 = 0;
  byte_417104 = 0;
  byte_417116 = 0;
  byte_417118 = 0;
  byte_4170F2 = 0;
  word_417108 = 0;
  word_41710A = 100;
  word_417114 = 0;
  word_417112 = 0;
  byte_417119 = 0;
  return result;
}
// 412FFC: using guessed type __int16 word_412FFC[];
// 4170F0: using guessed type char byte_4170F0;
// 4170F1: using guessed type char byte_4170F1;
// 4170F2: using guessed type char byte_4170F2;
// 4170F3: using guessed type char byte_4170F3;
// 4170F4: using guessed type int dword_4170F4;
// 4170F8: using guessed type int dword_4170F8;
// 4170FC: using guessed type int dword_4170FC;
// 417100: using guessed type int dword_417100;
// 417104: using guessed type char byte_417104;
// 417106: using guessed type __int16 word_417106;
// 417108: using guessed type __int16 word_417108;
// 41710A: using guessed type __int16 word_41710A;
// 41710C: using guessed type __int16 word_41710C;
// 41710E: using guessed type __int16 word_41710E;
// 417110: using guessed type char byte_417110;
// 417112: using guessed type __int16 word_417112;
// 417114: using guessed type __int16 word_417114;
// 417116: using guessed type char byte_417116;
// 417117: using guessed type char byte_417117;
// 417118: using guessed type char byte_417118;
// 417119: using guessed type char byte_417119;

//----- (0040A780) --------------------------------------------------------
signed int __cdecl sub_40A780(int a1)
{
  signed int result; // eax@2
  int v2; // [sp+Ch] [bp-14h]@3
  int v3; // [sp+10h] [bp-10h]@3
  int v4; // [sp+14h] [bp-Ch]@3
  int v5; // [sp+18h] [bp-8h]@3
  int v6; // [sp+1Ch] [bp-4h]@3

  if ( DirectSoundCreate(NULL, &dword_41711C, NULL) )
  {
    result = 0;
  }
  else
  {
    (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD))dword_41711C->lpVtbl + 6))(dword_41711C, a1, 3);
    v2 = 20;
    v4 = 0;
    v3 = 1;
    v5 = 0;
    v6 = 0;
    (*((void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))dword_41711C->lpVtbl + 3))(
      dword_41711C,
      &v2,
      &dword_417120,
      0);
    memset(dword_417124, 0, 0x800u);
    result = 1;
  }
  return result;
}
// 417120: using guessed type int dword_417120;
// 417124: using guessed type int dword_417124[];

//----- (0040A810) --------------------------------------------------------
LPDIRECTSOUND sub_40A810()
{
  int *v0; // esi@1
  LPDIRECTSOUND result; // eax@7

  v0 = dword_417124;
  do
  {
    if ( *v0 )
    {
      (*(void (__stdcall **)(int))(*(_DWORD *)*v0 + 8))(*v0);
      *v0 = 0;
    }
    ++v0;
  }
  while ( (signed int)v0 < (signed int)&unk_417144 );
  if ( dword_417120 )
  {
    (*(void (__stdcall **)(int))(*(_DWORD *)dword_417120 + 8))(dword_417120);
    dword_417120 = 0;
  }
  result = dword_41711C;
  if ( dword_41711C )
  {
    result = (LPDIRECTSOUND)(*((int (__stdcall **)(_DWORD))dword_41711C->lpVtbl + 2))(dword_41711C);
    dword_41711C = NULL;
  }
  return result;
}
// 417120: using guessed type int dword_417120;
// 417124: using guessed type int dword_417124[];

//----- (0040A870) --------------------------------------------------------
int __cdecl sub_40A870(int a1)
{
  int result; // eax@1

  result = dword_417124[a1];
  if ( result )
  {
    result = (*(int (__stdcall **)(int))(*(_DWORD *)result + 8))(dword_417124[a1]);
    dword_417124[a1] = 0;
  }
  return result;
}
// 417124: using guessed type int dword_417124[];

//----- (0040A8A0) --------------------------------------------------------
HRSRC __usercall sub_40A8A0@<eax>(int a1@<edi>, int a2@<esi>, LPCSTR lpName, int a4, int a5)
{
  HRSRC result; // eax@1
  HGLOBAL v6; // eax@2
  LPVOID v7; // ebx@2
  int v8; // edx@2
  _DWORD *v9; // ebp@2
  char v10; // [sp+30h] [bp-20h]@4
  char v11; // [sp+34h] [bp-1Ch]@4
  unsigned int v12; // [sp+38h] [bp-18h]@4
  char *v13; // [sp+3Ch] [bp-14h]@2
  char *v14; // [sp+40h] [bp-10h]@2
  int v15; // [sp+44h] [bp-Ch]@2
  int v16; // [sp+48h] [bp-8h]@2
  char *v17; // [sp+4Ch] [bp-4h]@2

  result = FindResourceA(NULL, lpName, Type);
  if ( result )
  {
    v6 = LoadResource(NULL, result);
    v7 = LockResource(v6);
    v13 = (char *)20;
    v14 = (char *)16610;
    v15 = 0;
    v16 = 0;
    v17 = NULL;
    v8 = *(_DWORD *)((char *)v7 + 54);
    v17 = (char *)v7 + 20;
    v9 = (_DWORD *)(4 * a4 + 4288804);
    v15 = v8;
    if ( (*((int (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))dword_41711C->lpVtbl + 3))(dword_41711C, &v13, v9, 0) )
    {
      result = NULL;
    }
    else
    {
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, int *, LPCSTR *, char *, char *, _DWORD, int, int))(*(_DWORD *)*v9 + 44))(
        *v9,
        0,
        *(_DWORD *)((char *)v7 + 54),
        (int *)&v12,
        &lpName,
        &v11,
        &v10,
        0,
        a1,
        a2);
      qmemcpy(v14, (char *)v7 + 58, a5);
      if ( v12 )
        qmemcpy(v13, (char *)v7 + a5 + 58, v12);
      (*(void (__stdcall **)(_DWORD, void *, int))(*(_DWORD *)*v9 + 76))(*v9, v14, a5);
      result = (HRSRC)1;
    }
  }
  return result;
}

//----- (0040A9C0) --------------------------------------------------------
int __cdecl sub_40A9C0(int a1, int a2)
{
  int result; // eax@1

  result = dword_417124[a1];
  if ( result )
  {
    if ( a2 == -1 )
    {
      result = (*(int (__stdcall **)(int, _DWORD, _DWORD, signed int))(*(_DWORD *)result + 48))(result, 0, 0, 1);
    }
    else if ( a2 )
    {
      if ( a2 == 1 )
      {
        (*(void (__stdcall **)(int))(*(_DWORD *)result + 72))(dword_417124[a1]);
        (*(void (__stdcall **)(int, _DWORD))(*(_DWORD *)dword_417124[a1] + 52))(dword_417124[a1], 0);
        result = (*(int (__stdcall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)dword_417124[a1] + 48))(
                   dword_417124[a1],
                   0,
                   0,
                   0);
      }
    }
    else
    {
      result = (*(int (__stdcall **)(int))(*(_DWORD *)result + 72))(dword_417124[a1]);
    }
  }
  return result;
}
// 417124: using guessed type int dword_417124[];

//----- (0040AA30) --------------------------------------------------------
int __cdecl sub_40AA30(int a1, int a2)
{
  int result; // eax@1

  result = dword_417124[a1];
  if ( result )
    result = (*(int (__stdcall **)(int, int))(*(_DWORD *)result + 68))(result, 2 * (5 * a2 + 50));
  return result;
}
// 417124: using guessed type int dword_417124[];

//----- (0040AA60) --------------------------------------------------------
int __cdecl sub_40AA60(int a1, int a2)
{
  int result; // eax@1

  result = dword_417124[a1];
  if ( result )
    result = (*(int (__stdcall **)(int, int))(*(_DWORD *)result + 60))(result, 8 * a2 - 2400);
  return result;
}
// 417124: using guessed type int dword_417124[];

//----- (0040AA90) --------------------------------------------------------
int __cdecl sub_40AA90(int a1, int a2)
{
  int result; // eax@1

  result = dword_417124[a1];
  if ( result )
    result = (*(int (__stdcall **)(int, int))(*(_DWORD *)result + 64))(result, 2 * (5 * a2 - 1280));
  return result;
}
// 417124: using guessed type int dword_417124[];

//----- (0040AAC0) --------------------------------------------------------
size_t __cdecl sub_40AAC0(int a1, int a2, int a3, size_t a4, void *a5)
{
  signed int v5; // edi@1
  _DWORD *v6; // ebp@1
  signed int v7; // ebx@1
  int v8; // esi@1
  _DWORD *v9; // ebx@4
  signed int v11; // ecx@7
  signed int v12; // esi@7
  signed int v13; // edi@8
  __int64 v14; // rax@9
  int v15; // eax@10
  int v16; // eax@14
  unsigned int v17; // ecx@15
  size_t v18; // esi@18
  unsigned int v19; // [sp+10h] [bp-2Ch]@14
  unsigned int v20; // [sp+14h] [bp-28h]@14
  int v21; // [sp+18h] [bp-24h]@4
  char *v22; // [sp+1Ch] [bp-20h]@14
  _BYTE *v23; // [sp+20h] [bp-1Ch]@14
  _DWORD *v24; // [sp+24h] [bp-18h]@4
  int v25; // [sp+28h] [bp-14h]@1
  int v26; // [sp+2Ch] [bp-10h]@1
  size_t v27; // [sp+30h] [bp-Ch]@1
  int v28; // [sp+34h] [bp-8h]@1
  void *v29; // [sp+38h] [bp-4h]@1
  _BYTE *v30; // [sp+50h] [bp+14h]@4

  v5 = a4;
  v28 = 0;
  v6 = (_DWORD *)(4 * (_DWORD)a5 + 4288804);
  v25 = 20;
  v27 = a4;
  v26 = 16610;
  v29 = &unk_413224;
  v7 = 0;
  v8 = 4 * (_DWORD)a5 + 4288804;
  do
  {
    if ( (*((int (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))dword_41711C->lpVtbl + 3))(dword_41711C, &v25, v8, 0) )
      return 0;
    ++v7;
    v8 += 4;
  }
  while ( v7 < 24 );
  v30 = malloc(a4);
  v21 = 0;
  v9 = &unk_413238;
  v24 = v6;
  while ( 1 )
  {
    v11 = 0;
    v12 = 0;
    if ( v5 > 0 )
    {
      v13 = 0;
      do
      {
        v14 = *(_BYTE *)((v11 / 256 & 0xFF) + a1) * (signed int)*(_BYTE *)(v13 / (signed int)a4 + a2);
        v30[v12] = (((BYTE4(v14) & 0x7F) + (signed int)v14) >> 7) + -128;
        if ( (signed int)v9 >= (signed int)Type )
          v15 = a3 * *(v9 - 12) / 8;
        else
          v15 = *v9 * a3 / 16;
        v11 += v15;
        ++v12;
        v13 += 64;
      }
      while ( v12 < (signed int)a4 );
      v6 = v24;
      v5 = a4;
    }
    v16 = *v6;
    v19 = 0;
    if ( (*(int (__stdcall **)(int, _DWORD, signed int, int *, int *, int *, int *, _DWORD))(*(_DWORD *)v16 + 44))(
           v16,
           0,
           v5,
           (int *)&v23,
           (int *)&v20,
           (int *)&v22,
           (int *)&v19,
           0) )
    {
      break;
    }
    qmemcpy(v23, v30, v20);
    v17 = v19;
    if ( v19 )
    {
      qmemcpy(v22, &v30[v20], v19);
      v17 = v19;
    }
    (*(void (__stdcall **)(_DWORD, void *, unsigned int, void *, unsigned int))(*(_DWORD *)*v6 + 76))(
      *v6,
      v23,
      v20,
      v22,
      v17);
    ++v9;
    ++v6;
    ++v21;
    v24 = v6;
    if ( (signed int)v9 >= (signed int)a04d02d02dByPix )
    {
      v18 = a4;
      goto LABEL_20;
    }
    v5 = a4;
  }
  v18 = 0;
LABEL_20:
  if ( v21 == 24 )
    v18 = 1;
  free(v30);
  return v18;
}

//----- (0040ACC0) --------------------------------------------------------
// Creates random number in given range
int __cdecl Random(signed int Minimum, signed int Maximum)
{
  return Minimum + rand() % (Maximum - Minimum + 1);
}

//----- (0040ACE0) --------------------------------------------------------
int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd)
{
  HANDLE v4; // eax@1
  int result; // eax@2
  unsigned int v6; // ecx@3
  char v7; // dl@4
  HINSTANCE v8; // ebx@5
  BOOL (__stdcall *v9)(int, int); // edi@6
  HICON v10; // eax@6
  HBRUSH v11; // eax@6
  int v12; // eax@14
  int v13; // ebx@14
  int nWidth; // ST44_4@14
  int v15; // edi@14
  int v16; // edi@14
  int v17; // ebp@14
  int Y; // ST40_4@14
  int v19; // ebx@14
  int v20; // ebx@14
  int v21; // ST2C_4@14
  int v22; // eax@14
  HINSTANCE v23; // esi@14
  int v24; // ST1C_4@20
  int v25; // eax@20
  HWND v26; // eax@20
  HCURSOR v27; // eax@24
  HANDLE hMutex; // [sp+18h] [bp-4Ch]@3
  int v29; // [sp+1Ch] [bp-48h]@24
  int v30; // [sp+20h] [bp-44h]@24
  int v31; // [sp+24h] [bp-40h]@24
  int v32; // [sp+28h] [bp-3Ch]@24
  int v33; // [sp+2Ch] [bp-38h]@24
  int v34; // [sp+30h] [bp-34h]@24
  int v35; // [sp+34h] [bp-30h]@24
  int v36; // [sp+38h] [bp-2Ch]@24
  WNDCLASSA WndClass; // [sp+3Ch] [bp-28h]@6
  void *retaddr; // [sp+64h] [bp+0h]@6

  v4 = OpenMutexA(0x1F0001u, 0, Name);
  if ( v4 )
  {
    CloseHandle(v4);
    return 0;
  }
  hMutex = CreateMutexA(NULL, 0, Name);
  GetModuleFileNameA(NULL, &Filename, 0x104u);
  v6 = strlen(&Filename);
  if ( *(&Filename + v6) != 92 )
  {
    do
      v7 = byte_417937[v6--];
    while ( v7 != 92 );
  }
  v8 = hInstance;
  *(&Filename + v6) = 0;
  if ( !DialogBoxParamA(hInstance, TemplateName, NULL, DialogFunc, 0) )
    return 1;
  memset(&WndClass, 0, sizeof(WndClass));
  v9 = (BOOL (__stdcall *)(int, int))&retaddr;
  WndClass.lpfnWndProc = (WNDPROC)sub_40B0F0;
  WndClass.hInstance = hInstance;
  v10 = (HICON)LoadImageA(hInstance, name, 1u, 32, 32, 0);
  WndClass.hCursor = NULL;
  WndClass.hIcon = v10;
  v11 = (HBRUSH)GetStockObject(3);
  WndClass.lpszClassName = Caption;
  WndClass.hbrBackground = v11;
  if ( !dword_417A54 )
  {
    if ( !RegisterClassA(&WndClass) )
      return 0;
    dword_417930 = 640;
    dword_417924 = 480;
    sub_401E70(0, 0);
    v24 = GetSystemMetrics(1);
    v25 = GetSystemMetrics(0);
    v26 = CreateWindowExA(0, Caption, Caption, 0x90080000, 0, 0, v25, v24, NULL, NULL, hInstance, NULL);
    v23 = (HINSTANCE)v26;
    hWnd = v26;
    if ( !v26 )
      return 0;
    Init_Direct_Draw(v26, 0);
    v9 = SetCursorPos;
    SetCursorPos(dword_417930 / 2, dword_417924 / 2);
    SetCursorPos(0, 0);
    goto LABEL_24;
  }
  if ( dword_417A54 <= 0 || dword_417A54 > 2 )
  {
    v23 = hInstance;
LABEL_24:
    v27 = LoadCursorA(v8, CursorName);
    SetCursor(v27);
    v33 = 0;
    v34 = 0;
    v35 = 64;
    v36 = 8;
    v29 = 0;
    v30 = 0;
    v31 = 320;
    v32 = 240;
    sub_4021D0((int)aPbmLoading2_pb, 24);
    sub_402600((int)&v29, 0);
    sub_4024C0((int)&v29, 128, 116, (int)&v33, 24);
    sub_401E90((HWND)v23);
    if ( !sub_40A780((int)v23) )
    {
      MessageBoxA((HWND)v23, Text, Caption, 0);
      return 1;
    }
    sub_402710(NULL);
    sub_408850();
    sub_405350((int)v9, (int)v23, (HWND)v23);
    sub_408A90();
    __CxxRestoreUnhandledExceptionFilter();
    sub_40A810();
    sub_402140((int)v23);
    ReleaseMutex(hMutex);
    return 1;
  }
  WndClass.lpszMenuName = aMenu_main;
  if ( !RegisterClassA(&WndClass) )
    return 0;
  if ( dword_417A54 == 1 )
  {
    dword_417930 = 320;
    dword_417924 = 240;
  }
  else
  {
    dword_417930 = 640;
    dword_417924 = 480;
  }
  v12 = GetSystemMetrics(7);
  v13 = dword_417930 + 2 * v12;
  nWidth = dword_417930 + 2 * v12;
  v15 = GetSystemMetrics(8);
  v16 = GetSystemMetrics(15) + 2 * v15;
  v9 = (BOOL (__stdcall *)(int, int))(v16 + dword_417924 + GetSystemMetrics(4));
  v17 = (GetSystemMetrics(0) - v13) / 2;
  Y = (GetSystemMetrics(1) - (signed int)v9) / 2;
  v19 = GetSystemMetrics(15);
  v20 = GetSystemMetrics(8) + v19;
  v21 = GetSystemMetrics(4) + v20;
  v22 = GetSystemMetrics(7);
  sub_401E70(v22, v21);
  v8 = hInstance;
  result = (int)CreateWindowExA(0, Caption, Caption, 0x10CA0000u, v17, Y, nWidth, (int)v9, NULL, NULL, hInstance, NULL);
  v23 = (HINSTANCE)result;
  hWnd = (HWND)result;
  if ( result )
  {
    unk_417934 = LoadAcceleratorsA(hInstance, TableName);
    GetMenu((HWND)v23);
    if ( dword_417A54 == 1 )
      Init_Direct_Draw((HWND)v23, 1);
    else
      Init_Direct_Draw((HWND)v23, 2);
    goto LABEL_24;
  }
  return result;
}
// 408850: using guessed type int sub_408850(void);
// 417924: using guessed type int dword_417924;
// 417930: using guessed type int dword_417930;
// 417A54: using guessed type int dword_417A54;

//----- (0040B0D0) --------------------------------------------------------
void sub_40B0D0()
{
  dword_417A50 = 0;
}
// 417A50: using guessed type int dword_417A50;

//----- (0040B0F0) --------------------------------------------------------
signed int __stdcall sub_40B0F0(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)
{
  signed int result; // eax@7
  int v5; // eax@15
  int v6; // eax@16
  int v7; // eax@17
  int v8; // eax@18
  int v9; // eax@19
  int v10; // eax@20
  int v11; // eax@21
  int v12; // eax@22
  int v13; // eax@25
  int v14; // eax@26
  int v15; // eax@27
  int v16; // eax@28
  int v17; // eax@29
  int v18; // eax@30
  int v19; // eax@31
  int v20; // eax@32
  int v21; // eax@41
  int v22; // eax@42
  int v23; // eax@43
  int v24; // eax@44
  int v25; // [sp+0h] [bp-50h]@36
  int v26; // [sp+4h] [bp-4Ch]@36
  int v27; // [sp+8h] [bp-48h]@36
  char v28; // [sp+Ch] [bp-44h]@36
  CHAR Text; // [sp+10h] [bp-40h]@36

  if ( Msg > 0x111 )
  {
    switch ( Msg )
    {
      case 0x201u:
        v21 = dword_417A48;
        LOBYTE(v21) = dword_417A48 | 2;
        dword_417A48 = v21;
        return 0;
      case 0x202u:
        v22 = dword_417A48;
        LOBYTE(v22) = dword_417A48 & 0xFD;
        dword_417A48 = v22;
        return 0;
      case 0x204u:
        v23 = dword_417A48;
        LOBYTE(v23) = dword_417A48 | 1;
        dword_417A48 = v23;
        return 0;
      case 0x205u:
        v24 = dword_417A48;
        LOBYTE(v24) = dword_417A48 & 0xFE;
        dword_417A48 = v24;
        return 0;
      default:
        return DefWindowProcA(hWnd, Msg, wParam, lParam);
    }
    return DefWindowProcA(hWnd, Msg, wParam, lParam);
  }
  if ( Msg == 273 )
  {
    switch ( (unsigned __int16)wParam )
    {
      case 0x9C41u:
        PostMessageA(hWnd, 2u, 0, 0);
        result = 0;
        break;
      case 0x9C44u:
        ShowWindow(hWnd, 6);
        result = 0;
        break;
      case 0x9C42u:
        sub_406070((int)&lParam, (signed int *)&Msg, (int)&wParam);
        sub_406140(&v27, &v26, &v25, &v28);
        sprintf(&Text, off_413278, v27, v26, v25, lParam, Msg, wParam);
        MessageBoxA(hWnd, &Text, Caption, 0);
        result = 0;
        break;
      case 0x9C43u:
        if ( !sub_406210(hWnd) )
          MessageBoxA(hWnd, aGGkgebGarTsv, Caption, 0);
        dword_417A3C = 50;
        result = 0;
        break;
      default:
        return 0;
    }
  }
  else
  {
    if ( Msg <= 5 )
    {
      if ( Msg == 5 )
      {
        if ( !wParam )
        {
          __setargv();
          return 0;
        }
        if ( wParam == 1 )
        {
          sub_40B0D0();
          return 0;
        }
      }
      else if ( Msg != 1 )
      {
        if ( Msg == 2 )
        {
          PostQuitMessage(0);
          return 1;
        }
        return DefWindowProcA(hWnd, Msg, wParam, lParam);
      }
      return 0;
    }
    if ( Msg != 256 )
    {
      if ( Msg == 257 )
      {
        switch ( wParam )
        {
          case 0x20u:
            v5 = dword_417A44;
            LOBYTE(v5) = dword_417A44 & 0xEF;
            dword_417A44 = v5;
            result = 0;
            break;
          case 0x25u:
            v6 = dword_417A44;
            LOBYTE(v6) = dword_417A44 & 0xFE;
            dword_417A44 = v6;
            result = 0;
            break;
          case 0x27u:
            v7 = dword_417A44;
            LOBYTE(v7) = dword_417A44 & 0xFD;
            dword_417A44 = v7;
            result = 0;
            break;
          case 0x26u:
            v8 = dword_417A44;
            LOBYTE(v8) = dword_417A44 & 0xFB;
            dword_417A44 = v8;
            result = 0;
            break;
          case 0x28u:
            v9 = dword_417A44;
            LOBYTE(v9) = dword_417A44 & 0xF7;
            dword_417A44 = v9;
            result = 0;
            break;
          case 0x58u:
            v10 = dword_417A44;
            LOBYTE(v10) = dword_417A44 & 0xDF;
            dword_417A44 = v10;
            result = 0;
            break;
          case 0x5Au:
            v11 = dword_417A44;
            LOBYTE(v11) = dword_417A44 & 0xBF;
            dword_417A44 = v11;
            result = 0;
            break;
          case 0x53u:
            v12 = dword_417A44;
            LOBYTE(v12) = dword_417A44 & 0x7F;
            dword_417A44 = v12;
            result = 0;
            break;
          default:
            return 0;
        }
        return result;
      }
      return DefWindowProcA(hWnd, Msg, wParam, lParam);
    }
    switch ( wParam )
    {
      case 0x1Bu:
        PostMessageA(hWnd, 0x10u, 0, 0);
        result = 0;
        break;
      case 0x20u:
        v13 = dword_417A44;
        LOBYTE(v13) = dword_417A44 | 0x10;
        dword_417A44 = v13;
        result = 0;
        break;
      case 0x25u:
        v14 = dword_417A44;
        LOBYTE(v14) = dword_417A44 | 1;
        dword_417A44 = v14;
        result = 0;
        break;
      case 0x27u:
        v15 = dword_417A44;
        LOBYTE(v15) = dword_417A44 | 2;
        dword_417A44 = v15;
        result = 0;
        break;
      case 0x26u:
        v16 = dword_417A44;
        LOBYTE(v16) = dword_417A44 | 4;
        dword_417A44 = v16;
        result = 0;
        break;
      case 0x28u:
        v17 = dword_417A44;
        LOBYTE(v17) = dword_417A44 | 8;
        dword_417A44 = v17;
        result = 0;
        break;
      case 0x58u:
        v18 = dword_417A44;
        LOBYTE(v18) = dword_417A44 | 0x20;
        dword_417A44 = v18;
        result = 0;
        break;
      case 0x5Au:
        v19 = dword_417A44;
        LOBYTE(v19) = dword_417A44 | 0x40;
        dword_417A44 = v19;
        result = 0;
        break;
      case 0x53u:
        v20 = dword_417A44;
        LOBYTE(v20) = dword_417A44 | 0x80;
        dword_417A44 = v20;
        result = 0;
        break;
      default:
        return 0;
    }
  }
  return result;
}
// 40B0E0: using guessed type int __setargv(void);
// 417A3C: using guessed type int dword_417A3C;
// 417A44: using guessed type int dword_417A44;
// 417A48: using guessed type int dword_417A48;

//----- (0040B580) --------------------------------------------------------
signed int sub_40B580()
{
  struct tagMSG Msg; // [sp+10h] [bp-1Ch]@1

  while ( 1 )
  {
    if ( PeekMessageA(&Msg, NULL, 0, 0, 0) || !dword_417A50 )
    {
      if ( !dword_417A3C )
        goto LABEL_7;
    }
    else if ( !dword_417A3C )
    {
      return 1;
    }
    --dword_417A3C;
LABEL_7:
    if ( !GetMessageA(&Msg, NULL, 0, 0) )
      return 0;
    if ( !TranslateAcceleratorA(hWnd, unk_417934, &Msg) )
    {
      TranslateMessage(&Msg);
      DispatchMessageA(&Msg);
    }
  }
}
// 417A3C: using guessed type int dword_417A3C;
// 417A50: using guessed type int dword_417A50;

//----- (0040BD2A) --------------------------------------------------------
int sub_40BD2A()
{
  return flsall(1);
}
// 40BD33: using guessed type _DWORD __cdecl flsall(_DWORD);

#error "There were 1 decompilation failure(s) on 139 function(s)"
